var rus2eng={"А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"YO","Ж":"ZH","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"CH","Ш":"SH","Щ":"W","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"YU","Я":"YA","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"w","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"};var eng2rus={"А":"A",YA:"Я"};var rus2engRE=/(?:[А-Яа-я])/g;var eng2rusRE=/(?:YA|A)/g;function trCallbackRu(a){return rus2eng[a]}function trCallbackEn(a){return eng2rus[a]}function transliterateRu(a){return a.replace(rus2engRE,trCallbackRu)}function transliterateEn(a){return a}function base64encode(g){var f="АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюя";var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var j=c.split("");var h=new Array();var b=0;for(b=0;b<g.length;b++){var d=g.charCodeAt(b);if(d>127){d=f.indexOf(g.charAt(b))+163;if(d<163){continue}}h.push(d)}var l=new Array();var e=h.length-h.length%3;var k=0;for(b=0;b<e;b+=3){k=(h[b]<<16)+(h[b+1]<<8)+h[b+2];l.push(j[(k>>18)&63]+j[(k>>12)&63]+j[(k>>6)&63]+j[k&63])}switch(h.length-e){case 1:k=h[e]<<4;l.push(j[(k>>6)&63]+j[k&63]+"==");break;case 2:k=(h[e]<<10)+(h[e+1]<<2);l.push(j[(k>>12)&63]+j[(k>>6)&63]+j[k&63]+"=");break}return l.join("")}var parsedCookies=null;function setCookie(b,c,a){var f="";if(a){var g=new Date();g.setTime(g.getTime()+a);f="; expires="+g.toGMTString()}if(c===null){f="; expires=Thu, 01-Jan-1970 00:00:01 GMT"}document.cookie=b+"="+c+f+"; path=/";if(parsedCookies){if(c!=null){parsedCookies[b]=c}else{delete parsedCookies[b]}}}function getCookie(a){if(!parsedCookies){parsedCookies={};var c=document.cookie.split(";");for(var b=0;b<c.length;b++){var d=c[b].split("=");parsedCookies[d[0].replace(/^\s/,"")]=d[1]}}return parsedCookies[a]||null}function relationControl(r,b,j,h){var e=this;var d=r;var v=b||r;var q=true;var y=null;var B=null;var s=null;var f=null;var C=null;var a=null;var c=null;var A=null;var t=null;var m=0;var l=0;var z=h||"/admin/data/guide_items_all/";var w=function(){y=document.getElementById("relationSelect"+v);B=document.getElementById("relationInput"+v);s=document.getElementById("relationButton"+v);if(!y){alert("Select input for field #"+v+" not found");return}jQuery("option",y).each(function(){if(!this.selected&&this.value.length!==0){q=false}});if(s){s.onclick=function(){e.addItem()}}if(B){B.onkeyup=function(G){var F=G?G.keyCode:event.keyCode;if(F==13&&s){e.addItem();return false}else{e.doSearch()}};B.onkeydown=function(G){var F=G?G.keyCode:event.keyCode;if(F==13){return false}}}var E=function(){if(q){e.loadItemsAll();q=false}};y.onmouseover=E;y.onfocus=E;for(var D=0;D<y.childNodes.length;D++){if(y.childNodes[D].nodeType!=1){y.removeChild(y.childNodes[D]);D=0}}if(j&&jQuery("option[value='']",y).size()==0){jQuery(y).prepend("<option value=''></option>")}};this.rescan=function(){B=document.getElementById("relationInput"+v);if(B){B.onkeyup=function(E){var D=E?E.keyCode:event.keyCode;if(D==13&&s){e.addItem()}else{e.doSearch()}}}};this.getValue=function(){var F=jQuery("option[selected]",jQuery(y));var D=[];for(var E=0;E<F.length;E++){D[F[E].value]=jQuery(F[E]).text()}return D};this.loadItems=function(D){jQuery.ajax({url:z+d+".xml?limit&search[]="+encodeURIComponent(D),type:"get",complete:function(F,E){e.updateItems(F)}})};this.loadItemsAll=function(){jQuery.ajax({url:z+d+".xml?allow-empty",type:"get",complete:function(E,D){e.updateItemsAll(E)}})};this.updateItemsAll=function(E){if(E.responseXML.getElementsByTagName("empty").length){if(B){B.onkeyup=function(P){var O=P?P.keyCode:event.keyCode;switch(O){case 38:if(A.length&&(t>0||t==null)){g((t===null)?(A.length-1):(t-1))}break;case 40:if(A.length&&(t<(A.length-1)||t==null)){g((t===null)?0:(t+1))}break;case 13:k();n();break;case 27:n();break;default:clearTimeout(c);c=setTimeout(function(){e.doSearchAjax()},500)}};B.onblur=function(){if(a){if(m<parseInt(a.style.left)||m>(parseInt(a.style.left)+parseInt(a.offsetWidth))||l<parseInt(a.style.top)||l>(parseInt(a.style.top)+parseInt(a.offsetHeight))){n()}}};var K=E.responseXML.getElementsByTagName("empty")[0].getAttribute("total");if(!C){C=new Option(" ","");C.innerHTML=getLabel("js-relation-total")+K+". "+getLabel("js-relation-use_search");y.insertBefore(C,y.firstChild)}}return}var I=E.responseXML.getElementsByTagName("object");var L=[];var F=0;for(F=0;F<y.options.length;F++){if(y.options[F].selected){L.push(y.options[F].value)}}jQuery("option",y).each(function(){if(!this.selected||this.value.length===0){jQuery(this).remove()}});if(j){$(y).prepend("<option value=''> </option>")}for(F=0;F<I.length;F++){var J=I[F].getAttribute("id");var G=false;for(var M in L){if(L[M]==J){G=true;delete L[M];break}}if(!G){var N=I[F].getAttribute("name");var D=new Option(N,J);D.innerHTML=N;y.appendChild(D)}}if(jQuery.browser.msie){var H=y.style.display;y.style.display="none";y.style.display=H}};this.updateItems=function(E){t=null;A=E.responseXML.getElementsByTagName("object");if(!A.length){return}var F=null;if(!a){a=document.createElement("div");a.className="relationAutosuggest";var H=jQuery(B).offset();a.style.position="absolute";a.style.zIndex=1050;a.style.width=B.clientWidth+"px";a.style.top=(H.top+B.offsetHeight)+"px";a.style.left=H.left+"px";F=document.createElement("ul");a.appendChild(F);document.body.appendChild(a)}a.style.display="";jQuery(document).mousemove(o);F=a.firstChild;while(F.firstChild){F.removeChild(F.firstChild)}for(i=0;i<A.length;i++){var G=A[i].getAttribute("name");var D=document.createElement("li");D.innerHTML=G;D.onmouseover=function(){g(this.suggestIndex)};D.onmouseout=function(){this.className=""};D.onclick=function(){k();n()};D.suggestIndex=i;F.appendChild(D)}};var o=function(D){if(!D){m=event.clientX+document.body.scrollLeft;l=event.clientY+document.body.scrollTop}else{m=D.pageX;l=D.pageY}return true};this.addItem=function(E,D){if(!(E&&E.length)&&!(B&&B.value.length)){return}x();u();if(!y.multiple&&f&&!E&&!D){f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+B.value;f.value=D?D:B.value;y.selectedIndex=0}else{f=new Option(E?E:B.value,D?D:B.value);f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+(E?E:B.value);if(y.options.length){y.insertBefore(f,y.firstChild)}else{y.appendChild(f)}}B.value="";f.selected=true;if(jQuery.browser.msie){setTimeout(function(){f.selected=false;f.selected=true},20)}};var g=function(E){if(a.style.display!="none"){var F=a.firstChild;var D=F.childNodes.item(t);if(D){D.className=""}F.childNodes.item(E).className="active";t=E}};var k=function(){if(a&&a.style.display!="none"&&t!==null){var G=A[t].getAttribute("name");var F=A[t].getAttribute("id");var E=false;for(var D=0;D<y.options.length;D++){if(y.options[D].value==F){E=true;y.options[D].selected=true;break}}if(!E){e.addItem(G,F)}}else{if(B.value.length&&s){e.addItem()}}};var n=function(){if(a&&a.style.display!="none"){a.style.display="none";jQuery(document).unbind("mousemove",o)}};this.doSearch=function(){var G=B.value.toLowerCase();x();if(G==""){if(y.multiple){u()}return}for(var E=0;E<y.options.length;E++){var H=y.options[E].text;var F=H.replace(/^.\s\s/,"");if(H.substring(0,G.length).toLowerCase()===G||F.substring(0,G.length).toLowerCase()===G){if(y.multiple){if(y.firstChild.nodeName.toLowerCase()!="optgroup"){p();searchGroup=y.firstChild;itemsGroup=y.lastChild}var D=y.options[E];if(D.parentNode==searchGroup){continue}D.oldPrevSibling=D.previousSibling;itemsGroup.removeChild(D);searchGroup.appendChild(D);if(searchGroup.childNodes.length==5){return}}else{y.selectedIndex=E;return}}}};this.doSearchAjax=function(){if(B.value){this.loadItems(B.value)}};var p=function(){var E=document.createElement("optgroup");E.label="Search results";var D=document.createElement("optgroup");D.label="------------------------------------------------";while(y.firstChild){var F=y.firstChild;y.removeChild(F);D.appendChild(F)}y.appendChild(E);y.appendChild(D)};var u=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){y.removeChild(y.firstChild);var D=y.firstChild;while(D.firstChild){var E=D.firstChild;D.removeChild(E);y.appendChild(E)}y.removeChild(D)}};var x=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){var E=y.firstChild;var D=y.lastChild;while(E.firstChild){var F=E.firstChild;E.removeChild(F);if(F.oldPrevSibling!==undefined||F.oldPrevSibling==null){if(F.oldPrevSibling&&F.oldPrevSibling.nextSibling){D.insertBefore(F,F.oldPrevSibling.nextSibling)}else{if(F.oldPrevSibling===null){D.insertBefore(F,D.firstChild)}else{D.appendChild(F)}}F.oldPrevSibling=undefined}}}};w()}function symlinkControl(f,t,c,A,r){var h=this;var y=f;var u=(c instanceof Array)?c:[c];var r=(r instanceof Array)?r:[r];var l=(c instanceof Array)?"&htypes[]="+c.join("&htypes[]="):"";var F=(r instanceof Array)?"&hierarchy_types="+r.join(","):"";var e=t||null;var v=null;var I=null;var g=null;var a=null;var b=null;var G=null;var z=null;var q=0;var o=0;if(!A){var A={}}var x=A.iconsPath||"/images/cms/admin/mac/tree/";var D=A.fadeColorStart||[255,0,0];var H=A.fadeColorEnd||[255,255,255];var p=A.inputName||("symlinkInput"+y);var C=A.noImages||false;var k={};var E=function(){if(!window.symlinkControlsList){window.symlinkControlsList={}}window.symlinkControlsList[y]=h;v=document.getElementById("symlinkInput"+y);if(!v){alert("Symlink container #"+y+" not found");return}var J=document.createElement("input");J.type="hidden";J.name=p;v.parentNode.insertBefore(J,v);a=document.createElement("ul");v.appendChild(a);I=document.createElement("input");v.appendChild(I);g=C?document.createElement("input"):document.createElement("img");v.appendChild(g);I.type="text";if(C){g.type="button";g.value="╘"}else{g.src="/images/cms/admin/mac/tree.png";g.height="18"}g.className="treeButton";g.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:"Выбор страницы",width:620,height:335,url:"/styles/common/js/tree.html?id="+y+(e?"&module="+e:"")+F+(window.lang_id?"&lang_id="+window.lang_id:"")})};a.className="pageslist";I.onkeypress=function(L){var K=L?L.keyCode:window.event.keyCode;if(K==13){return false}};I.onkeyup=function(L){var K=L?L.keyCode:window.event.keyCode;switch(K){case 38:if(G.length&&(z>0||z==null)){j((z===null)?(G.length-1):(z-1))}break;case 40:if(G.length&&(z<(G.length-1)||z==null)){j((z===null)?0:(z+1))}break;case 13:n();s();return false;break;case 27:s();break;default:h.doSearch()}};I.onblur=function(){if(b){if(q<parseInt(b.style.left)||q>(parseInt(b.style.left)+parseInt(b.offsetWidth))||o<parseInt(b.style.top)||o>(parseInt(b.style.top)+parseInt(b.offsetHeight))){s()}}}};this.loadItems=function(J){jQuery.ajax({url:"/admin/content/load_tree_node.xml?limit&domain_id[]="+(window.domain_id?window.domain_id:"1")+l+(window.lang_id?"&lang_id="+window.lang_id:"")+"&search-all-text[]="+encodeURIComponent(J),type:"get",complete:function(L,K){h.updateItems(L)}})};this.updateItems=function(K){z=null;G=K.responseXML.getElementsByTagName("page");if(!G.length){return}var L=[];for(var M=0;M<G.length;M++){if(k[G[M].getAttribute("id")]){continue}L[L.length]=G[M]}G=L;var N=null;if(!b){b=document.createElement("div");b.className="symlinkAutosuggest";var P=jQuery(I).offset();b.style.position="absolute";b.style.zIndex=1050;b.style.width=I.clientWidth+"px";b.style.top=(P.top+I.offsetHeight)+"px";b.style.left=P.left+"px";N=document.createElement("ul");b.appendChild(N);document.body.appendChild(b)}m();jQuery(document).mousemove(w);N=b.firstChild;while(N.firstChild){N.removeChild(N.firstChild)}for(M=0;M<G.length;M++){if(k[G[M].getAttribute("id")]){continue}var J=d(G[M].getElementsByTagName("name")[0]);var O=d(G[M].getElementsByTagName("basetype")[0]);var Q=G[M].getAttribute("link");var T=document.createElement("li");var S=document.createElement("span");var R=document.createElement("a");T.title=J;if(J.length>20){J=J.substr(0,20)+"..."}if(Q.length>55){Q=Q.substr(0,55)+"..."}T.appendChild(document.createTextNode(J));T.appendChild(S);T.appendChild(document.createElement("br"));T.appendChild(R);S.appendChild(document.createTextNode(" ("+O+")"));R.appendChild(document.createTextNode(Q));R.href=Q;R.target="_blank";T.onmouseover=function(){j(this.suggestIndex)};T.onclick=function(){n();s()};T.suggestIndex=M;N.appendChild(T)}};this.doSearch=function(){var J=I.value;h.loadItems(J)};var j=function(K){if(b.style.display!="none"){var L=b.firstChild;var J=L.childNodes.item(z);if(J){J.className=""}L.childNodes.item(K).className="active";z=K}};var n=function(){if(b&&b.style.display!="none"&&z!==null){var P=G[z].getAttribute("id");var K=d(G[z].getElementsByTagName("name")[0]);var J=G[z].getAttribute("link");var N=G[z].getElementsByTagName("basetype")[0];var M="";var L=(M=N.getAttribute("module"))?M:"";var O=(M=N.getAttribute("method"))?M:"";h.addItem(P,K,[L,O],J)}};this.addItem=function(N,K,O,L){if(k[N]!==undefined){return}var P=document.createElement("li");var T=document.createElement("span");var R=document.createElement("a");var M=document.createElement("a");var S=document.createElement("input");S.type="hidden";S.name=p;S.value=N;M.input=S;R.href=L;if(C){M.appendChild(document.createTextNode("[x]"))}else{var J=document.createElement("img");J.src=x+"symlink_delete.png";J.alt="delete";M.appendChild(J)}M.href="javascript:void(0);";M.className="button";M.onclick=function(){this.input.parentNode.removeChild(this.input);a.removeChild(this.parentNode);delete k[N]};T.title=O[0]+" "+O[1];T.appendChild(document.createTextNode(K));R.appendChild(document.createTextNode(L));P.appendChild(M);if(!C){var Q=document.createElement("img");Q.src=x+"ico_"+O[0]+"_"+O[1]+".png";P.appendChild(Q)}P.appendChild(T);P.appendChild(R);a.appendChild(P);v.parentNode.insertBefore(S,v);P.style.backgroundColor=makeHexRgb(D);P.startColor=D;P.endColor=H;P.pname=K;P.fade=B;setTimeout(function(){P.fade()},2000);k[N]=true;if(jQuery("#eip_page").size()){frameElement.height=(jQuery("#eip_page").height()>500)?500:jQuery("#eip_page").height()}};var B=function(){if(this.fadeColor==undefined){this.fadeColor=[];this.fadeColor[0]=this.startColor[0];this.fadeColor[1]=this.startColor[1];this.fadeColor[2]=this.startColor[2]}if(Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])==Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){return}this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50;this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50;this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50;this.style.backgroundColor=makeHexRgb(this.fadeColor);var J=this;setTimeout(function(){J.fade()},20)};var m=function(){if(b){var J=jQuery(I).offset();b.style.width=I.clientWidth;b.style.top=J.top+I.offsetHeight;b.style.left=J.left;b.style.display=""}};var s=function(){if(b&&b.style.display!="none"){b.style.display="none";jQuery(document).unbind("mousemove",w)}};var w=function(J){if(!J){q=event.clientX+document.body.scrollLeft;o=event.clientY+document.body.scrollTop}else{q=J.pageX;o=J.pageY}return true};var d=function(J){return(J.firstChild&&J.firstChild.nodeType==3)?J.firstChild.nodeValue:J.nodeValue};E()}var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(b){var a="";for(var c=0;c<3;c++){a=a+hex[Math.floor(b[c]/16)]+hex[Math.floor(b[c]%16)]}return"#"+a}function permissionsControl(a){var e=this;var o=document.getElementById(a);var u=null;var n=null;var g={};var w=0;var q=null;var b=null;var v=null;var s=null;var l=0;var k=0;var x=[getLabel("js-permissions-view"),getLabel("js-permissions-edit"),getLabel("js-permissions-create"),getLabel("js-permissions-delete"),getLabel("js-permissions-move")];var r=function(){var H=document.createElement("table");var C=document.createElement("tr");var z=document.createElement("th");z.style.width="100%";z.appendChild(document.createTextNode(" "));C.appendChild(z);var E=["/images/cms/admin/mac/tree/view.png","/images/cms/admin/mac/tree/ico_edit.png","/images/cms/admin/mac/tree/ico_add.png","/images/cms/admin/mac/tree/ico_del.png","/images/cms/admin/mac/ico_data_drag_a.gif"];for(var A=0;A<x.length;A++){z=document.createElement("th");var B=document.createElement("img");B.src=E[A];B.alt=B.title=x[A];z.appendChild(B);z.className="permissionType";C.appendChild(z)}H.className="permissionTable";var y=document.createElement("tr");var G=document.createElement("td");G.colspan=6;G.setAttribute("colspan","6");G.className="addOwner";y.appendChild(G);n=document.createElement("input");G.appendChild(n);n.onkeypress=function(J){var I=J?J.keyCode:window.event.keyCode;if(I==13){return false}};n.onkeyup=t;n.onblur=d;u=document.createElement("tbody");var D=document.createElement("thead");D.appendChild(C);var F=document.createElement("tfoot");F.appendChild(y);H.appendChild(D);H.appendChild(u);H.appendChild(F);o.appendChild(H);e.add("system-guest","",0)};this.add=function(A,z,y,G){var E={};E.id=A;E.name=z;E.level=y;if(A=="system-guest"){w=y;z="Все"}else{if(y==w&&!G){return}}if(A=="system-supervisor"||A=="users-users-15"){return}g[A]=E;var J=document.createElement("tr");var F=document.createElement("td");var I=document.createElement("img");I.src="/images/cms/admin/mac/perm_user.png";F.appendChild(document.createTextNode(z));J.appendChild(F);var D=[1,2,4,8,16];var B=["perms_read","perms_edit","perms_create","perms_delete","perms_move"];for(var H=0;H<D.length;H++){var C=document.createElement("input");C.type="checkbox";C.name=B[H]+"["+A+"]";C.value=D[H];C.title=x[H];F=document.createElement("td");F.appendChild(C);F.className="permissionType";J.appendChild(F);if(y&D[H]){C.checked=true}}if(A=="system-guest"&&q){u.replaceChild(J,q)}else{u.appendChild(J)}if(A=="system-guest"){q=J}};this.loadItems=function(y){jQuery.ajax({url:"/admin/users/getPermissionsOwners/4.xml?limit&search-all-text[]="+encodeURIComponent(y),method:"get",complete:function(z){e.updateItems(z)}})};this.updateItems=function(A){s=null;v=A.responseXML.getElementsByTagName("owner");var C=[];if(!v.length){return}for(var D=0;D<v.length;D++){var z=parseInt(v[D].getAttribute("id"));if(g[z]==undefined){C[C.length]=v[D]}}v=C;if(!v.length){return}var F=null;if(!b){b=document.createElement("div");b.className="symlinkAutosuggest";var H=jQuery(n).offset();b.style.position="absolute";b.style.zIndex=1050;b.style.width=n.clientWidth+"px";b.style.top=(H.top+n.offsetHeight)+"px";b.style.left=H.left+"px";F=document.createElement("ul");b.appendChild(F);document.body.appendChild(b)}h();jQuery(document).mousemove(p);F=b.firstChild;while(F.firstChild){F.removeChild(F.firstChild)}var E=0;for(D=0;D<v.length;D++){var K=v[D].getAttribute("name");var J=document.createElement("li");var G=document.createElement("img");G.src="/images/cms/admin/mac/perm_"+v[D].getAttribute("type")+".png";J.appendChild(G);J.appendChild(document.createTextNode(K));if(v[D].getAttribute("type")=="group"){J.appendChild(document.createElement("br"));var I=document.createElement("span");J.appendChild(I);var y=v[D].getElementsByTagName("user");var L="";for(var B=0;B<y.length;B++){L=L+(B?", ":"")+y[B].getAttribute("name")}I.appendChild(document.createTextNode(L))}J.onmouseover=function(){f(this.suggestIndex)};J.onmouseout=function(){this.className=""};J.onclick=function(){j();m();n.value=""};J.suggestIndex=E;F.appendChild(J);E++}};this.doSearch=function(){var y=n.value;e.loadItems(y)};var f=function(z){if(b.style.display!="none"){var A=b.firstChild;var y=A.childNodes.item(s);if(y){y.className=""}A.childNodes.item(z).className="active";s=z}};var j=function(){if(b&&b.style.display!="none"&&s!==null){var A=v[s].getAttribute("id");var y=v[s].getAttribute("name");var z=v[s].getAttribute("type");if(z!="user"){e.add(A,y,w,true)}else{jQuery.ajax({url:"/udata/users/getUserPermissions/"+A+"/"+window.page_id+"/",method:"get",complete:function(C){var B=C.responseXML.getElementsByTagName("user");var D=w;if(B.length){D=parseInt(jQuery(B[0]).text())}e.add(A,y,D,true)}})}}};var d=function(){if(b){if(l<parseInt(b.style.left)||l>(parseInt(b.style.left)+parseInt(b.offsetWidth))||k<parseInt(b.style.top)||k>(parseInt(b.style.top)+parseInt(b.offsetHeight))){m()}}};var t=function(z){var y=z?z.keyCode:window.event.keyCode;switch(y){case 38:if(v.length&&(s>0||s==null)){f((s===null)?(v.length-1):(s-1))}break;case 40:if(v.length&&(s<(v.length-1)||s==null)){f((s===null)?0:(s+1))}break;case 13:j();m();return false;break;case 27:m();break;default:e.doSearch()}};var h=function(){if(b){var y=jQuery(n).offset();b.style.width=n.clientWidth;b.style.top=y.top+n.offsetHeight;b.style.left=y.left;b.style.display=""}};var m=function(){if(b&&b.style.display!="none"){b.style.display="none";jQuery(document).unbind("mousemove",p)}};var p=function(y){if(!y){l=event.clientX+document.body.scrollLeft;k=event.clientY+document.body.scrollTop}else{l=y.pageX;k=y.pageY}return true};var c=function(y){return(y.firstChild&&y.firstChild.nodeType==3)?y.firstChild.nodeValue:y.nodeValue};r()}function fileControl(name,options){var _self=this;var container=document.getElementById("fileControlContainer_"+name);var select=null;var inputName=options.inputName||name;var imagesOnly=options.imagesOnly||false;var videosOnly=options.videosOnly||false;var folderHash=options.folderHash;var fileHash=options.fileHash;var lang=options.lang||"ru";var fm=options.fm||"flash";var cwd=".";var defaultCwd=".";var loaded=false;var construct=function(){select=document.createElement("select");container.appendChild(select);select.onmouseover=function(){if(!loaded){loadListing()}};window["fileControlSelect_"+name]=select;select.id="fileControlSelect_"+name;select.name=inputName;select.control=_self;select.className="fileControlSelect";if((navigator.userAgent.toLowerCase().indexOf("firefox")!=-1)||(navigator.userAgent.toLowerCase().indexOf("chrome")!=-1)){select.addEventListener("drop",doDrop,false);select.addEventListener("dragexit",dragExit,false);select.addEventListener("dragover",dragExit,false);jQuery(select).addClass("dragNDrop")}var option=document.createElement("option");option.innerHTML="";option.value="";option.selected=true;select.appendChild(option);var img=document.createElement("img");img.src="/images/cms/browse_folder.png";var a=document.createElement("a");a.href="javascript:void(0);";a.onclick=function(){var functionName="show"+fm+"FileBrowser";eval(functionName+"(select.id, defaultCwd, imagesOnly, videosOnly, folderHash, fileHash, lang)")};a.appendChild(img);container.appendChild(a)};function doDrop(event){dragExit(event);var dt=event.dataTransfer;var files=dt.files;var file=files[0];jQuery.ajax({url:"/admin/data/uploadfile/?filename="+file.fileName+"&folder="+base64encode(cwd.substr(1))+(imagesOnly?"&showOnlyImages=1":"")+(videosOnly?"&showOnlyVideos=1":""),type:"POST",processData:false,data:file,complete:function(r,t){_self.updateItem(r)}})}function dragExit(event){event.stopPropagation();event.preventDefault()}var showflashFileBrowser=function(selectId,folder,imageOnly,videoOnly,folder_hash,file_hash,lang){var qs="id="+selectId;var index=0;var file=cwd.replace(/^\.\//,"/")+((index=select.value.lastIndexOf("/"))!=-1?select.value.substr(index):select.value);qs=qs+"&file="+file;if(folder){qs=qs+"&folder="+folder}if(imageOnly){qs=qs+"&image=1"}if(videoOnly){qs=qs+"&video=1"}jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+qs})};var showelfinderFileBrowser=function(selectId,folder,imageOnly,videoOnly,folder_hash,file_hash,lang){var qs="id="+selectId;var index=0;var file=cwd.replace(/^\.\//,"/")+((index=select.value.lastIndexOf("/"))!=-1?select.value.substr(index):select.value);qs=qs+"&file="+file;if(folder){qs=qs+"&folder="+folder}if(imageOnly){qs=qs+"&image=1"}if(videoOnly){qs=qs+"&video=1"}if(typeof(folder_hash)!="undefined"){qs=qs+"&folder_hash="+folder_hash}if(typeof(file_hash)!="undefined"){qs=qs+"&file_hash="+file_hash}if(lang){qs=qs+"&lang="+lang}$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+qs});jQuery("#popupLayer_Filemanager .popupBody").append('<div id="watermark_wrapper"><label for="add_watermark">'+getLabel("js-water-mark")+'</label><input type="checkbox" name="add_watermark" id="add_watermark"></div>')};this.clearItems=function(){while(select.options.length){select.options[0].parentNode.removeChild(select.options[0])}var option=document.createElement("option");option.innerHTML="";option.value=cwd+"/";option.selected=true;select.appendChild(option);loaded=false};var loadListing=function(){loaded=true;jQuery.ajax({url:"/admin/data/getfilelist/?folder="+base64encode(cwd.substr(1))+(imagesOnly?"&showOnlyImages=1":"")+(videosOnly?"&showOnlyVideos=1":""),type:"get",complete:function(r,t){_self.updateItems(r)}})};this.updateItems=function(response){if(!response.responseXML.getElementsByTagName("empty").length){var files=response.responseXML.getElementsByTagName("file");if(!select.options.length){this.add(null,true)}for(var i=0;i<files.length;i++){this.add(files[i].getAttribute("name"))}if(jQuery.browser.msie){var d=select.style.display;select.style.display="none";select.style.display=d}}else{var option=document.createElement("option");option.value="";option.disabled="disable";option.appendChild(document.createTextNode(getLabel("js-files-use_search")));select.appendChild(option)}};this.setFolder=function(name,isDefault){if(name.indexOf("./")!==0){name="."+name}var re=new RegExp("[/]+$","g");name=(name+"").replace(re,"");if(cwd!=name){cwd=name;this.clearItems()}if(isDefault!=undefined&&isDefault){defaultCwd=name}};this.add=function(name,selected){if(name&&!name.length){return}if(!name){name=""}if(name.lastIndexOf("/")!=-1){this.setFolder(name.substr(0,name.lastIndexOf("/")));name=name.substr(name.lastIndexOf("/")+1)}for(var i=0;i<select.options.length;i++){if(select.options[i].innerHTML==name){if(selected){select.options[i].selected=selected}return}}var option=document.createElement("option");option.innerHTML=name;option.value=((cwd.indexOf("./")!=0)?".":"")+(cwd+"/"+name);if(selected!=undefined&&selected){option.selected=true}select.appendChild(option)};this.updateItem=function(response){var files=response.responseXML.getElementsByTagName("file");if(!select.options.length){this.add(null,true)}for(var i=0;i<files.length;i++){this.add(files[i].getAttribute("name"),true)}if(jQuery.browser.msie){var d=select.style.display;select.style.display="none";select.style.display=d}};construct()}(function(){var a=function(){jQuery.get("/umess/inbox/?mark-as-opened=1",function(b){jQuery("message",b).each(function(d,g){var h=jQuery(g).attr("title");var f=jQuery("content",g).text();var c=jQuery("date",g).text();var e=jQuery("sender",g).attr("name");f="<p>"+f+'</p><div class="header">'+c+", "+e+"</div>";jQuery.jGrowl(f,{header:h,life:10000})})});setTimeout(a,15000)}})();