jQuery.ajaxSetup({cache:false});var uPageEditor=function(){var c=[],h=[],l=this,d=false,f=null;var g=enable_meta=false;this.queue=new uRevisionsQueue(this);this.queue_meta=new uRevisionsQueue(this);this.enable=function(){m();l.inspectDocument();l.highlight();uPageEditor.normalizeBoxes();jQuery(window).load(function(){setTimeout(function(){uPageEditor.normalizeBoxes()},250)});g=true;var n=new Date();n.setTime(n.getTime()+(3*24*60*60*1000));jQuery.cookie("eip-editor-state","enabled",{path:"/",expires:n});uPageEditor.onEnable();uPageEditor.message(getLabel("js-panel-message-edit-on"));window.session=new SessionControl(SessionLifetime,1)};this.enableMETA=function(){jQuery("#u-quickpanel-meta").toggle();jQuery("#save_edit_meta").toggle();enable_meta=jQuery("#u-quickpanel-meta").css("display")!="none"};this.disable=function(){m();l.unhighlight();g=false;jQuery.cookie("eip-editor-state","",{path:"/",expires:0});uPageEditor.onDisable();uPageEditor.message(getLabel("js-panel-message-edit-off"));if(l.queue.isModified()){if(confirm(getLabel("js-panel-message-save-confirm"))){l.submit()}}window.session.destroy()};this.isEnabled=function(){return g};this.isEnabledMeta=function(){return enable_meta};this.cancel=function(){m();this.queue.cancel();uPageEditor.message(getLabel("js-panel-message-changes-revert"))};this.submit=function(){m();if(this.queue_meta.length()){if(this.queue.length()){this.queue.submit()}this.submitMeta()}else{this.queue.submit()}};this.submitMeta=function(){if(this.queue_meta.length()){this.queue_meta.submit();EIP_META.title=jQuery("#u-quickpanel-metatitle").val();EIP_META.meta_descriptions=jQuery("#u-quickpanel-metadescription").val();EIP_META.meta_keywords=jQuery("#u-quickpanel-metakeywords").val()}if(this.isEnabledMeta()){jQuery("#u-quickpanel #meta").trigger("click")}};this.back=function(n){m();this.queue.back(n)};this.forward=function(n){m();this.queue.forward(n)};this.inspectDocument=function(){c=[];h=[];var n=uPageEditor.getRegions();n.each(function(o,p){if(jQuery(p).css("display")=="none"){return}b(p)})};var a=function(o,n){if(!n||!o){return false}if(n==o){return true}if(o.parentNode){return a(o.parentNode,n)}return false};var j=function(n){n=jQuery.trim(n);return n.replace(/<br ?\/?>/g,"").replace(/<p><\/p>/g,"")};this.highlight=function(o,n){if(d){this.unhighlight()}d=true;jQuery(c).each(function(p,q){if(a(q,o)==false){l.highlightNode(q)}});if(!n){jQuery(h).each(function(p,q){if(a(q,o)==false){l.highlightListNode(q)}})}uPageEditor.onRepaint();this.markInversedBoxes()};this.markInversedBoxes=function(n){setTimeout(function(){if(!n){n=jQuery(".u-eip-edit-box")}n.each(function(p,r){var o=new RGBColor(jQuery(r).css("color"));var q=o.toHash();var s=(q.red/255+q.green/255+q.blue/224)/3;if(s>=0.9){jQuery(r).addClass("u-eip-edit-box-inversed")}})},500)};this.unhighlight=function(){jQuery(".u-eip-edit-box").each(function(n,p){p=jQuery(p);var q=p.attr("umi:empty");if(q&&(p.attr("tagName")!="IMG")&&(p.html()==q)){p.html("")}p.attr("title","")});var o=jQuery(".u-eip-edit-box");o.removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-edit-box-inversed");o.unbind("click");o.unbind("mouseover");o.unbind("mouseout");o.unbind("mousedown");o.unbind("mouseup");jQuery(".u-eip-add-box, .u-eip-add-button, .u-eip-del-button").remove();jQuery(".u-eip-sortable").sortable("destroy");jQuery(".u-eip-sortable").removeClass("u-eip-sortable")};this.edit=function(p,o){if(jQuery(p).hasClass("u-eip-deleted")||jQuery(p).parents().hasClass("u-eip-deleted")){uPageEditor.message(getLabel("js-panel-message-cant-edit"));return false}m();jQuery(".eip-del-button").remove();f=new editBox(this,p,"",o);jQuery(p).removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-empty-field u-eip-edit-box-inversed");jQuery(p).addClass("u-eip-editing");var q=j(jQuery(p).attr("umi:empty"));if(q&&j(jQuery(p).html())==q){jQuery(p).html("&nbsp;");var n=jQuery(p).attr("class");jQuery(p).removeClass("u-eip-empty-field")}};this.editMETA=function(p){if(!p.name){return}var n=EIP_META[p.name].replace(/&#039;/g,"'").replace(/&quot;/g,'"');if(n==p.value){return}var o=this.queue_meta.add({"element-id":EIP_META.element_id,"object-id":EIP_META.object_id,"field-name":p.name,"original-value":EIP_META[p.name],"new-value":p.value,"disable-back-fwd":true})};var m=function(){if(f){f.finish(true);f=null}};var b=function(n){if(n.tagName=="TABLE"){return}if(jQuery(n).attr("umi:field-name")){c.push(n)}if(jQuery(n).attr("umi:module")){h.push(n)}if(jQuery.browser.msie){jQuery(n).parents("a:first").each(function(){var o=this.href;jQuery(this).click(function(p){if(p.ctrlKey){window.location.href=o}});this.removeAttribute("href")})}};this.getEditNodes=function(){return c};this.getListNodes=function(){return h};this.highlightNode=function(q){var o,t,p,n;if(!jQuery(q).attr("umi:field-name")){return}if(!uPageEditor.searchAttr(q,20)){return}var r=j(jQuery(q).attr("umi:empty"));if(r&&j(jQuery(q).html())==""&&(jQuery(q).attr("tagName")!="IMG")){try{jQuery(q).html(r)}catch(s){}jQuery(q).addClass("u-eip-empty-field")}jQuery(q).addClass("u-eip-edit-box");if(q.tagName=="A"||q.parentNode.tagName=="A"||jQuery("a",q).size()>0){jQuery(q).attr("title",getLabel("js-panel-link-to-go"));jQuery(q).bind("dblclick",function(){return false})}else{jQuery(q).attr("title","")}this.markInversedBoxes(jQuery(q))};this.highlightListNode=function(F){var v,u,E,B;if(!jQuery(F).attr("umi:module")){return}var w=document.createElement("div");document.body.appendChild(w);F.boxNode=w;var I=uPageEditor.nodePositionInfo(F);if(!I.x&&!I.y){return}jQuery(w).attr("class","u-eip-add-box");jQuery(w).css({position:"absolute",width:I.width,height:I.height,left:I.x,top:I.y});var n=document.createElement("a");F.addButtonNode=n;jQuery(n).attr({"class":"u-eip-add-button",}).html(getLabel("js-panel-add"));jQuery(n).hover(function(){jQuery(this).addClass("u-eip-add-button-hover")},function(){jQuery(this).removeClass("u-eip-add-button-hover")});var s="bottom";var r="left";var A;if(A=jQuery(F).attr("umi:button-position")){var o=A.split(/ /);if(o.length==2){s=o[0];r=o[1]}}if(jQuery(F).attr("umi:add-method")!="none"){uPageEditor.placeWith(F,n,s,r);var z=jQuery(F).attr("umi:element-id");var p=jQuery(F).attr("umi:module");var q=jQuery(F).attr("umi:method");jQuery(n).bind("mouseup",function(){var x=jQuery(F).attr("umi:region");var K=jQuery(F).attr("umi:add-method");var J=uPageEditor.searchRow(F);if(J&&(x=="list")&&(K!="popup")){l.inlineAddPage(F)}else{if(l.queue.isModified()){uPageEditor.message(getLabel("js-panel-message-save-first"));return}var y="/admin/content/eip_add_page/choose/"+parseInt(z)+"/"+p+"/"+q+"/";jQuery.openPopupLayer({name:"CreatePage",title:getLabel("js-eip-create-page"),url:y})}});jQuery(n).hover(function(){jQuery(w).addClass("u-eip-add-box-hover")},function(){jQuery(w).removeClass("u-eip-add-box-hover")});document.body.appendChild(n)}var H=null,t=null,D=false;if("sortable"==jQuery(F).attr("umi:sortable")){jQuery(F).addClass("u-eip-sortable");var C=new Array();var G=0;jQuery("*").each(function(J,K){if(K.tagName=="TABLE"){return}if(jQuery(K).attr("umi:sortable")!="sortable"){return}if(jQuery(K).attr("umi:module")!=p){return}var y=false;jQuery(K).parents().each(function(M,L){if(L==F){y=true}});if(y){return}var x=false;jQuery("*",K).each(function(M,L){if(L==F){x=true}});if(x){return}C.push(K)});jQuery(F).sortable({tolerance:"pointer",cursor:"move",dropOnEmpty:true,forcePlaceholderSize:true,placeholder:"u-eip-sortable-placeholder",connectWith:C,start:function(J,K){var L=K.item[0];var x=L.nextSibling;do{if(!x){break}if(x.nodeType!=1){continue}if(uPageEditor.searchRowId(x)){break}}while(x=x.nextSibling);H=x;var y=uPageEditor.searchAttr(L.parentNode,function(M){return jQuery(M).attr("umi:region")=="list"});t=parseInt(y?y["element-id"]:null);D=true},update:function(L,M){if(!D){return}else{D=false}var K=M.item[0];var N=uPageEditor.searchRowId(K);var x=K.nextSibling;do{if(!x){break}if(x.nodeType!=1){continue}if(uPageEditor.searchRowId(x)){break}}while(x=x.nextSibling);var J=x?uPageEditor.searchRowId(x):null;var y=uPageEditor.searchAttr(K.parentNode,function(P){return jQuery(P).attr("umi:region")=="list"});var O=parseInt(y?y["element-id"]:null);if(O==0||t==0){if(O!=t){return false}}jQuery.get("/admin/content/eip_move_page/"+N+"/"+J+".xml?parent-id="+O,function(Q){var P=jQuery("error",Q);if(P.size()){uPageEditor.message(P.text());return}uPageEditor.message(getLabel("js-panel-message-page-moved"))});H=null;t=null;uPageEditor.normalizeBoxes()}})}return w};var e=function(w,r,t,x){var o=jQuery(w).clone();var v=r?r:t;var q=r?"umi:element-id":"umi:object-id";var u=function(y){if(jQuery(y).attr("tagName")=="TABLE"){return}if(jQuery(y).attr("umi:field-name")){var z=jQuery(y).attr("umi:empty");if(jQuery(y).attr("tagName")=="IMG"&&z){jQuery(y).attr("src",z)}else{jQuery(y).html(z?z:"")}jQuery(y).addClass("u-eip-empty-field");c[c.length]=y}if(jQuery(y).attr(q)){jQuery(y).attr(q,v)}};if(!w){alert("Error, umi:region=row is not defined");return false}jQuery("*",o).each(function(y,z){var z=jQuery(z);if(z.attr("umi:region")=="row"){z.remove()}});var s=w.parentNode;var p=(x)?o.prependTo(s):o.appendTo(s);if(jQuery(p).attr(q)){jQuery(p).attr(q,v)}u(p);var n=jQuery("*",p);n.each(function(y,z){b(z);l.highlightListNode(z);u(z)});uPageEditor.onAfterInlineAdd(p);return p};this.inlineAddPage=function(r){var s=parseInt(jQuery(r).attr("umi:element-id"));var o=jQuery(r).attr("umi:type-id");var q=uPageEditor.searchRow(r);var n=(jQuery(r).attr("umi:method")=="lastlist");var p="/admin/content/eip_quick_add/"+s+".xml?type-id="+o;if(jQuery(r).attr("umi:module")!="data"){p+="&force-hierarchy=1"}jQuery.get(p,function(x){var w=jQuery("error",x);if(w.size()){uPageEditor.message(w.text());return}var v=parseInt(jQuery("data",x).attr("element-id"));var t=parseInt(jQuery("data",x).attr("object-id"));var u=e(q,v,t,n);u.addClass("u-eip-newitem");uPageEditor.normalizeBoxes()})};this.bindEventsMeta=function(){var n=jQuery("#u-quickpanel-meta input").not('input[type="submit"]');n.bind("blur",function(o){l.editMETA(o.target)});n.bind("keyup mousedown blur",function(q){var o=this.value.length;var p=q.keycode;if(o>255){this.value=this.value.substring(0,255)}else{var r=this.id+"-count";jQuery("#"+r).html(o)}}).trigger("keyup")};this.bindEvents=function(){var n=jQuery(".u-eip-edit-box");n.die("click");n.die("drop");n.die("dragexit");n.die("dragover");n.unbind("click");n.unbind("drop");n.unbind("dragexit");n.unbind("dragover");var o="click";if(navigator.userAgent.toLowerCase().indexOf("firefox")||navigator.userAgent.toLowerCase().indexOf("chrome")){o=o+" drop";n.live("dragexit",function(p){p.stopPropagation();p.preventDefault()});n.live("dragover",function(p){p.stopPropagation();p.preventDefault()})}n.live(o,function(s){var r=s.target;if(s.ctrlKey){return true}var q=(typeof r.onclick=="function")?r.onclick:function(){};var t=function(){return false};r.onclick=t;setTimeout(function(){if(r&&q!=t){r.onclick=q}},100);for(var p=0;p<25;p++){if(!r){return false}if(r.tagName!="TABLE"&&jQuery(r).attr("umi:field-name")){break}r=r.parentNode}if(!r){return}s.stopPropagation();s.stopImmediatePropagation();s.preventDefault();l.edit(r,s.originalEvent.dataTransfer?s.originalEvent.dataTransfer.files:null);s.stopPropagation();s.stopImmediatePropagation();s.preventDefault();return false});jQuery(document).unbind("keydown");jQuery(document).keydown(function(p){if(p.keyCode==113){if(g){l.disable();jQuery("#u-quickpanel #edit").html('<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-edit")+" (F2)")}else{l.enable();jQuery("#u-quickpanel #edit").html('<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-view")+" (F2)")}return false}if(p.ctrlKey){switch(p.keyCode){case 83:l.submit();break;case 90:l.back(1);break;case 89:l.forward(1);break;default:return true}return false}return true});window.onbeforeunload=function(){if(l.queue.isModified()||!l.queue.isSaved()){return getLabel("js-panel-message-save-before-exit")}}};this.deletePage=function(o,n){this.queue.add({"element-id":o,"object-id":n,"delete-action":true});uPageEditor.normalizeBoxes();uPageEditor.message("<strong>"+getLabel("js-panel-message-delete-after-save")+"</strong>")};var k=function(){var n=null;var o=function(){jQuery(".eip-del-button").remove()};jQuery(".u-eip-edit-box").live("mouseover",function(){jQuery(this).addClass("u-eip-edit-box-hover");var r=uPageEditor.searchAttr(this,20);if(jQuery(this).attr("umi:delete")&&(r["element-id"]||r["object-id"])){if(n){clearInterval(n)}o();var s=document.createElement("div");jQuery(s).attr("class","eip-del-button");document.body.appendChild(s);uPageEditor.placeWith(this,s,"right","middle");jQuery(s).bind("mouseover",function(){if(n){clearInterval(n)}});jQuery(s).bind("mouseout",function(){n=setTimeout(o,500)});var q=r["element-id"];var p=r["object-id"];jQuery(s).bind("click",function(){l.deletePage(q,p)})}else{o()}this.onclick=function(t){this.onclick=function(){return true};if(window.event){return window.event.ctrlKey}else{return t.ctrlKey}}});jQuery(".u-eip-edit-box-hover").live("mouseout",function(q){jQuery(this).removeClass("u-eip-edit-box-hover");if(jQuery(this).attr("umi:delete")){var p=this;n=setTimeout(o,500)}this.onclick=function(){return true}});window.onresize=function(){uPageEditor.normalizeBoxes()};l.bindEvents()};k()};uPageEditor.onInit=typeof uPageEditorOnInit=="function"?uPageEditorOnInit:function(){};if(typeof uPageEditor.onStep!="function"){uPageEditor.onStep=function(){}}if(typeof uPageEditor.onEnable!="function"){uPageEditor.onEnable=function(){}}if(typeof uPageEditor.onDisable!="function"){uPageEditor.onDisable=function(){}}if(typeof uPageEditor.onRepaint!="function"){uPageEditor.onRepaint=function(){}}uPageEditor.nodePositionInfo=function(a){var a=jQuery(a),b=jQuery(a).css("display");return{width:a.innerWidth(),height:a.innerHeight(),x:a.offset().left,y:a.offset().top}};uPageEditor.applyStyles=function(c,e){var b=["font-size","font-family","font-name","margin-left","margin-right","margin-top","margin-bottom","font-weight"],a;c=jQuery(c);e=jQuery(e);for(a in b){var d=b[a];e.css(d,c.css(d))}e.width(c.outerWidth());e.height(c.outerHeight())};uPageEditor.getRegions=function(){if(jQuery.browser.mozilla){var a=jQuery("*[umi\\:field-name], *[umi\\:module]");if(a.size()){return a}}return jQuery("*",document.body)};uPageEditor.message=function(a){jQuery.jGrowl("<p>"+a+"</p>",{header:"UMI.CMS",life:10000})};uPageEditor.closeMessages=function(){jQuery("#jGrowl").find("div.jGrowl-notification").each(function(){jQuery(this).trigger("jGrowl.beforeClose");jQuery(this).remove()})};uPageEditor.normalizeBoxes=function(a){var b=uPageEditor.get();jQuery(b.getEditNodes()).each(function(c,d){uPageEditor.markBoxes(d)});jQuery(b.getListNodes()).each(function(h,c){if(!c.boxNode){return}var j=uPageEditor.nodePositionInfo(c.boxNode);var f=uPageEditor.nodePositionInfo(c);jQuery(c.boxNode).css({width:f.width,height:f.height,left:f.x,top:f.y});var e=c.addButtonNode;var k="bottom",g="left";if(e){var l;if(l=jQuery(c).attr("umi:button-position")){var d=l.split(/ /);if(d.length==2){k=d[0];g=d[1]}}uPageEditor.placeWith(c,e,k,g)}});uPageEditor.onRepaint()};uPageEditor.markBoxes=function(c){var b=uPageEditor.get(),e=jQuery(c);var d=uPageEditor.searchAttr(c,10),a;d["field-name"]=e.attr("umi:field-name");if(a=b.queue.searchByInfo(d)){e.addClass("u-eip-modified");if(a.isDeleteAction()){e.addClass("u-eip-deleted")}}else{e.unbind("mouseover mouseout");e.removeClass("u-eip-modified u-eip-deleted")}};uPageEditor.searchAttr=function(b,a,d,e){if(!a||!b){return false}if(b.tagName=="BODY"||b.tagName=="TABLE"){return false}var c=jQuery(b);if(typeof e!="function"||e(b)){if(c.attr("umi:element-id")){return{"element-id":c.attr("umi:element-id")}}if(c.attr("umi:object-id")){return{"object-id":c.attr("umi:object-id")}}}if(b.parentNode){return uPageEditor.searchAttr(b.parentNode,--a,false,e)}return false};uPageEditor.searchRow=function(b){var a=null;jQuery("*",b).each(function(e,d){if(a){return}var c=jQuery(d).attr("umi:region");if(!c){return}a=d});return a};uPageEditor.searchRowId=function(b){var a=null;if(a=jQuery(b).attr("umi:element-id")){return a}jQuery("*",b).each(function(d,c){if(a){return}a=jQuery(c).attr("umi:element-id")});return a};uPageEditor.placeWith=function(a,b,l,f){if(!a||!b){return}var d=uPageEditor.nodePositionInfo(a);var j=jQuery(b);var k,h;switch(l){case"top":h=d.y-parseInt(j.css("height"));break;case"right":k=d.x+d.width;break;case"left":k=d.x-j.width();break;default:h=d.y+d.height}if(l=="top"||l=="bottom"){switch(f){case"right":k=d.x+d.width-j.width();break;case"middle":case"center":if(d.width-parseInt(j.css("width"))>0){k=d.x+Math.ceil((d.width-j.width())/2)}else{k=d.x}break;default:k=d.x;k+=parseInt(jQuery(a).css("padding-left"))}}else{switch(f){case"top":h=d.y;break;case"bottom":h=d.y+d.height-parseInt(j.css("height"));break;default:if(d.height-parseInt(j.css("height"))>0){h=d.y+Math.ceil((d.height-parseInt(j.css("height")))/2)}else{h=d.y}}}var m=j.width()+k;var c=jQuery(window);if(m>c.width()){k=c.width()-j.width()-30}try{j.css({position:"absolute",left:k+"px",top:h+"px","z-index":560})}catch(g){}};uPageEditor.instance=null;uPageEditor.get=function(){if(!uPageEditor.instance){uPageEditor.instance=new uPageEditor;uPageEditor.onInit()}return uPageEditor.instance};uPageEditor.cleanupHTML=function(b){var a=true;b=b.replace(/<![\s\S]*?--[ \t\n\r]*>/ig," ");b=b.replace(/<!--.*?-->/ig," ");if(jQuery.browser.mozilla){b=b.replace(/<\/?(style|font|title).*[^>]*>/ig,"")}b=b.replace(/<\/?(title|style|font|meta)\s*[^>]*>/ig,"");b=b.replace(/\s*mso-[^:]+:[^;""]+;?/ig,"");b=b.replace(/<\/?o:[^>]*\/?>/ig,"");b=b.replace(/ style=['"]?[^'"]*['"]?/ig,"");if(a){b=b.replace(/ class=['"]?[^'">]*['"]?/ig,"")}b=b.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/ig," ");b=b.replace(/<span\s*[^>]*>/ig,"");b=b.replace(/<\/span\s*[^>]*>/ig,"");b=b.replace(/<\/(b|i|s|u|strong|center)>[\t\n]*<\1[^>]*>/gi,"");b=b.replace(/<\/(b|i|s|u|strong|center)>\s*<\1[^>]*>/gi," ");b=b.replace(/<(b|i|s|u|strong|center)[^>]*>[\s\t\n\xC2\xA0]*<\/\1>/gi,"");b=b.replace(/(\t|\n)/gi," ");b=b.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){b=b.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}return b};Date.prototype.getFormattedDate=function(c){var j=function(k){return(k>=10)?k:"0"+k};var f=this.getFullYear();var d=j(this.getMonth()+1);var g=j(this.getDate());var h=j(this.getHours());var b=j(this.getMinutes());var a=/NaN/;if(c){if((a.exec(f)!=null)||(a.exec(d)!=null)||(a.exec(g)!=null)||(a.exec(h)!=null)||(a.exec(b)!=null)){var e=new Date();return j(e.getDate())+"."+j(e.getMonth()+1)+"."+e.getFullYear()+" "+j(e.getHours())+":"+j(e.getMinutes())}return f+"-"+d+"-"+g+" "+h+":"+b}else{if((a.exec(h)!=null)||(a.exec(b)!=null)){var e=new Date();return j(e.getHours())+":"+j(e.getMinutes())}return h+":"+b}};Date.createDate=function(h){var c=new Date;var f=/-/;if(f.exec(h)!=null){var e=h.substr(0,4);var g=h.substr(5,2)-1;var b=h.substr(8,2);var a=h.substr(11,2);var d=h.substr(14,2)}else{var e=h.substr(6,4);var g=h.substr(3,2)-1;var b=h.substr(0,2);var a=h.substr(11,2);var d=h.substr(14,2)}c.setYear(e);c.setMonth(g);c.setDate(b);c.setHours(a);c.setMinutes(d);return c};uPageEditor.onPasteCleanup=true;uPageEditor.onAfterInlineAdd=function(){};var editBox=function(editor,node,boxNode,filesDataTransfer){var editorInstance,boxDomNode,domNode,elementId="",objectId="",fieldName,fieldType,originalValue,newValue,fieldParams,files=filesDataTransfer;var self=this,cleanedUp=false;var voidFinish=function(apply){self.cleanup()};this.finish=voidFinish;this.cleanup=function(){if(cleanedUp){return}else{cleanedUp=true}editorInstance.bindEvents();this.finish=voidFinish;editorInstance.highlightNode(domNode);jQuery(".u-eip-add-button").css("display","block");uPageEditor.normalizeBoxes();editBox.currentInstance=null;domNode.blur();jQuery(domNode).removeClass("u-eip-editing")};var onLoadValue=function(value,type,params){originalValue=value;fieldType=type;fieldParams=params;switch(fieldType){case"relation":drawRelationEditor();break;case"video_file":case"file":drawImageEditor(false);break;case"img_file":drawImageEditor(true);break;case"date":drawDateEditor();if(""==objectId){originalValue=""}break;case"wysiwyg":drawHTMLEditor(true);break;case"boolean":drawBooleanEditor();break;case"text":case"int":case"counter":case"string":case"float":case"tags":case"price":drawTextEditor();break;case"symlink":drawSymlinkEditor();break;default:alert('Unkown field type "'+fieldType+'"')}jQuery(".u-eip-add-button, .u-eip-add-box").css("display","none")};var commit=function(){if(fieldType=="string"&&typeof newValue=="string"){newValue=newValue.replace(/\n/g," ").replace(/<br>/g," ").replace(/[\s]{2,}/g," ");jQuery(domNode).html(newValue)}if(newValue!=originalValue){var revision=editorInstance.queue.add({"element-id":elementId,"object-id":objectId,"field-name":fieldName,"original-value":originalValue,"new-value":newValue,"field-type":fieldType,params:fieldParams});revision.apply()}};var bindFinishEvent=function(){jQuery(document).bind("click",function(e){if(jQuery(e.target).attr("contentEditable")=="true"){return true}if(jQuery(e.target).attr("class")=="eip-ui-element"){return true}if(jQuery(e.target).attr("class")=="ui-datepicker"){return true}if(jQuery(e.target).parents(".eip-ui-element, .ui-datepicker, .ui-datepicker-title, .ui-datepicker-header, .ui-datepicker-calendar").size()){return true}var parents=jQuery(e.target).parents();for(var i=0;i<parents.size();i++){var pNode=parents[i];if(pNode.tagName=="TABLE"){continue}if(pNode.tagName=="BODY"){break}if(jQuery(pNode).attr("contentEditable")=="true"){return true}if(jQuery(pNode).attr("class")&&jQuery(pNode).attr("class").indexOf("mceEditor")!=-1){return true}}self.finish(true)})};var drawTextEditor=function(allowHTMLTags){var sourceValue=jQuery(domNode).html();jQuery(domNode).html(originalValue?originalValue:"&nbsp;");jQuery(domNode).attr("contentEditable",true);jQuery(domNode).blur().focus();self.finish=function(apply){self.finish=function(){};jQuery(document).unbind("keyup");jQuery(document).unbind("keydown");jQuery(document).unbind("click");jQuery(domNode).attr("contentEditable",false);jQuery(".u-eip-sortable").sortable("enable");if(apply){newValue=jQuery(domNode).html();if(newValue==" "||newValue=="&nbsp;"){newValue="";jQuery(domNode).html(newValue)}if(fieldType!="wysiwyg"&&fieldType!="text"){newValue=jQuery.trim(newValue);if(newValue.substr(-4,4)=="<br>"){newValue=newValue.substr(0,newValue.length-4)}}else{newValue=newValue.replace(/%[A-z0-9_]+(?:%20)+[A-z0-9_]+%28[A-z0-9%]*%29%/gi,unescape)}commit()}else{jQuery(domNode).html(sourceValue)}self.cleanup()};bindFinishEvent();var prevWidth=jQuery(domNode).width();var prevHeight=jQuery(domNode).height();var timeoutId=null;jQuery(document).bind("keyup",function(){if(prevWidth!=jQuery(domNode).width()||prevHeight!=jQuery(domNode).height()){prevWidth=jQuery(domNode).width();prevHeight=jQuery(domNode).height();if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(function(){uPageEditor.normalizeBoxes();timeoutId=null},1000)}});if(!allowHTMLTags&&fieldType!="wysiwyg"){jQuery(document).bind("keyup",function(e){var html=jQuery(domNode).html();var originalHtml=html;html=html.replace(/<!--[\w\W\n]*?-->/mig,"");html=html.replace(/<style[^>]*>[\w\W\n]*?<\/style>/mig,"");html=html.replace(/<([^>]+)>/mg,"");html=html.replace(/(\t|\n)/gi," ");html=html.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){html=html.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}if(html!=originalHtml){domNode.innerHtml=html}})}jQuery(".u-eip-sortable").sortable("disable");domNode.focus();var prevLength=null;jQuery(document).bind("keydown",function(e){if(e.keyCode==46){prevLength=jQuery(domNode).html().length}});jQuery(document).bind("keyup",function(e){if(e.keyCode==46){if(prevLength==jQuery(domNode).html().length){if(prevLength==1){jQuery(domNode).html("")}}}});jQuery(document).bind("keydown",function(e){if(e.keyCode==13&&fieldType!="wysiwyg"&&fieldType!="text"){self.finish(true);return false}if(e.keyCode==27){self.finish(false);return false}return true})};var drawHTMLEditor=function(){drawTextEditor();jQuery(document).unbind("keydown");if(uPageEditor.onPasteCleanup){var ctrl=false;var shift=false;var vkey=false;var ins=false;jQuery(document).bind("keyup",function(e){if((e.keyCode==86||ctrl)||(e.keyCode==45&&shift)){var html=uPageEditor.cleanupHTML(jQuery(domNode).html());if(html!=jQuery(domNode).html()){jQuery(domNode).html(html)}if(ctrl&&!e.ctrlKey){ctrl=false}if(shift&&!e.shiftKey){shift=false}}switch(e.keyCode){case 16:if(!ins){shift=false}break;case 17:if(!vkey){ctrl=false}break;case 45:ins=false;break;case 86:vkey=false;break}}).bind("keydown",function(e){switch(e.keyCode){case 16:shift=true;break;case 17:ctrl=true;break;case 45:ins=true;break;case 86:vkey=true;break}})}var editor={};switch(uPageEditor.wysiwyg){case"tinymce":var date=new Date();domNode.id=editor.id="mceEditor-"+date.getTime();tinyMCE.execCommand("mceAddControl",true,editor.id);editor.destroy=function(){var oldNode=jQuery("#"+editor.id),newNode=jQuery("#"+editor.id+"_parent"),frame=jQuery("iframe",newNode)[0],content;if(ie&&(typeof document.documentMode=="undefined"||document.documentMode<7)){content=window.frames[window.frames.length-1].document.body.innerHTML}else{content=frame.contentDocument.body.innerHTML}oldNode.html(content);newNode.remove();oldNode.css("display","");oldNode[0].id=""};break;default:editor=new inlineWYSIWYG(domNode)}var finish=self.finish;self.finish=function(apply){editor.destroy();finish(apply);uPageEditor.get().bindEvents()}};var drawImageEditor=function(imageOnly){var folder="./images/cms/data/",filename="";self.finish=function(apply){if(apply){commit()}self.cleanup()};if(originalValue){originalValue=originalValue.toString();var arr=originalValue.split(/\//g);fileName=arr[arr.length-1];folder="."+originalValue.substr(0,originalValue.length-fileName.length-1)}var qs="folder="+folder;if(originalValue){qs+="&file="+originalValue}if(imageOnly){qs+="&image=1"}if(files&&files.length){var file=files[0];jQuery.ajax({url:"/admin/data/uploadfile/?filename="+file.fileName+"&"+qs,type:"POST",processData:false,data:file,complete:function(r,t){var value=jQuery("file",r.responseXML).attr("path");if(value){if(typeof value=="object"){value=value[0]}newValue=value?value.toString():"";self.finish(true)}else{self.finish()}}})}else{jQuery.ajax({url:"/admin/data/get_filemanager_info/",data:"folder="+folder+"&file="+originalValue,dataType:"json",complete:function(data){data=eval("("+data.responseText+")");var folder_hash=data.folder_hash;var file_hash=data.file_hash;var lang=data.lang;var fm=data.filemanager;var functionName="draw"+fm+"ImageEditor";eval(functionName+"(qs, lang, folder_hash, file_hash)")}})}};var drawflashImageEditor=function(qs,lang,folder_hash,file_hash){jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+qs,afterClose:function(value){if(value){if(typeof value=="object"){value=value[0]}newValue=value?value.toString():"";self.finish(true)}else{self.finish()}}})};var drawelfinderImageEditor=function(qs,lang,folder_hash,file_hash){qs=qs+"&lang="+lang+"&file_hash="+file_hash+"&folder_hash="+folder_hash;jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:660,height:530,url:"/styles/common/other/elfinder/umifilebrowser.html?"+qs,afterClose:function(value){if(value){if(typeof value=="object"){value=value[0]}newValue=value?value.toString():"";self.finish(true)}else{self.finish()}}});jQuery("#popupLayer_Filemanager .popupBody").append('<div id="watermark_wrapper"><label for="add_watermark">'+getLabel("js-water-mark")+'</label><input type="checkbox" name="add_watermark" id="add_watermark"></div>')};var drawDateEditor=function(){var date=Date.createDate(originalValue);if(!date){date=new Date}originalValue=date.getFormattedDate(true);drawTextEditor();var textFinish=self.finish;var position=uPageEditor.nodePositionInfo(domNode);var node=jQuery("#u-datepicker-input");if(!node.size()){node=document.createElement("input");node.id="u-datepicker-input";document.body.appendChild(node)}self.finish=function(apply){jQuery(node).datepicker("destroy");jQuery(".ui-datepicker-trigger").remove();textFinish(apply)};jQuery(node).css({position:"absolute",left:(position.x+position.width+5),top:(position.y),width:"1",height:"1",visibility:"hidden","font-size":"62.5%","z-index":560});var time=date.getFormattedDate(false);jQuery(node).datepicker(jQuery.extend({showOn:"button",buttonImage:"/styles/common/other/calendar/icons_calendar_buttrefly_eip.png",buttonImageOnly:true,dateFormat:"yy-mm-dd",defaultDate:date,onSelect:function(dateText){newValue=dateText+" "+time;jQuery(domNode).html(newValue);jQuery(domNode).focus()}},jQuery.datepicker.regional.ru));uPageEditor.placeWith(domNode,jQuery(".ui-datepicker-trigger"),"right","middle")};var drawRelationEditor=function(){jQuery(document).one("mouseup",function(){setTimeout(function(){bindFinishEvent()},100)});setTimeout(function(){jQuery(document).die("mouseup");bindFinishEvent()},1000);var position=uPageEditor.nodePositionInfo(domNode);var selectBox=document.createElement("select");var searchBox=document.createElement("input");document.body.appendChild(selectBox);if(fieldParams["guide-id"]&&fieldParams["public"]){var relationButton=document.createElement("input");relationButton.type="button";relationButton.value=" ";relationButton.id="relationButton"+fieldParams["guide-id"];relationButton.className="relationAddButton";document.body.appendChild(relationButton)}jQuery(selectBox).attr("class","eip-ui-element");jQuery(selectBox).css({position:"absolute",left:position.x,top:position.y,"z-index":1100});uPageEditor.applyStyles(domNode,selectBox);jQuery(domNode).css("visibility","hidden");if(fieldParams.multiple){jQuery(selectBox).attr("multiple","multiple");jQuery(selectBox).attr("size",3)}var i;for(i in originalValue){var option=document.createElement("option");jQuery(option).attr("value",i);jQuery(option).attr("selected","selected");jQuery(option).html(originalValue[i]);selectBox.appendChild(option)}jQuery(selectBox).focus();jQuery(selectBox).attr("name","rel_input");jQuery(selectBox).attr("id","relationSelect"+fieldParams["guide-id"]);document.body.appendChild(searchBox);uPageEditor.applyStyles(domNode,searchBox);jQuery(searchBox).attr({id:"relationInput"+fieldParams["guide-id"],"class":"eip-ui-element",name:"rel_input_new"});var sourceUri=uRevisionsQueue.getEditUri(fieldName,"guides");var control=new relationControl(fieldParams["guide-id"],null,true,sourceUri);self.finish=function(){jQuery(domNode).css("visibility","visible");newValue=control.getValue();commit();jQuery(selectBox).resizable("destroy");jQuery(selectBox).remove();jQuery(searchBox).remove();jQuery(relationButton).remove();jQuery("#u-ep-search-trigger").remove();self.cleanup()};control.loadItemsAll();if(fieldParams.multiple){var minHeight=jQuery(selectBox).height(),maxHeight=350;if(minHeight<150){minHeight=75;jQuery(selectBox).css("height",minHeight)}jQuery(selectBox).resizable({minWidth:jQuery(selectBox).width(),maxWidth:jQuery(selectBox).width(),minHeight:minHeight,maxHeight:maxHeight});jQuery(".ui-wrapper").css("z-index","1100")}jQuery(searchBox).css({position:"absolute",width:jQuery(selectBox).width(),left:position.x,top:(position.y+jQuery(selectBox).height()+5),"z-index":1111});jQuery(relationButton).css({position:"absolute",left:(position.x+jQuery(searchBox).width()+5),top:(position.y+jQuery(selectBox).height()+Math.round((jQuery(searchBox).height()-jQuery(relationButton).height())/2)),"z-index":1112})};var drawSymlinkEditor=function(){alert('В данный момент поля типа "Ссылка на дерево" редактировать через edit-in-place нельзя')};var drawBooleanEditor=function(){var position=uPageEditor.nodePositionInfo(domNode);if(jQuery(domNode).attr("tagName")=="INPUT"&&jQuery(domNode).attr("type")=="checkbox"){setTimeout(function(){newValue=originalValue?0:1;jQuery(domNode).attr("checked",newValue);commit();self.cleanup()},300);return}var checkboxNode=document.createElement("input");checkboxNode.type="checkbox";document.body.appendChild(checkboxNode);self.finish=function(apply){if(apply){newValue=checkboxNode.checked?1:0;commit()}jQuery(checkboxNode).remove();jQuery(domNode).css("visibility","visible");self.cleanup()};checkboxNode.checked=originalValue;jQuery(checkboxNode).attr("class","eip-ui-element eip-ui-boolean");jQuery(checkboxNode).css({position:"absolute",left:position.x,top:position.y,"z-index":1100});uPageEditor.applyStyles(domNode,checkboxNode);jQuery(domNode).css("visibility","hidden");jQuery(checkboxNode).click(function(){self.finish(true)})};var init=function(node){if(editBox.currentInstance){editBox.currentInstance.finish(true)}editBox.currentInstance=self;domNode=node;if(ids=uPageEditor.searchAttr(node,20,true)){if(ids["element-id"]){elementId=parseInt(ids["element-id"])}if(ids["object-id"]){objectId=parseInt(ids["object-id"])}}fieldName=jQuery(node).attr("umi:field-name");if(!elementId&&!objectId){alert("You should specify umi:element-id or umi:object attribute")}if(!fieldName){alert("You should specify umi:field-name attribute")}editorInstance.queue.getValue({"element-id":elementId,"object-id":objectId,"field-name":fieldName,"field-type":fieldType},onLoadValue)};boxDomNode=boxNode;editorInstance=editor;init(node)};editBox.currentInstance=null;var uRevisionsQueue=function(d){var a=new Array,b=-1,c=d,f=true;this.submit=function(){var m=new Array(),k=0,l;for(l=b;l>=0;l--){var h=a[l];if(!h){continue}for(var g=l;g>=0;g--){if(a[g]&&a[g].id()==h.id()){a[g]=undefined}}m.push(h)}if(m.length==0){uPageEditor.message(getLabel("js-panel-message-no-changes"));return}if(m.length){f=false}for(l=0;l<m.length;l++){m[l].save(function(){if(c.isEnabled()){c.highlight()}k++;if(m.length==k){f=true;uPageEditor.message(getLabel("js-panel-message-changes-saved"))}})}e();uPageEditor.onStep(b,a.length);uPageEditor.normalizeBoxes()};this.cancel=function(){this.back(this.length());e()};this.back=function(g){g=parseInt(g);var h=0;while(g--&&b>=0){this.get(b--).cancel();h++}uPageEditor.normalizeBoxes();uPageEditor.onStep(b,a.length);return(h>0)};this.forward=function(g){g=parseInt(g);var h=0;while(g--&&b<(a.length-1)){this.get(++b).apply();h++}uPageEditor.normalizeBoxes();uPageEditor.onStep(b,a.length);return(h>0)};this.add=function(j){if(this.length()-1>b){for(var h=b;h<a.length;h++){a[h]=undefined}}var g=a[++b]=new uRevision(j);if(!j["disable-back-fwd"]){uPageEditor.onStep(b,a.length)}return g};this.get=function(g){return a[g]?a[g]:null};this.searchByInfo=function(j){for(var h=b;h>=0;h--){var g=this.get(h);if(g&&g.matchByInfo(j)){return g}}return null};this.getValue=function(l,m){var g=this.searchByInfo(l);var k=new Date;var j="?qt="+k.getTime();if(g){m(g.value(),g.fieldType(),g.fieldParams())}else{var h=uRevisionsQueue.getEditUri(l["field-name"],"load");jQuery.get(h+j,l,function(s){var q={};var o=jQuery("property",s);var v=jQuery("error",s);if(v.size()){uPageEditor.message(v.text());return false}var r=jQuery("user",s);if(r.size()&&r.attr("type")=="guest"){uPageEditor.closeMessages();window.session.sessionCloseMessage(true);return false}w=o.text();fieldType=jQuery(o).attr("type");if(fieldType=="relation"){var u=jQuery("item",o),w={};for(var t=0;t<u.length;t++){var p=jQuery(u[t]).attr("id");var n=jQuery(u[t]).attr("name");w[p]=n}q["guide-id"]=jQuery(o).attr("guide-id");q.multiple=(jQuery(o).attr("multiple")=="multiple");q["public"]=(jQuery(o).attr("public")=="public")}m(w,fieldType,q)},"xml")}};this.length=function(){return a.length};this.index=function(){return b};this.isModified=function(){return(this.length()>0)&&(this.index()>=0)};this.isSaved=function(){return f};var e=function(){a=new Array();b=-1}};uRevisionsQueue.customHandlers={};uRevisionsQueue.getEditUri=function(c,a){var b=uRevisionsQueue.customHandlers[c];if((typeof b!="undefined")&&(typeof b[a]!="undefined")){return b[a]}if(a=="guides"){return"/admin/data/guide_items_all/"}return"/content/editValue/"+a+".xml"};uPageEditor.get();var uRevision=function(q){var m=q["element-id"];var a=q["object-id"];var c=q["field-name"];var t=q["original-value"];var n=q["new-value"];var h=q["field-type"];var l=q.params;var e=q.valuePrefix;var p=q.valueSuffix;var v=q["delete-action"];var o=this;this.getOriginalValue=function(){return t};this.getNewValue=function(){return n};this.getFieldType=function(){return h};this.save=function(C){var A=new Date;var z="?qt="+A.getTime();if(v){jQuery.post("/content/eip_del_page.xml"+z,{"element-id":m,"object-id":a},function(G){var F=jQuery("error",G);if(F.size()){uPageEditor.message(F.text())}else{var E=function(I,J){if(!I.parentNode){return J}var H=I.tagName;if(H!="TABLE"){if(jQuery(I).attr("umi:element-id")){if(jQuery(I).attr("umi:element-id")!=m){return 2}}if(jQuery(I).attr("umi:object-id")){if(jQuery(I).attr("umi:object-id")!=a){return 2}}if(jQuery(I).attr("umi:region")=="row"){return I}}if(--J){return E(I.parentNode,J)}else{return 3}};var D=b(true);jQuery(D).each(function(H,J){var I=E(J,10);if(I){jQuery(I).remove()}});uPageEditor.normalizeBoxes()}});return}var x={"element-id":m,"object-id":a,"field-name":c};if(typeof n=="object"){var B=new Array(),w;for(w in n){B.push(w)}x.value=B}else{x.value=n}var y=uRevisionsQueue.getEditUri(q["field-name"],"save");jQuery.post(y+z,x,function(K){var I={};var F=jQuery("property",K);var M=jQuery("error",K);var N=jQuery(F).attr("old-link");var H=jQuery(F).attr("new-link");if(M.size()){uPageEditor.message(M.text());return false}O=F.text();h=jQuery(F).attr("type");if(h=="relation"){var L=jQuery("item",F),O={};for(var J=0;J<L.length;J++){var G=jQuery(L[J]).attr("id");var E=jQuery(L[J]).attr("name");O[G]=E}I["guide-id"]=jQuery(F).attr("guide-id");I.multiple=(jQuery(F).attr("multiple")=="multiple")}if(N&&H){var D=b();jQuery(D).each(function(P,Q){jQuery(Q).attr("href",H);Q.onclick=Q.onmouseup=Q.onmousedown=function(){return true};jQuery("a",Q).each(function(R,S){jQuery(S).attr("href",H);S.onclick=S.onmouseup=S.onmousedown=function(){return true}})})}C(O,h,I);if(typeof C=="function"){C()}})};this.apply=function(){if(v){return false}r(b(),n,t)};this.cancel=function(){if(v){return false}r(b(),t,n)};this.value=function(){return n};this.fieldType=function(){return h};this.fieldParams=function(){return l};this.matchByInfo=function(w){if(v&&m&&m==w["element-id"]){return true}if(v&&a&&a==w["object-id"]){return true}if(c=="h1"||c=="name"){if(w["field-name"]!="name"&&w["field-name"]!="h1"){return false}}else{if(w["field-name"]!=c){return false}}if((m&&w["element-id"]==m)||(a&&w["object-id"]==a)){return true}return false};this.id=function(){return(m?("page-"+m):("object-"+a))+"-"+c};this.isDeleteAction=function(){return v?true:false};var b=function(x){var y=uPageEditor.getRegions();var w=new Array(),C;for(var z=0;z<y.length;z++){var B=y[z];var A=jQuery(B);if(A.attr("tagName")=="TABLE"){continue}if(!v){if(c=="h1"||c=="name"){if(A.attr("umi:field-name")!="h1"&&A.attr("umi:field-name")!="name"){continue}}else{if(A.attr("umi:field-name")!=c){continue}}}if(C=uPageEditor.searchAttr(B,20)){if((m&&C["element-id"]==m)||(a&&C["object-id"]==a)){w.push(x?B:A)}}}return w};var r=function(x,y,w){jQuery(x).each(function(z,A){switch(h){case"img_file":return u(A,y,w);break;case"relation":return k(A,y,w);break;case"video_file":return d(A,y,w);break;case"boolean":return f(A,y,w);break;default:return jQuery(A).html(y)}})};var u=function(x,G,z){var D=false;if(jQuery(x).attr("tagName")=="IMG"){if(g(x.attr("src"),z)){x.attr("src",G);D=true}else{if(s(x.attr("src"))){var w=x.width();var H=x.height();var F=x.attr("src");if(F.indexOf(w)!=-1&&F.indexOf(H)==-1){H="auto"}if(F.indexOf(w)==-1&&F.indexOf(H)!=-1){w="auto"}G=j(G,w,H);x.attr("src",G);D=true}}jQuery(x).one("load",function(){uPageEditor.normalizeBoxes()})}var B=x.css("background-image");if(B.substr(0,4)!="url("){if(!D&&x.attr("childNodes")){var E=x.attr("childNodes");for(var A=0;A<E.length;A++){var C=E.item(A);if(C&&jQuery(C).attr("tagName")){u(jQuery(C),G,z)}}}return}B=B.substring(4,B.length-1);var y=window.location.protocol+"//"+window.location.host;if(B.substr(0,y.length)!=y){return}B=B.substr(y.length);if(!B){return}if(g(B,z)){x.css("background-image","url("+G+")");D=true}if(!D&&x.attr("childNodes")){var E=x.attr("childNodes");for(var A=0;A<E.length;A++){var C=E.item(A);if(C&&jQuery(C).attr("tagName")){u(jQuery(C),G,z)}}}};var g=function(x,w){return x==w};var s=function(w){if(w.indexOf("/images/cms/thumbs/")>=0){return true}if(w.indexOf("/images/autothumbs/")>=0){return true}return false};var j=function(C,A,w){C=C.toString();var y=C.split(/\./g);if(y.length<2){return false}var z=y[y.length-1].toString();var y=y[y.length-2].toString().split(/\//g);var x=y[y.length-1].toString();var B=C.substr(0,C.length-x.length-z.length-1);return"/images/autothumbs"+B+x+"_"+A+"_"+w+"."+z};var k=function(z,A,w){var y="",x;for(x in A){y+=A[x]+", "}if(y){y=y.substr(0,y.length-2)}jQuery(z).html(y)};var d=function(x,z,w){var y=function(A){return(navigator.appName.indexOf("Microsoft")!=-1)?window[A]:document[A]};y("UmiVideoPlayer").setVideoFile(z)};var f=function(x,y,w){if(x.attr("tagName")=="INPUT"&&x.attr("type")=="checkbox"){x.attr("checked",y?true:false)}else{jQuery(x).html(y?"Да":"Нет")}}};var inlineWYSIWYG=function(d){var b=this;var e=d;var h=null;var a=function(){var j=uPageEditor.nodePositionInfo(e);h=document.createElement("div");jQuery(h).attr("class","eip-wysiwyg-toolbox eip-ui-element eip-wysiwyg_buttons");document.body.appendChild(h);uPageEditor.placeWith(e,h,"top","left");jQuery(h).draggable()};var g=function(){var j;for(j in inlineWYSIWYG.buttons){b.callButton(j,"init",{toolbox:h,editor:b})}};var c=function(){var o,q=b.sels.getNode();var j=new Array();for(o in inlineWYSIWYG.buttons){var l=b.callButton(o,"status");var p=jQuery(".eip-wysiwyg_button_"+o);if(p.size()){if(l){p.addClass("act")}else{p.removeClass("act")}}var m=inlineWYSIWYG.buttons[o].requireTag;if(m){var r,k=false;if(q){for(r in m){if(typeof j[m[r]]!="undefined"){k=j[m[r]];break}if(inlineWYSIWYG.seekTag(q,m[r])){k=true;j[m[r]]=true;break}else{j[m[r]]=false}}}p.css("display",k?"":"none")}}};var f=function(){a();g();b.sels=new selections(window,e);jQuery(e).bind("click",function(k){var l=k||window.event;inlineWYSIWYG.select={node:(l.target||l.srcElement),params:{}};c()});jQuery(e).bind("keyup",function(){c()});if(!e.firstChild||e.firstChild.tagName!="P"){var j=jQuery.trim(jQuery(e).html());jQuery(e).html("<p>"+j+"</p>")}};this.getToolBox=function(){return h};this.callButton=function(k,n,o){var l=inlineWYSIWYG.buttons[k];if(l){var m=l[n];if(typeof m=="function"){var j=m(o,e,b.sels);if(n=="execute"){setTimeout(function(){c()},150)}return j}}else{alert('Button "'+k+'" not found')}return false};this.refocus=function(){d.focus()};this.destroy=function(){jQuery(h).remove();jQuery(e).unbind("click");jQuery(e).unbind("keyup");jQuery(e).unbind("mouseover");jQuery(e).unbind("mouseout")};f()};inlineWYSIWYG.buttons=[];inlineWYSIWYG.button=function(a,b){inlineWYSIWYG.buttons[a]=b};inlineWYSIWYG.createSimpleButton=function(d,c,f,h){var e=document.createElement("a");jQuery(e).attr({href:"#","class":"eip-wysiwyg_button_"+f,type:"button"});d.getToolBox().appendChild(e);h=true;var g=d,a=c,b=h;jQuery(e).bind("click",function(){g.callButton(a,"execute");return false});return e};function createSimple(b,a){return function(){inlineWYSIWYG.button(b,{init:function(d){var c=inlineWYSIWYG.createSimpleButton(d.editor,b,b);jQuery(c).attr({value:a["button-label"],title:a["button-title"]});if(a.letter){jQuery(c).html(a.letter)}},execute:function(g,f,c){var e=c.getNode();if(jQuery(e).attr("umi:field-name")||e==f){return false}var h,d={JustifyLeft:"left",JustifyCenter:"center",JustifyRight:"right"};if(h=d[b]){if(f.firstChild==e&&e.tagName=="P"){jQuery(e).css("text-align",h);return true}}setTimeout(function(){try{return document.execCommand(b,false,null)}catch(j){return false}},110)},status:function(){try{return document.queryCommandState(b)}catch(c){return false}},params:a})}}inlineWYSIWYG.seekTag=function(b,a){do{if(!b){return false}if(b.nodeType!=1){continue}if(b.tagName==a){return b}if(jQuery(b).hasClass("u-eip-editing")){return false}}while(b=b.parentNode);return false};var selections=function(e,c){var a=e,h=c,g=null;var b=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);var l=function(){var p=a.document;if(p.selection){var o=p.selection.type;return(o=="Text"||o=="None")?p.selection:null}if(a.getSelection){return a.getSelection()}return null};var m=function(){var o=l();if(o){if(o.createRange){return o.createRange()}if(o.rangeCount&&o.getRangeAt){return o.getRangeAt(0)}}return null};var f=function(o){if(o.select){o.select()}else{var p=l();if(p.removeAllRanges&&p.addRange){p.removeAllRanges();p.addRange(o)}}};var d=function(o,p,r){var s=document.createElement(o),q;for(q in p){s.setAttribute(q,p[q])}if(r){s.innerHTML=r}return s};var n=function(){var o=l();return(!o||o.rangeCount==0)?false:o.getRangeAt(0)};var j=function(q,o){if(!q||!o){return false}for(var p=0;p<150;p++){if(q==o){return true}if(q.tagName=="HTML"){return false}q=q.parentNode}return false};var k=function(t,p){var s=function(w){var v=new Array;do{if(w==h.parentNode||w.tagName=="HTML"){break}if(w.nodeType!=1){continue}v.push(w)}while(w=w.parentNode);return v};var o=s(t);var u=s(p);for(var r=0;r<o.length;r++){for(var q=0;q<u.length;q++){if(o[r]==u[q]){return o[r]}}}return false};this.load=function(){if(g){f(g)}};this.save=function(){g=m()};this.expand=b?function(o){}:function(r){var o=m(),p=this.getNode(r);if(this.isSomethingSelected()&&o&&p&&p.nextSibling){o.setStart(p,0);o.setEnd(p.nextSibling,0);var q=l();q.removeAllRanges();q.addRange(o)}};this.getNode=b?function(r,q){var o=m();if(o&&(q||this.isSomethingSelected(true))){var p=o.parentElement();if(j(p,h)){return p}}return false}:function(r,q){var o=n();if(o&&(q||this.isSomethingSelected(true))){var p=k(o.startContainer,o.endContainer);while(p.nodeType!=1){p=p.parentNode}if(p!=h.parentNode){if(j(p,h)){return p}}}return false};this.surround=b?function(o,q){if(this.isSomethingSelected()){var p=m();return this.insert(o,q,p.htmlText)}else{return false}}:function(o,q){if(this.isSomethingSelected()){var p=m();var r=d(o,q);p.surroundContents(r);return true}else{return false}};this.insert=b?function(o,q,t){var s=window.document.selection;if(this.isSomethingSelected()&&s){var r=d(o,q,t).outerHTML;var p=s.createRange();p.pasteHTML(r);p.collapse(false);p.select();return true}else{return false}}:function(o,q,s){var p=m();if(this.isSomethingSelected()&&p){var r=d(o,q,s);p.deleteContents();p.insertNode(r);p=a.document.createRange();p.selectNode(r);p.collapse(false);selectRange(p,a);return true}else{return false}};this.isSomethingSelected=b?function(o){var p=a.document.selection;return p&&(p.createRange().text!="")&&(o||this.getNode())}:function(p){var o=m(a);return o&&!o.collapsed&&(p||this.getNode())}};var stylesFormats={"":"",P:"Абзац",PRE:"Форматированный",H1:"Заголовок 1",H2:"Заголовок 2",H3:"Заголовок 3",H4:"Заголовок 4",H5:"Заголовок 5",H6:"Заголовок 6"};inlineWYSIWYG.button("StylesFormatting",{init:function(e){var c=document.createElement("select");c.className="eip-wysiwyg_select_format";e.editor.getToolBox().appendChild(c);var a;for(a in stylesFormats){var b=document.createElement("option");b.value=a;b.innerHTML=stylesFormats[a];c.appendChild(b)}var d=e.editor;jQuery(c).bind("change",function(){d.callButton("StylesFormatting","execute",{tag:this.value})})},execute:function(d,c,a){if(!d.tag){return}var b=a.getNode(false,true);if(b&&b.tagName!=d.tag){document.execCommand("formatBlock",false,"<"+d.tag+">")}},status:function(d,c,a){var b=a.getNode(false,true).tagName;if(stylesFormats[b]){jQuery(".eip-wysiwyg_select_format").each(function(f,e){e.value=b})}},params:{}});var ie=document.selection&&window.ActiveXObject&&/MSIE/.test(navigator.userAgent);createSimple("Bold",{"button-label":"Bold","button-title":"Жирный",prefix:"b"})();createSimple("Italic",{"button-label":"Italic","button-title":"Курсив",prefix:"i"})();createSimple("Underline",{"button-label":"Underlined","button-title":"Подчеркнутый",prefix:"u"})();createSimple("JustifyLeft",{"button-label":"Left","button-title":"Выравнивание по левому краю",prefix:"l"})();createSimple("JustifyCenter",{"button-label":"Center","button-title":"Выравнивание по центру",prefix:"c"})();createSimple("JustifyRight",{"button-label":"Right","button-title":"Выравнивание по правому краю",prefix:"r"})();createSimple("InsertOrderedList",{"button-label":"InsertOrderedList","button-title":"Нумерованный список",prefix:"ol"})();createSimple("InsertUnorderedList",{"button-label":"InsertUnorderedList","button-title":"Маркированный список",prefix:"ul"})();inlineWYSIWYG.button("AddLink",{init:function(b){var a=inlineWYSIWYG.createSimpleButton(b.editor,"AddLink","addlink",true);jQuery(a).attr({value:"AddLink",title:"Создать ссылку"})},execute:function(h,f,a){var e=a.getNode(),c="";if(e.nodeType==1&&e.tagName=="A"){c=jQuery(e).attr("href")}var b=new Date;var d=b.getTime();var g=a;c="/styles/common/other/inline-wysiwyg/createLink.html?ts="+d+"&url="+c;a.save();jQuery.openPopupLayer({name:"CreateLink",title:"Создание ссылки",url:c,width:490,height:95,afterClose:function(j){g.load();if(typeof j=="undefined"){return true}if(j){document.execCommand("createlink",false,j)}else{document.execCommand("unlink",false,false)}}})},status:function(){return false},params:{}});inlineWYSIWYG.button("UnLink",{init:function(b){var a=inlineWYSIWYG.createSimpleButton(b.editor,"UnLink","unlink",true);jQuery(a).attr({value:"Unlink",title:"Удалить ссылку"})},execute:function(c,b,a){a.expand();document.execCommand("unlink",false,false)},status:function(){return false},params:{}});inlineWYSIWYG.button("InsertImage",{init:function(b){var a=inlineWYSIWYG.createSimpleButton(b.editor,"InsertImage","insertimage",true);jQuery(a).attr({value:"InsertImage",title:"Вставить/редактировать изображение"})},execute:function(e,l,g){if(typeof inlineWYSIWYG.select=="undefined"){inlineWYSIWYG.select={node:false,params:{}}}var c=inlineWYSIWYG.select.node,a="",f="",k=[],h,d;if(typeof c=="undefined"||c===false){alert("Установите курсор в место вставки изображения");return false}inlineWYSIWYG.select.params.folder="./images/cms/data";if((ie?c.tagName.toLowerCase()=="img":c instanceof HTMLImageElement)){a=jQuery(c).attr("src");a=a.toString();var j=a.split(/\//g);f=j[j.length-1];inlineWYSIWYG.select.params.folder="."+a.substr(0,a.length-f.length-1);inlineWYSIWYG.select.params.file=a;if(typeof c.attributes.style!="undefined"){k=(ie?c.style.cssText.toLowerCase().replace(/;[\s]*$/g,"").split("; "):c.attributes.style.nodeValue.replace(/;[\s]*$/g,"").split("; "))}inlineWYSIWYG.select.params.css={};for(h=0;h<k.length;h++){d=k[h].split(": ");if(d[0]=="float"){d[0]="vertical-align"}inlineWYSIWYG.select.params.css[d[0]]=((isNaN(parseInt(d[1])))?d[1]:parseInt(d[1]))}}var b=g;if(ie&&(!g.isSomethingSelected()&&!k.length)){alert("Выделите фрагмент текста");return false}g.save();jQuery.openPopupLayer({name:"ImageEditor",title:"Редактор изображений",width:360,url:"/styles/common/other/inline-wysiwyg/imageEditor.html",afterClose:function(m){if(typeof m=="undefined"){return}if(m.src.length>0){b.load();setTimeout(function(){document.execCommand("InsertImage",false,m.src);var n=jQuery("img[src='"+(ie?m.src:"http://"+location.host+m.src)+"']",l);n.css(m.css)},100)}}});return true},status:function(){return false},params:{}});inlineWYSIWYG.button("XmlOff",{init:function(b){var a=inlineWYSIWYG.createSimpleButton(b.editor,"XmlOff","xmloff");jQuery(a).attr({value:"XmlOff",title:"Очистить код"})},execute:function(d,c){var b=jQuery(c).html();var a=true;b=b.replace(/<![\s\S]*?--[ \t\n\r]*>/ig," ");b=b.replace(/<!--[\w\W\n]*?-->/ig," ");b=b.replace(/<\/?(title|style|font|meta)\s*[^>]*>/ig,"");b=b.replace(/\s*mso-[^:]+:[^;""]+;?/ig,"");b=b.replace(/<\/?o:[^>]*\/?>/ig,"");b=b.replace(/ style=['"]?[^'"]*['"]?/ig,"");if(a){b=b.replace(/ class=['"]?[^'">]*['"]?/ig,"")}b=b.replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/ig,"");b=b.replace(/<span\s*[^>]*>/ig,"");b=b.replace(/<\/span\s*[^>]*>/ig,"");b=b.replace(/<\/(b|i|s|u|strong|center)>[\t\n]*<\1[^>]*>/gi,"");b=b.replace(/<\/(b|i|s|u|strong|center)>\s*<\1[^>]*>/gi," ");b=b.replace(/<(b|i|s|u|strong|center)[^>]*>[\s\t\n\xC2\xA0]*<\/\1>/gi,"");b=b.replace(/(\t|\n)/gi," ");b=b.replace(/[\s]{2,}/gi," ");if(jQuery.browser.safari){b=b.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")}jQuery(c).html(b)},status:function(){return false},params:{}});inlineWYSIWYG.button("ClipboardPaste",{init:function(d){var a=inlineWYSIWYG.createSimpleButton(d.editor,"ClipboardPaste","clipboardpaste");var b=jQuery(d.toolbox);var c=jQuery("<div class='eip-wysiwyg-toolbox eip-ui-element eip-wysiwyg_tip'>Для вставки из буфера обмена нажмите Ctrl+V</div>");jQuery(a).attr({value:"ClipboardPaste"}).mouseenter(function(){jQuery(document.body).append(c);c.css({position:"absolute",display:"none",top:(parseInt(b.css("top"))-parseInt(c.height()))+"px",left:b.css("left"),width:(parseInt(b.outerWidth())-10)+"px"}).fadeIn(400)}).mouseleave(function(){c.fadeOut(400,function(){c.remove()})})},execute:function(b,a){},status:function(){return false},params:{}});function RGBColor(g){this.ok=false;if(g.charAt(0)=="#"){g=g.substr(1,6)}g=g.replace(/ /g,"");g=g.toLowerCase();var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var c in a){if(g==c){g=a[c]}}var h=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(j){return[parseInt(j[1]),parseInt(j[2]),parseInt(j[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(j){return[parseInt(j[1],16),parseInt(j[2],16),parseInt(j[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(j){return[parseInt(j[1]+j[1],16),parseInt(j[2]+j[2],16),parseInt(j[3]+j[3],16)]}}];for(var b=0;b<h.length;b++){var e=h[b].re;var d=h[b].process;var f=e.exec(g);if(f){channels=d(f);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHash=function(){return{red:this.r,green:this.g,blue:this.b}};this.inverse=function(){this.r=255-this.r;this.g=255-this.g;this.b=255-this.b};this.toHex=function(){var l=this.r.toString(16);var k=this.g.toString(16);var j=this.b.toString(16);if(l.length==1){l="0"+l}if(k.length==1){k="0"+k}if(j.length==1){j="0"+j}return"#"+l+k+j}}var uPanel=function(e){var h=e,d=this,f=null;var c=function(){jQuery(h.placeholder).html(uPanel.getSource());if(jQuery.cookie("eip-panel-state")=="collapsed"){}if(!jQuery.cookie("eip-panel-state-first")){var k=jQuery("#u-quickpanel");k.css("overflow","hidden");k.css("width","0");jQuery("#u-show_hide_btn").addClass("collapse");var k=jQuery("#u-quickpanel");k.delay(2000).animate({width:"100%"},500,function(){jQuery(this).css("overflow","visible");jQuery("#u-show_hide_btn").removeClass("collapse")});jQuery.cookie("eip-panel-state","",{path:"/",expires:0});var j=new Date();j.setTime(j.getTime()+(30*24*60*60*1000));jQuery.cookie("eip-panel-state-first","Y",{path:"/",expires:j})}jQuery("#u-show_hide_btn").click(function(){d.swap(this)});jQuery("#u-quickpanel #last_doc, #changelog_dd").click(function(){changeClassName(this)});jQuery("#u-quickpanel #meta").click(function(){changeClassName(this);uPageEditor.get().enableMETA();return false});jQuery("#save_meta_button").click(function(){uPageEditor.get().submitMeta();return false});jQuery("#u-quickpanel #edit").click(function(){d.swapEditor()});jQuery("#on_edit_in_place").click(function(){d.swapEditor()});jQuery("#u-quickpanel #save_edit #save").click(function(){uPageEditor.get().submit();return false});jQuery("#u-quickpanel #save_edit #edit_back").click(function(){uPageEditor.get().back(1);return false});jQuery("#u-quickpanel #save_edit #edit_next").click(function(){uPageEditor.get().forward(1);return false});jQuery("#u-quickpanel #exit").click(function(){window.location="/users/logout/";return false});jQuery("#u-quickpanel #note").click(function(){if(!window.ticketCreated){alert(getLabel("js-panel-note-add"));window.ticketCreated=true}window.initNewTicket();return false});jQuery("#u-quickpanel #help").click(function(){window.open("http://help.umi-cms.ru/index.html?admin_panel.htm");return false});if(jQuery.cookie("eip-editor-state")){changeClassName(jQuery("#u-quickpanel #edit"));d.swapEditor()}jQuery("#u-quickpanel #seo").click(function(){window.location.href="/admin/seo/"})};var g=function(k){jQuery("recent page",k).each(function(n,q){var p=document.createElement("li");var m=jQuery("name",q).text();var o=jQuery(q).attr("link");jQuery(p).html("<a href='"+o+"'>"+m+"</a>");jQuery("ul#u-docs-recent").append(p)});var j=0;jQuery("editable page",k).each(function(o,s){var p=jQuery("basetype",s).attr("module");var m=false;jQuery("modules module",k).each(function(){if(jQuery(this).text()==p){m=true}});if(!m){return}var r=document.createElement("li");var n=jQuery("name",s).text();var q=jQuery("edit-link",s).text();if(langPrefix!=""){q="/"+langPrefix+q}jQuery(r).html("<a href='"+q+"'>"+n+"</a>");jQuery("#u-quickpanel ul#u-docs-edit").append(r);j++});if(j){jQuery("#u-quickpanel #edit_menu").click(function(){changeClassName(this)})}else{jQuery("#u-quickpanel #edit_menu").hide(0)}j=0;jQuery("modules module",k).each(function(p,q){var t=document.createElement("li");var o=jQuery(q).attr("label");var n=jQuery(q).text();var s="/admin/"+n+"/";if(langPrefix!=""){s="/"+langPrefix+s}var r=jQuery(q).attr("type");var m;if(r=="system"){m="ul#u-mods-admin"}else{if(r=="util"){m="ul#u-mods-utils"}else{m=(++j%2)?"ul#u-mods-cont-left":"ul#u-mods-cont-right"}}jQuery(t).html("<a href='"+s+"'>"+o+"</a>");jQuery("#u-quickpanel "+m).append(t)});if(j){jQuery("#u-quickpanel #butterfly").click(function(){changeClassName(this)}).addClass("butterfly_hover")}var l=window.location.pathname;if(jQuery("changelog",k).size()>0){jQuery("changelog revision",k).each(function(p,o){var r=document.createElement("li");var t=jQuery("date",o).text();var m=jQuery("author",o).attr("name");var q=jQuery("link",o).text();var s=(jQuery(o).attr("active")=="active");var n=t;if(m){n+=" - "+m}q+="?force-redirect="+window.location.pathname;if(s){n+="&nbsp;&nbsp;&nbsp;&larr;"}jQuery(r).html("<a href='"+q+"'>"+n+"</a>");jQuery("#u-changelog").append(r)});jQuery("#changelog_dd").css("display","")}else{jQuery("#changelog_dd").css("display","none")}if(jQuery("tickets",k).size()&&(typeof tickets!="undefined")){tickets(jQuery,k)}else{jQuery("#u-quickpanel #note").remove()}};var a=function(){var j="/admin/content/frontendPanel.xml?links";j+="&ts="+Math.round(Math.random()*1000);jQuery.get(j,{referer:window.location.toString()},g)};var b=function(){var j=(typeof uPageEditor.onEnable=="function")?uPageEditor.onEnable:function(){};uPageEditor.onEnable=function(){j();changeClassName(jQuery("#edit"))};var j=(typeof uPageEditor.onDisable=="function")?uPageEditor.onDisable:function(){};uPageEditor.onDisable=function(){j();changeClassName(jQuery("#edit"))};uPageEditor.onStep=function(k,l){jQuery("#u-quickpanel #save_edit #edit_back").attr("class",(k==-1)?"":"ac");jQuery("#u-quickpanel #save_edit #edit_next").attr("class",((l-k)==1)?"":"ac")}};c();b();a()};uPanel.prototype.swapEditor=function(){var a=uPageEditor.get();if(a.isEnabled()){a.disable();jQuery("#u-quickpanel #edit").html('<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-edit")+" (F2)");jQuery("#on_edit_in_place").html(getLabel("js-on-eip"))}else{a.enable();jQuery("#u-quickpanel #edit").html('<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-view")+" (F2)");jQuery("#on_edit_in_place").html(getLabel("js-off-eip"))}};uPanel.prototype.swap=function(b){var a=jQuery("#u-quickpanel").css("width");if(a=="0px"){return this.expand(b)}else{if(uPageEditor.get().isEnabledMeta()){jQuery("#u-quickpanel #meta").trigger("click")}return this.collapse(b)}};uPanel.prototype.expand=function(b){var a=jQuery("#u-quickpanel");a.css("overflow","visible");a.animate({width:"100%"},500);jQuery(b).removeClass("collapse");jQuery.cookie("eip-panel-state","",{path:"/",expires:0})};uPanel.prototype.collapse=function(c){var b=jQuery("#u-quickpanel");b.css("overflow","hidden");b.animate({width:"0"},500);jQuery(c).addClass("collapse");var a=new Date();a.setTime(a.getTime()+(30*24*60*60*1000));jQuery.cookie("eip-panel-state","collapsed",{path:"/",expires:a})};uPanel.loadRes=function(a,c,d){var b;switch(a){case"js":case"text/javascript":b=document.createElement("script");b.src=c;b.charset="utf-8";break;case"css":case"text/css":b=document.createElement("link");b.href=c;b.rel="stylesheet";break;default:return}document.body.parentNode.firstChild.appendChild(b);if(typeof d=="function"){jQuery(document).one("ready",d)}};uPanel.getSource=function(){var b='<div id="u-show_hide_btn" />	<div id="u-quickpanel">	<div id="exit" title="'+getLabel("js-panel-exit")+'">&#160;</div>	<div id="help" title="'+getLabel("js-panel-documentation")+'">&#160;</div>	<div id="butterfly">		<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-modules")+'		<div class="bg">			<ul id="u-mods-cont-left" />			<ul id="u-mods-cont-right" />			<div class="clear separate" />			<ul id="u-mods-utils" />			<ul id="u-mods-admin" />			<div class="clear" />		</div>	</div>	<div id="edit"><span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-edit")+' (F2)</div>	<div id="save_edit">		<div id="save" title="'+getLabel("js-panel-edit")+'">&#160;</div>		<div id="edit_back" title="'+getLabel("js-panel-cancel")+'">&#160;</div>		<div id="edit_next" title="'+getLabel("js-panel-repeat")+'">&#160;</div>	</div>	<div id="edit_menu" title="'+getLabel("js-panel-edit-menu")+'">		<span class="in_ico_bg">&#160;</span>		<div>			<ul id="u-docs-edit"/>			<span class="clear" />		</div>	</div>	<div id="last_doc">		<span class="in_ico_bg" />		'+getLabel("js-panel-last-documents")+'		<div>			<ul id="u-docs-recent" />			<span class="clear" />		</div>	</div>	<div id="changelog_dd" style="display:none;">		<span class="in_ico_bg">&#160;</span>		'+getLabel("js-panel-history-changes")+'		<div>			<ul id="u-changelog" />			<span class="clear" />		</div>	</div>	<div id="note">		<span class="in_ico_bg">&#160;</span>		'+getLabel("js-panel-note")+"	</div>";var a=typeof EIP_META!="undefined"&&EIP_META.element_id;if(a){b+='<div id="meta">		<span class="in_ico_bg">&#160;</span>		'+getLabel("js-panel-meta")+"	  </div>	  "}b+='<div id="seo">		<span class="in_ico_bg">&#160;</span>		'+getLabel("module-seo")+"	</div>";b+="</div>";if(a){b+='<div id="u-quickpanel-meta">				<table>					<tr><td width="100px">'+getLabel("js-panel-meta-title")+': </td><td><input type="text" name="title" id="u-quickpanel-metatitle" value="'+EIP_META.title+'"/> <div class="meta_count" id="u-quickpanel-metatitle-count"/></td></tr>					<tr><td>'+getLabel("js-panel-meta-descriptions")+':</td><td> <input type="text" name="meta_descriptions" id="u-quickpanel-metadescription" value="'+EIP_META.meta_descriptions+'"/> 						<div class="meta_count" id="u-quickpanel-metadescription-count"/>						</td></tr>					<tr><td>'+getLabel("js-panel-meta-keywords")+': </td><td><input type="text" name="meta_keywords" id="u-quickpanel-metakeywords" value="'+EIP_META.meta_keywords+'"/><div class="meta_count" id="u-quickpanel-metakeywords-count"/>						<div class="meta_buttons">						<input type="submit"  id="save_meta_button"  value="'+getLabel("js-panel-save")+'">						</div>					</td></tr>				</table>				</div>'}return b};jQuery(document).ready(function(){var b=jQuery("#u-panel-holder");if(b.size()==0){var c=document.createElement("div");c.id="u-panel-holder";document.body.appendChild(c);b=jQuery("#u-panel-holder")}jQuery("html").addClass("u-eip");var a=new uPanel({placeholder:b});uPageEditor.get().bindEventsMeta();jQuery(document).keypress(function(f){var d=f.charCode||f.keyCode;if(f.shiftKey&&(d==68||d==100||d==1042||d==1074)){jQuery("#u-quickpanel #edit_menu").each(function(e,g){changeClassName(g)})}})});function changeClassName(d){var c=uPageEditor.get();var a=(c.isEnabled())?"[id != 'edit']":"";if(!jQuery(d).hasClass("act")){var b=jQuery("#u-quickpanel .act");var e=false;if(b.size()){jQuery("#u-quickpanel .act div:first").hide();jQuery("#u-quickpanel .act"+a).removeClass("act");if(d.id=="edit"&&!a){jQuery("#save_edit").css("display","none")}}if(jQuery.browser.opera){e=jQuery(d).width()}jQuery(d).addClass("act");if(e){jQuery(d).width(e)}jQuery("#u-quickpanel .act div:first").show();if(jQuery(d).attr("id")=="edit"){jQuery("#save_edit").css("display","block")}}else{jQuery("#u-quickpanel .act div:first").hide();jQuery("#u-quickpanel .act"+a).removeClass("act");if(jQuery(d).attr("id")=="edit"){jQuery("#save_edit").css("display","none")}}if(jQuery(d).attr("id")!="meta"&&c.isEnabledMeta()){jQuery("#u-quickpanel #meta").addClass("act")}}var tickets=function(g,e){var b=new Array;var c=g("user",e);var h=false;var f=function(m){var t=this,m=m,l,j;var o=m.x,n=m.y,k=m.width,r=m.height;var q=function(){var u;if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){u=window.getSelection();if(u&&u.removeAllRanges){u.removeAllRanges()}}}};var p=function(){j=g('<div class="u-ticket-comment"><div /><textarea /><a /></div>');g(document.body).append(j);if(m.message){g("div",j).html(m.message.authorName+" ("+m.message.authorLogin+")");g("textarea",j).attr("value",m.message.text)}g("a",j).html(getLabel("js-ticket-delete"));$("textarea",j).bind("change",function(){t.save()});g("a",j).bind("click",function(){t.del()})};t.del=function(){if(l){l.remove()}if(j){j.remove()}if(m.id){var u="/content/tickets/delete/"+m.id+"/";g.get(u)}};t.save=function(){var v=m.id?"modify":"create";var u="/content/tickets/"+v+"/"+m.id+"/";u+="?ts="+Math.round(Math.random()*1000);g.ajax({url:u,dataType:"json",data:{x:o,y:n,width:k,height:r,message:g("textarea",j).attr("value"),referer:window.location.toString()},success:function(w){m.id=w.id}})};t.update=function(){l.css({top:n,left:o,width:k,height:r,opacity:0.3});if(j){j.css({top:parseInt(n)+parseInt(r),left:parseInt(o)+parseInt(k)})}};t.listen=function(){xFirst=o;yFirst=n;g(document).bind("mousemove",function(u){q();xLast=u.pageX;yLast=u.pageY;if(xLast>xFirst){k=xLast-xFirst}else{xLast=xFirst;o=u.pageX;k=xLast-o}if(yLast>yFirst){r=yLast-yFirst}else{yLast=yFirst;n=u.pageY;r=yLast-n}t.update()});g(document).one("mouseup",function(u){g(document).unbind("mousemove");t.update();t.save();h=false})};(function s(){l=g('<div class="u-ticket" />');g(document.body).append(l);if(m.message){p()}t.update()})()};var d=function(){changeClassName(g("#u-quickpanel #note").get(0));g(document).one("mousedown",function(j){var k=new f({x:j.pageX,y:j.pageY,width:0,height:0,message:{authorName:c.attr("fname")+" "+c.attr("lname"),authorLogin:c.attr("login"),text:getLabel("js-ticket-empty")}});k.listen();changeClassName(g("#u-quickpanel #note").get(0))})};window.initNewTicket=d;g(document).bind("keydown",function(j){if(j.shiftKey&&(j.keyCode==67||j.keyCode==99)){if(h==false){d();h=true}return true}});(function a(j){g("ticket",j).each(function(k,o){var o=g(o);var p=g("position",o);var m=g("author",o);var n=g("message",o);var l=new f({id:o.attr("id"),x:p.attr("x"),y:p.attr("y"),width:p.attr("width"),height:p.attr("height"),message:{authorName:m.attr("fname")+" "+m.attr("lname"),authorLogin:m.attr("login"),text:n.text()}});l.update()})})(e)};function relationControl(r,b,j,h){var e=this;var d=r;var v=b||r;var q=true;var y=null;var B=null;var s=null;var f=null;var C=null;var a=null;var c=null;var A=null;var t=null;var m=0;var l=0;var z=h||"/admin/data/guide_items_all/";var w=function(){y=document.getElementById("relationSelect"+v);B=document.getElementById("relationInput"+v);s=document.getElementById("relationButton"+v);if(!y){alert("Select input for field #"+v+" not found");return}jQuery("option",y).each(function(){if(!this.selected&&this.value.length!==0){q=false}});if(s){s.onclick=function(){e.addItem()}}if(B){B.onkeyup=function(G){var F=G?G.keyCode:event.keyCode;if(F==13&&s){e.addItem();return false}else{e.doSearch()}};B.onkeydown=function(G){var F=G?G.keyCode:event.keyCode;if(F==13){return false}}}var E=function(){if(q){e.loadItemsAll();q=false}};y.onmouseover=E;y.onfocus=E;for(var D=0;D<y.childNodes.length;D++){if(y.childNodes[D].nodeType!=1){y.removeChild(y.childNodes[D]);D=0}}if(j&&jQuery("option[value='']",y).size()==0){jQuery(y).prepend("<option value=''></option>")}};this.rescan=function(){B=document.getElementById("relationInput"+v);if(B){B.onkeyup=function(E){var D=E?E.keyCode:event.keyCode;if(D==13&&s){e.addItem()}else{e.doSearch()}}}};this.getValue=function(){var F=jQuery("option[selected]",jQuery(y));var D=[];for(var E=0;E<F.length;E++){D[F[E].value]=jQuery(F[E]).text()}return D};this.loadItems=function(D){jQuery.ajax({url:z+d+".xml?limit&search[]="+encodeURIComponent(D),type:"get",complete:function(F,E){e.updateItems(F)}})};this.loadItemsAll=function(){jQuery.ajax({url:z+d+".xml?allow-empty",type:"get",complete:function(E,D){e.updateItemsAll(E)}})};this.updateItemsAll=function(E){if(E.responseXML.getElementsByTagName("empty").length){if(B){B.onkeyup=function(P){var O=P?P.keyCode:event.keyCode;switch(O){case 38:if(A.length&&(t>0||t==null)){g((t===null)?(A.length-1):(t-1))}break;case 40:if(A.length&&(t<(A.length-1)||t==null)){g((t===null)?0:(t+1))}break;case 13:k();n();break;case 27:n();break;default:clearTimeout(c);c=setTimeout(function(){e.doSearchAjax()},500)}};B.onblur=function(){if(a){if(m<parseInt(a.style.left)||m>(parseInt(a.style.left)+parseInt(a.offsetWidth))||l<parseInt(a.style.top)||l>(parseInt(a.style.top)+parseInt(a.offsetHeight))){n()}}};var K=E.responseXML.getElementsByTagName("empty")[0].getAttribute("total");if(!C){C=new Option(" ","");C.innerHTML=getLabel("js-relation-total")+K+". "+getLabel("js-relation-use_search");y.insertBefore(C,y.firstChild)}}return}var I=E.responseXML.getElementsByTagName("object");var L=[];var F=0;for(F=0;F<y.options.length;F++){if(y.options[F].selected){L.push(y.options[F].value)}}jQuery("option",y).each(function(){if(!this.selected||this.value.length===0){jQuery(this).remove()}});if(j){$(y).prepend("<option value=''> </option>")}for(F=0;F<I.length;F++){var J=I[F].getAttribute("id");var G=false;for(var M in L){if(L[M]==J){G=true;delete L[M];break}}if(!G){var N=I[F].getAttribute("name");var D=new Option(N,J);D.innerHTML=N;y.appendChild(D)}}if(jQuery.browser.msie){var H=y.style.display;y.style.display="none";y.style.display=H}};this.updateItems=function(E){t=null;A=E.responseXML.getElementsByTagName("object");if(!A.length){return}var F=null;if(!a){a=document.createElement("div");a.className="relationAutosuggest";var H=jQuery(B).offset();a.style.position="absolute";a.style.zIndex=1050;a.style.width=B.clientWidth+"px";a.style.top=(H.top+B.offsetHeight)+"px";a.style.left=H.left+"px";F=document.createElement("ul");a.appendChild(F);document.body.appendChild(a)}a.style.display="";jQuery(document).mousemove(o);F=a.firstChild;while(F.firstChild){F.removeChild(F.firstChild)}for(i=0;i<A.length;i++){var G=A[i].getAttribute("name");var D=document.createElement("li");D.innerHTML=G;D.onmouseover=function(){g(this.suggestIndex)};D.onmouseout=function(){this.className=""};D.onclick=function(){k();n()};D.suggestIndex=i;F.appendChild(D)}};var o=function(D){if(!D){m=event.clientX+document.body.scrollLeft;l=event.clientY+document.body.scrollTop}else{m=D.pageX;l=D.pageY}return true};this.addItem=function(E,D){if(!(E&&E.length)&&!(B&&B.value.length)){return}x();u();if(!y.multiple&&f&&!E&&!D){f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+B.value;f.value=D?D:B.value;y.selectedIndex=0}else{f=new Option(E?E:B.value,D?D:B.value);f.innerHTML=(D?"":"&rarr;&nbsp;&nbsp;")+(E?E:B.value);if(y.options.length){y.insertBefore(f,y.firstChild)}else{y.appendChild(f)}}B.value="";f.selected=true;if(jQuery.browser.msie){setTimeout(function(){f.selected=false;f.selected=true},20)}};var g=function(E){if(a.style.display!="none"){var F=a.firstChild;var D=F.childNodes.item(t);if(D){D.className=""}F.childNodes.item(E).className="active";t=E}};var k=function(){if(a&&a.style.display!="none"&&t!==null){var G=A[t].getAttribute("name");var F=A[t].getAttribute("id");var E=false;for(var D=0;D<y.options.length;D++){if(y.options[D].value==F){E=true;y.options[D].selected=true;break}}if(!E){e.addItem(G,F)}}else{if(B.value.length&&s){e.addItem()}}};var n=function(){if(a&&a.style.display!="none"){a.style.display="none";jQuery(document).unbind("mousemove",o)}};this.doSearch=function(){var G=B.value.toLowerCase();x();if(G==""){if(y.multiple){u()}return}for(var E=0;E<y.options.length;E++){var H=y.options[E].text;var F=H.replace(/^.\s\s/,"");if(H.substring(0,G.length).toLowerCase()===G||F.substring(0,G.length).toLowerCase()===G){if(y.multiple){if(y.firstChild.nodeName.toLowerCase()!="optgroup"){p();searchGroup=y.firstChild;itemsGroup=y.lastChild}var D=y.options[E];if(D.parentNode==searchGroup){continue}D.oldPrevSibling=D.previousSibling;itemsGroup.removeChild(D);searchGroup.appendChild(D);if(searchGroup.childNodes.length==5){return}}else{y.selectedIndex=E;return}}}};this.doSearchAjax=function(){if(B.value){this.loadItems(B.value)}};var p=function(){var E=document.createElement("optgroup");E.label="Search results";var D=document.createElement("optgroup");D.label="------------------------------------------------";while(y.firstChild){var F=y.firstChild;y.removeChild(F);D.appendChild(F)}y.appendChild(E);y.appendChild(D)};var u=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){y.removeChild(y.firstChild);var D=y.firstChild;while(D.firstChild){var E=D.firstChild;D.removeChild(E);y.appendChild(E)}y.removeChild(D)}};var x=function(){if(y.firstChild&&y.firstChild.nodeName.toLowerCase()=="optgroup"){var E=y.firstChild;var D=y.lastChild;while(E.firstChild){var F=E.firstChild;E.removeChild(F);if(F.oldPrevSibling!==undefined||F.oldPrevSibling==null){if(F.oldPrevSibling&&F.oldPrevSibling.nextSibling){D.insertBefore(F,F.oldPrevSibling.nextSibling)}else{if(F.oldPrevSibling===null){D.insertBefore(F,D.firstChild)}else{D.appendChild(F)}}F.oldPrevSibling=undefined}}}};w()};