function filter(){this.AllText=new Array();this.Props=new Object();this.EntIDs=new Array();this.Parents=new Array();this.Langs=new Array();this.Domains=new Array();this.Orders=new Object();this.Perms=true;this.Full=true;this.FldsOr=false;this.Depth=null;this.CheckVirtual=true;this.Page=null;this.hTypes=new Array();this.oTypes=new Array();this.setAllTextSearch=function(b){if(b instanceof Array){if(this.AllText.length){this.AllText.splice(this.AllText.length,b.length,b)}else{this.AllText=b}}else{this.AllText.push(b)}};this.setHTypes=function(b){if(b instanceof Array){this.hTypes=b}else{this.hTypes.push(b)}};this.setPropertyEqual=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["eq"]=b};this.setPropertyNotEqual=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["ne"]=b};this.setPropertyLike=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["like"]=b};this.setPropertyLess=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["lt"]=b};this.setPropertyGreater=function(c,b){if(this.Props[c]==undefined){this.Props[c]=new Object()}this.Props[c]["gt"]=b};this.setPropertyBetween=function(d,c,b){if(this.Props[d]==undefined){this.Props[d]=new Object()}this.Props[d]["gt"]=c;this.Props[d]["lt"]=b};this.removeProperty=function(b){this.Props[b]=undefined};this.addOrder=function(d,c){var b=true;if(c!=undefined&&(c===false||c.toUpperCase()=="DESC"||c.toUpperCase()=="BACKWARD")){b=false}this.Orders[d]=b};this.setOrder=function(d,c){var b=true;if(c!=undefined&&(c===false||c.toUpperCase()=="DESC"||c.toUpperCase()=="BACKWARD")){b=false}this.Orders=new Object();this.Orders[d]=b};this.setPermissions=function(b){if(b==undefined){this.Perms=true}else{this.Perms=b?true:false}};this.setParentElements=function(b){if(b instanceof Array){this.Parents=b}else{this.Parents.push(b)}};this.setDepth=function(b){if(typeof(b)!=="undefined"){this.Depth=parseInt(b)}};this.setEntityIDs=function(b){if(b instanceof Array){this.EntIDs=b}else{this.EntIDs.push(b)}};this.setDomain=function(b){if(b instanceof Array){this.Domains=b}else{this.Domains.push(b)}};this.setLang=function(b){if(b instanceof Array){this.Langs=b}else{this.Langs.push(b)}};this.setHtypes=function(b){if(b instanceof Array){this.hTypes=b}else{this.hTypes.push(b)}};this.setOtypes=function(b){if(b instanceof Array){this.oTypes=b}else{this.oTypes.push(b)}};this.setVirtualCopyChecking=function(b){if(typeof(b)=="undefined"){this.CheckVirtual=true}else{this.CheckVirtual=b?true:false}};this.setViewMode=function(b){if(typeof(b)=="undefined"){this.Full=true}else{this.Full=b?true:false}};this.setConditionModeOr=function(b){if(typeof(b)=="undefined"){this.FldsOr=true}else{this.FldsOr=b?true:false}};this.getParents=function(){return this.Parents};this.setPage=function(b){this.Page=parseInt(b)};this.getPage=function(){return this.Page};this.getQueryString=function(b){var f=new Array();var e=0;if(b instanceof Object){var g=new Object();for(e in b.Props){g[e]=b.Props[e]}for(e in this.Props){g[e]=this.Props[e]}for(e in g){for(var d in g[e]){if(g[e][d] instanceof Array){for(var c=0;c<g[e][d].length;c++){f.push("fields_filter["+e+"]["+d+"][]="+encodeURIComponent(g[e][d][c]))}}else{f.push("fields_filter["+e+"]["+d+"]="+encodeURIComponent(g[e][d]))}}}for(e=0;e<this.AllText.length;e++){f.push("search-all-text[]="+encodeURIComponent(this.AllText[e]))}for(e=0;e<b.AllText.length;e++){f.push("search-all-text[]="+encodeURIComponent(b.AllText[e]))}if(f.length){jQuery("#search_result").addClass("active");jQuery("#search_result").html(getLabel("js-search-result"))}else{if(!this.Parents.length&&!b.Parents.length){jQuery("#search_result").html("");jQuery("#search_result").removeClass("active")}}for(e=0;e<this.EntIDs.length;e++){f.push("id[]="+this.EntIDs[e])}for(e=0;e<b.EntIDs.length;e++){f.push("id[]="+b.EntIDs[e])}for(e=0;e<this.Parents.length;e++){f.push("rel[]="+this.Parents[e])}for(e=0;e<b.Parents.length;e++){f.push("rel[]="+b.Parents[e])}for(e=0;e<this.hTypes.length;e++){f.push("hierarchy_types[]="+this.hTypes[e])}for(e=0;e<this.Domains.length;e++){f.push("domain_id[]="+this.Domains[e])}for(e=0;e<b.Domains.length;e++){f.push("domain_id[]="+b.Domains[e])}for(e=0;e<this.Langs.length;e++){f.push("lang_id[]="+this.Langs[e])}for(e=0;e<b.Langs.length;e++){f.push("lang_id[]="+b.Langs[e])}for(e=0;e<b.oTypes.length;e++){f.push("object_types[]="+b.oTypes[e])}g=new Object();for(e in b.Orders){g[e]=b.Orders[e]}for(e in this.Orders){g[e]=this.Orders[e]}for(e in g){f.push("order_filter["+e+"]="+(g[e]?"asc":"desc"))}if(this.Perms!==null){if(this.Perms){f.push("permissions")}else{if(b.Perms){f.push("permissions")}}}if(this.CheckVirtual!==null){if(this.CheckVirtual){f.push("virtuals")}else{if(b.CheckVirtual){f.push("virtuals")}}}if(this.Depth!==null){f.push("depth="+this.Depth)}else{if(b.Depth!==null){f.push("depth="+b.Depth)}}if(this.Page!==null){f.push("p="+this.Page)}else{if(b.Page!==null){f.push("p="+b.Page)}}if(this.FldsOr||b.FldsOd){f.push("or-mode")}if(this.Full||b.Full){f.push("viewMode=full")}}else{for(e in this.Props){for(var d in this.Props[e]){if(this.Props[e][d] instanceof Array){for(var c=0;c<this.Props[e][d].length;c++){f.push("fields_filter["+e+"]["+d+"][]="+encodeURIComponent(this.Props[e][d][c]))}}else{f.push("fields_filter["+e+"]["+d+"]="+encodeURIComponent(this.Props[e][d]))}}}for(e=0;e<this.AllText.length;e++){f.push("search-all-text[]="+encodeURIComponent(this.AllText[e]))}for(e=0;e<this.EntIDs.length;e++){f.push("id[]="+this.EntIDs[e])}for(e=0;e<this.Parents.length;e++){f.push("rel[]="+this.Parents[e])}for(e=0;e<this.Domains.length;e++){f.push("domain_id[]="+this.Domains[e])}for(e=0;e<this.Langs.length;e++){f.push("lang_id[]="+this.Langs[e])}for(e in this.Orders){f.push("order_filter["+e+"]="+(this.Orders[e]?"asc":"desc"))}if(this.Perms){f.push("permissions")}if(this.CheckVirtual){f.push("virtuals")}if(this.Depth!==null){f.push("depth="+this.Depth)}if(this.Page!==null){f.push("p="+this.Page)}if(this.FldsOr){f.push("or-mode")}if(this.Full){f.push("viewMode=full")}}f.push("childs");f.push("links");f.push("templates");return"?"+f.join("&")};this.clear=function(){this.AllText=new Array();this.Props=new Object();this.EntIDs=new Array();this.Parents=new Array();this.Langs=new Array();this.Domains=new Array();this.Orders=new Object();this.Perms=true;this.Depth=null;this.Page=null;this.Full=true;this.FldsOr=false;this.CheckVirtual=null};this.empty=function(){var b=0;var d=0;for(var c in this.Props){b++;if(b){break}}for(var c in this.Orders){d++;if(d){break}}return !this.AllText.length&&!this.EntIDs.length&&!this.Parents.length&&!this.Langs.length&&!this.Domains.length&&!b&&!d&&this.Perms&&this.Full&&!this.Depth&&!this.Page&&!this.FldsOr&&!this.CheckVirtual};var a=function(e){if(!e||"object"!==typeof e){return e}var f="function"===typeof e.pop?[]:{};var d,b;for(d in e){if(e.hasOwnProperty(d)){b=e[d];if(b&&"object"===typeof b){f[d]=a(b)}else{f[d]=b}}}return f};this.clone=function(){return a(this)}}var TableItem=function(z,t,u,N,J){var E=parseInt(u.id);var l=this;var I=u;var G=t;var y=N||null;var s=J||"after";var c=typeof(u["force-draw"])!=="undefined"?parseInt(u["force-draw"]):1;var P=typeof(u.childs)!=="undefined"?parseInt(u.childs):0;var v=(typeof(u.basetype)!=="undefined"&&typeof(u.basetype["module"])==="string")?u.basetype["module"]:"content";var q=(typeof(u.basetype)!=="undefined"&&typeof(u.basetype["method"])==="string")?u.basetype["method"]:"";var F=(typeof(u.basetype)!=="undefined"&&typeof(u.basetype["_value"])==="string")?u.basetype["_value"]:"";var e=z.iconsPath;var o=typeof(u.iconbase)!=="undefined"?u.iconbase:e+"ico_"+v+"_"+q+".png";var w=null;var h=null;var K=null;var O=null;var n=null;var r=SettingsStore.getInstance();var M=true;var a=null;var x=false;var B=z.flatMode;var D=z.objectTypesMode;var m=null;var R=null;var d=null;this.element=null;this.control=z;this.childsContainer=null;this.id=E;this.name=typeof(u.name)!=="undefined"?u.name:getLabel("js-smc-noname-page");this.isRoot=G?false:true;this.loaded=false;this.viewLink=typeof(u.link)!=="undefined"?u.link:false;this.editLink=typeof(u["edit-link"])!=="undefined"?u["edit-link"]:false;this.createLink=typeof(u["create-link"])!=="undefined"?u["create-link"]:false;this.permissions=typeof(u.permissions)!=="undefined"?parseInt(u.permissions):0;this.isActive=typeof(u["is-active"])!=="undefined"?parseInt(u["is-active"]):0;if(D){this.isActive=true}this.isVirtualCopy=typeof(u["virtual-copy"])!=="undefined"?true:false;this.lockedBy=typeof(u["locked-by"])==="object"?u["locked-by"]:null;this.expiration=typeof(u.expiration)==="object"?u.expiration:null;this.templateId=typeof(u["template-id"])!=="undefined"?u["template-id"]:null;this.langId=typeof(u["lang-id"])!=="undefined"?u["lang-id"]:null;this.domainId=typeof(u["domain-id"])!=="undefined"?u["domain-id"]:null;this.allowCopy=typeof(u["allow-copy"])!=="undefined"?parseInt(u["allow-copy"]):true;this.allowActivity=typeof(u["allow-activity"])!=="undefined"?parseInt(u["allow-activity"]):true;this.allowDrag=false;this.parent=G;this.childs=[];this.hasChilds=(P>0||E==0);this.labelControl=null;this.position=false;this.isExpanded=false;this.filter=new filter;this.filter.setParentElements(E);this.level=G?G.level+1:0;this.ignoreEmptyFilter=false;this.pageing={total:0,limit:0,offset:0};this.baseModule=(typeof(u.basetype)!=="undefined"&&typeof(u.basetype["module"])==="string")?u.basetype["module"]:"content";this.baseMethod=(typeof(u.basetype)!=="undefined"&&typeof(u.basetype["method"])==="string")?u.basetype["method"]:"";var H=function(){if(t){t.childs.push(E);if(c){Q(G.childsContainer)}}else{if(c){k()}}};var g=function(S,T){if(B&&l.control.contentType!="pages"){if(l.control.enableObjectsActivity){return(T||S.getValue("is_activated")||S.getValue("is_active")||S.getValue("activated"))!==""}else{return true}}else{return T}};var Q=function(ao){l.isActive=g(l,l.isActive);var U=L();var ak=C();var T=document.createElement("tr");T.setAttribute("rel",E);T.className="ti";T.rel=E;T.className="ti";h=T;l.labelControl=h;var aa=document.createElement("td");aa.className="ti-toggle";w=document.createElement("img");w.className="ti-toggle";var aj=l.hasChilds?e+"expand.png":e+"collapse-disabled.png";w.setAttribute("src",aj);w.onclick=function(){l.toggle();return false};aa.appendChild(w);var an=U.name;var ap=document.createElement("td");ap.className="ti column";ap.id="c_"+l.control.id+"_"+l.id+"_name";var ai=parseInt(an.params[0]);if(!B){ai-=20*(l.level-1)}ap.style.width=ai+"px";ap.style.owerflow="hidden";ap.name="name";var al=document.createElement("div");al.style.width=ai+"px";al.style.owerflow="hidden";ap.appendChild(al);if(!D){new editableCell(l,ap,U.name)}O=document.createElement("img");O.style.border="0px";O.setAttribute("alt",F);O.setAttribute("title",F);O.setAttribute("src",o);O.className="ti-icon";O.onmousedown=function(){return false};if(l.control.allowDrag&&l.allowDrag){O.style.cursor="move"}if(!l.control.flatMode&&!l.control.objectTypesMode){al.appendChild(O)}else{O=null}if(l.expiration){var af=l.expiration.status;if(af){var Z=af.id;var ab=af._value;if(Z){var ar=document.createElement("img");var ae=e+"ico_"+Z+".png";ar.setAttribute("src",ae);ar.setAttribute("alt",ab);ar.setAttribute("title",ab);ar.className="page-status";al.appendChild(ar)}}}K=document.createElement("a");var ag=l.getValue("name");var aA=new String((typeof(ag)=="string"&&ag.length)?ag:"");if(!aA.length){aA=getLabel("js-smc-noname-page")}if(aA.length>45){aA=aA.substring(0,45)+"&#8230;"}al.title=(l.viewLink)?l.viewLink:aA.replace(/<[^>]+>/g,"");K.innerHTML=aA;if(l.editLink){K.setAttribute("href",l.editLink)}else{K.className="unactive";K.onclick=function(){return false}}al.appendChild(K);if(l.isVirtualCopy){var ad=document.createElement("span");ad.className="label-virtual";ad.innerHTML=getLabel("js-smc-virtual-copy");al.appendChild(ad)}if(!l.isActive&&!l.control.objectTypesMode){if(!l.control.flatMode){if(O){jQuery(O).fadeTo(300,0.5)}if(w){jQuery(w).fadeTo(300,0.5)}}jQuery(K).fadeTo(300,0.5)}if(!B){T.appendChild(aa)}T.appendChild(ap);var aq=document.createElement("td");aq.className="ti column";aq.style.width="140px";var am=document.createElement("div");am.style.width="140px";T.appendChild(aq);var ac=2;for(var az in U){var V=ak[az];var aw=U[az]["params"];if(aw[1]=="static"){V=U[az]}if(!V){continue}ac++;var W=document.createElement("td");W.id="c_"+l.control.id+"_"+l.id+"_"+az;W.className="column";W.style.width=aw[0];W.name=az;W.style.cursor="text";aA=l.getValue(az);W.innerHTML='<div style="width:'+U[az]["params"][0]+'">'+aA+"</div>";T.appendChild(W);if(V.dataType){new editableCell(l,W,V)}if(az=="is_activated"||az=="active"||az=="is_active"){d=W}}var at=document.createElement("td");at.className="auto-column";at.innerHTML="&nbsp;";at.style.width="auto";T.appendChild(at);if(y){var ah=null;if(s.toLowerCase()=="after"){ah=y.element.nextSibling}else{ah=y.element}if(ah){l.element=ao.insertBefore(T,ah)}else{l.element=ao.appendChild(T)}}else{l.element=ao.appendChild(T)}if(l.control.dragAllowed&&l.allowDrag){var S="child";jQuery(h).draggable({distance:Control.DragSensitivity,handle:".ti-icon, a",helper:function(){var aC=l.element;var aB=document.createElement("div");aB.innerHTML="<div>"+l.name+"</div>";aB.className="ti-draggable";jQuery(aB).css({position:"absolute",background:"url("+o+") no-repeat 0 4px"});return aB},start:function(){Control.DraggableItem=l;Control.DragMode=true;if(l.control.toolbar){l.control.toolbar.hide()}},stop:function(){if(Control.HandleItem){Control.HandleItem.deInitDroppable();if(Control.DraggableItem){Control.DraggableItem.tryMoveTo(Control.HandleItem,S)}}Control.DraggableItem=null;Control.DragMode=false},drag:function(aB,aH){var aI=aB.pageX;var aG=aB.pageY;var aD=Control.detectItemByMousePointer(aI,aG);var aE=Control.HandleItem;if(aE){aE.deInitDroppable()}Control.HandleItem=aD;if(aD){var aJ=jQuery(aD.control.initContainer).position();var aF=aD.position.bottom-aD.position.top;var aC=aG-aJ.top-aD.position.top;if(aC<aF/3){S="before"}if(aC>aF/3&&aC<2*aF/3){S="child"}if(aC>2*aF/3){S="after"}if(aD.isRoot){S="child"}aD.initDroppable(S)}}})}var ay=document.createElement("tr");ay.style.display="none";var ax=document.createElement("td");ax.colSpan=ac+1;var av=document.createElement("table");av.cellSpacing="0";var X=document.createElement("tbody");av.appendChild(X);X.className="ti-childs-container";var au=document.createElement("tr");au.style.display="none";m=document.createElement("td");m.id="pb_"+l.control.id+"_"+l.id;m.className="pages-bar";if(!B){ac++}m.colSpan=ac;au.appendChild(m);X.appendChild(au);l.childsContainer=X;ax.appendChild(av);if(!B){var Y=document.createElement("td");Y.className="ti-toggle";ay.appendChild(Y)}ay.appendChild(ax);if(!T.nextSibling){ao.appendChild(ay)}else{T.parentNode.insertBefore(ay,T.nextSibling)}};this.tryMoveTo=function(T,Y){if(T){var X=this.control.getRootNodeId();var S=T.id;var U=Y!=="child"?1:0;if(Y=="before"){X=T.id;S=T.parent.id}if(Y=="after"){var V=T.getNextSibling();S=T.parent.id;X=V?V.id:this.control.getRootNodeId()}if(T===this){return false}if(T.checkIsChild(this)){return false}if(X==this.id){return false}var W=T;if(U){W=T.parent?T.parent:T.control.getRoot()}this.control.dataSet.execute("tree_move_element",{element:this.id,before:X,rel:S,"as-sibling":U,domain:T.control.getRoot().name,childs:1,links:1,virtuals:1,permissions:1,templates:1,receiver_item:W,handle_item:this})}};this.initDroppable=function(U){var U=U||"child";var S=Control.DraggableItem;var W=jQuery(this.control.initContainer).position();if(S){if(S===this){return false}if(this.checkIsChild(S)){return false}var T=Control.dropIndicator;if(oTable){var V=jQuery(oTable.container).width();if(V<this.position.right){this.position.right=V}}if(U=="after"){T.style.top=this.position.bottom+W.top+"px";T.style.left=this.position.left+W.left+"px";T.style.width=this.position.right-this.position.left}if(U=="before"){T.style.top=this.position.top+W.top+T.offsetHeight+"px";T.style.left=this.position.left+W.left+"px";T.style.width=this.position.right-this.position.left+"px"}if(U=="child"){T.style.top=this.position.bottom+W.top+"px";T.style.left=this.position.left+W.left+20+"px";T.style.width=this.position.right+W.left-20-this.position.left+"px"}T.style.display="";setTimeout(b,3239)}};this.deInitDroppable=function(){if(!Control.dropIndicator){return}Control.dropIndicator.style.display="none"};var L=function(){if(l.control.usedColumns){return l.control.usedColumns}var S={};var V=r.get(l.control.id,"used-columns");if(V===false){V=l.control.dataSet.getDefaultFields();if(!V){V=""}}if(V.length){var U=V.split("|");for(var T=0;T<U.length;T++){var Y=U[T];var X=U[T];var W=[];var Z=Y.indexOf("[");if(Z){X=Y.substring(0,Z);W=Y.substring(Z+1,Y.length-1).split(",")}S[X]={name:X,params:W}}}if(!S.name){S.name={name:"name",params:["250px"]}}l.control.usedColumns=S;return S};var A=function(){var T=L();var U=[];for(name in T){var S=T[name];if(!S){continue}U[U.length]=name+"["+S.params.join(",")+"]"}r.set(l.control.id,U.join("|"),"used-columns")};var C=function(){if(l.control.columnsMenu){return l.control.columnsMenu}var Z=l.control.dataSet.getCommonFields();var T=L();var ah=l.control.dataSet.getFieldsStoplist();var U={};l.control.needColumnsMenu=false;var W=1,X=0;for(var ai=0;ai<Z.length;ai++){W++;var ac=Z[ai].getElementsByTagName("field");var aa=false;for(var ag=0;ag<ac.length;ag++){var S=ac[ag];var ak=S.getAttribute("title");var af=S.getAttribute("id");var al=S.getAttribute("name");var aj=S.getElementsByTagName("type");var ae=aj[0].getAttribute("data-type");var Y=S.getAttribute("guide-id");if(ae=="symlink"||ae=="password"){continue}var ad=false;for(var ab=0;ab<ah.length;ab++){if(ah[ab]==al){ad=true;break}}if(ad){continue}l.control.needColumnsMenu=true;var V=false;if(T[al]){V=true}U[al]={caption:ak,icon:V?"checked":"undefined",id:af,title:ak,fieldName:al,dataType:ae,guideId:Y,checked:V,execute:function(an){var am=an;an.checked?l.removeColumn(an.fieldName):l.appendColumn(an.fieldName);Control.recalcItemsPosition()}};W++;if(ai<ac.length-1){aa=true}if(V){X++}}if(aa){U[W+"-sep"]="-"}}l.control.columnsMenu=U;return U};this.resizeColumn=function(Z,aa){var U=L();var Y=C();var V=U[Z];if(!V){return false}for(var W=0;W<l.childs.length;W++){var S=l.control.items[l.childs[W]];if(S){S.resizeColumn(Z,aa)}}if(l.isRoot){var T=document.getElementById("h_"+l.control.id+"_"+Z);if(!T){return false}T.style.width=aa+"px";T.firstChild.style.width=aa+"px";U[Z].params[0]=aa+"px";l.control.usedColumns=U;A();var X=document.getElementById("f_"+l.control.id+"_"+Z);if(X){X.style.width=aa+"px";if(X.firstChild){X.firstChild.style.width=aa+"px"}}}else{var T=document.getElementById("c_"+l.control.id+"_"+l.id+"_"+Z);if(!T){return false}if(!B&&Z=="name"){aa-=20*(l.level-1)}T.style.width=aa+"px";T.firstChild.style.width=aa+"px"}return true};this.startResizeColumn=function(ac,ae){var S=document.getElementById("h_"+this.control.id+"_"+ac);if(!S){return false}var Z=this.control.initContainer.offsetHeight;var ad=jQuery(this.control.initContainer).position();var U=jQuery(S).position();U.left-=this.control.initContainer.scrollLeft;var W=S.offsetWidth;var aa=U.left+W;var ab=document.createElement("div");ab.className="resizer";jQuery(ab).css({"z-index":1,position:"absolute",width:"1px",height:Z,borderLeft:"1px dotted #CCC",top:U.top+ad.top,left:aa+ad.left});var V=aa-ae.clientX;ab.style.left=V+"px";var X=W;var T=function(af){try{document.body.style["-moz-user-select"]="none";document.body.style["-khtml-user-select"]="none";document.body.onselectstart=function(){return false};document.selection.empty()}catch(ag){}var ah=af.clientX+V;X=W+ah-aa;if(X>TableItem.maxColumnWidth){X=TableItem.maxColumnWidth}if(X<TableItem.minColumnWidth){X=TableItem.minColumnWidth}ab.style.left=ad.left+U.left+X+"px"};var Y=function(af){jQuery(document).unbind("mousemove",T);jQuery(document).unbind("mouseup",Y);document.body.removeChild(ab);if(X!=W){l.resizeColumn(ac,X);Control.recalcItemsPosition()}};jQuery(document).bind("mousemove",T);jQuery(document).bind("mouseup",Y);document.body.appendChild(ab)};this.appendColumn=function(ad){var U=L();var ab=C();var Y=ab[ad];if(!Y||U[ad]){return false}for(var Z=0;Z<l.childs.length;Z++){var T=l.control.items[l.childs[Z]];if(T){T.appendColumn(ad)}}if(l.isRoot){var W=document.createElement("th");W.className="column";W.setAttribute("id","h_"+l.control.id+"_"+ad);W.setAttribute("name",name);W.name=ad;W.width="100px";var aa=document.createElement("div");aa.title=Y.title;aa.innerHTML=Y.title;W.appendChild(aa);var ac=document.createElement("span");ac.onmousedown=function(ae){if(!ae){ae=window.event}l.startResizeColumn(ad,ae)};aa.appendChild(ac);l.element.firstChild.insertBefore(W,l.element.firstChild.lastChild);U[ad]={name:ad,params:["100px"]};l.control.usedColumns=U;ab[ad].checked=true;ab[ad].icon="checked";l.control.columnsMenu=ab;var X=document.createElement("th");X.setAttribute("id","f_"+l.control.id+"_"+ad);X.style.width=U[ad]["params"][0];l.control.onDrawFieldFilter(ab[ad],X,U[ad].params);R.insertBefore(X,R.lastChild);var S=document.getElementById("pb_"+l.control.id+"_"+l.id);if(S){S.colSpan+=1}A();p()}else{var W=document.createElement("td");W.id="c_"+l.control.id+"_"+l.id+"_"+ad;W.style.width="100px";W.className="column";W.name=ad;if(document.getElementById(W.id)){return true}var V=l.getValue(ad);W.innerHTML="<div>"+V+"</div>";l.element.insertBefore(W,l.element.lastChild);l.childsContainer.parentNode.parentNode.colSpan+=1;new editableCell(l,W,Y)}return true};this.removeColumn=function(ac){var W=L();var ab=C();var X=ab[ac];if(!X||!W[ac]){return false}for(var Z=0;Z<l.childs.length;Z++){var T=l.control.items[l.childs[Z]];if(T){T.removeColumn(ac)}}if(l.isRoot){var V=document.getElementById("h_"+l.control.id+"_"+ac);if(!V){return false}V.parentNode.removeChild(V);var Y=document.getElementById("f_"+l.control.id+"_"+ac);if(Y){Y.parentNode.removeChild(Y)}var aa={};for(var U in W){if(U==ac){continue}aa[U]=W[U]}l.control.usedColumns=aa;ab[ac].checked=false;ab[ac].icon="undefined";l.control.columnsMenu=ab;l.control.onRemoveColumn(X);l.childsContainer.parentNode.parentNode.colSpan-=1;var S=document.getElementById("pb_"+l.control.id+"_"+l.id);if(S){S.colSpan-=1}A();p()}else{var V=document.getElementById("c_"+l.control.id+"_"+l.id+"_"+ac);if(!V){return false}V.parentNode.removeChild(V);l.childsContainer.parentNode.parentNode.colSpan-=1}return true};var p=function(){var T=L();var X=C();var U=0;for(var S in T){var V=X[S];var W=T[S]["params"];if(W[1]=="static"){V=T[S];V.title=getLabel("js-smc-"+S)}if(!V){continue}U++}if(R){R.style.display=(U>0)?"":"none"}};var k=function(){if(!Control.dropIndicator){var av=document.createElement("div");av.className="ti-drop";Control.dropIndicator=document.body.appendChild(av)}var W=L();var ai=C();var U=0,ae=0;for(var ap in ai){++U}var T=document.createElement("thead");T.setAttribute("name",l.control.id);var V=document.createElement("tr");V.className="header-row";R=document.createElement("tr");R.className="filter-row";var ac=function(ax){return function(ay){if(!ay){ay=window.event}l.startResizeColumn(ax,ay);return true}};var au=document.createElement("th");au.colspan="1";au.className="void";var ak=W.name;var ab=document.createElement("th");ab.className="column";ab.setAttribute("id","h_"+l.control.id+"_name");ab.setAttribute("name","name");ab.name="name";ab.style.width=ak.params[0];var ao=document.createElement("div");ao.style.width=ak.params[0];ao.innerHTML=getLabel("js-smc-name-column");ao.title=getLabel("js-smc-name-column");var ag=document.createElement("span");ag.onmousedown=ac("name");ao.appendChild(ag);ab.appendChild(ao);if(!B){V.appendChild(au);R.appendChild(au.cloneNode(true));R.firstChild.className="filter-void"}V.appendChild(ab);var an=document.createElement("th");an.className="column";an.style.width="140px";var af=document.createElement("div");af.style.width="132px";an.appendChild(af);V.appendChild(an);var am=document.createElement("th");am.setAttribute("id","f_"+l.control.id+"_name");am.style.width=ak.params[0];l.control.onDrawFieldFilter("name",am,ak.params);R.appendChild(am);var S=document.createElement("th");S.id="f_"+l.control.id+"_manage";S.style.width="140px";R.appendChild(S);var ad=2;for(var aw in W){var X=ai[aw];var at=W[aw]["params"];if(at[1]=="static"){X=W[aw];X.title=getLabel("js-smc-"+aw)}if(!X){continue}ad++;var Z=document.createElement("th");Z.className="column";Z.setAttribute("id","h_"+l.control.id+"_"+aw);Z.setAttribute("name",aw);Z.style.width=W[aw]["params"][0];Z.name=aw;ao=document.createElement("div");ao.style.width=W[aw]["params"][0];ao.title=X.title;ao.innerHTML=X.title;Z.appendChild(ao);ag=document.createElement("span");ag.onmousedown=ac(aw);ao.appendChild(ag);V.appendChild(Z);var ah=document.createElement("th");ah.setAttribute("id","f_"+l.control.id+"_"+aw);ah.style.width=W[aw]["params"][0];l.control.onDrawFieldFilter(X,ah,W[aw].params);R.appendChild(ah);++ae}var aq=document.createElement("th");aq.style.width="auto";R.appendChild(aq.cloneNode(true));if(!l.control.objectTypesMode&&l.control.needColumnsMenu){var aj=document.createElement("div");aj.className="invoke-btn";aq.appendChild(aj);jQuery(aj).bind("click",function(ax){jQuery.cmenu.lockHiding=true;jQuery.cmenu.show(jQuery.cmenu.getMenu(l.control.columnsMenu),l.control.initContainer.offsetParent,ax);return});jQuery(aj).bind("mousedown",function(ax){if(ax.altKey){jQuery.cmenu.lockHiding=true;jQuery.cmenu.show(jQuery.cmenu.getMenu(l.control.columnsMenu),l.control.initContainer.offsetParent,ax);return}});jQuery(aj).bind("mouseout",function(){jQuery.cmenu.lockHiding=false})}V.appendChild(aq);T.appendChild(V);if(!l.control.objectTypesMode){T.appendChild(R)}p();jQuery(T).bind("click",function(ay){var ax=ay.target;if(ax.parentNode.tagName.toUpperCase()!="TH"){return}TableItem.orderByColumn(ax.parentNode.name,l.control,ax)});var aa=document.createElement("tbody");aa.className="table-container";var ar=document.createElement("tr");ar.style.display="none";m=document.createElement("td");m.id="pb_"+l.control.id+"_"+l.id;m.className="pages-bar";if(!B){ad++}m.colSpan=ad;ar.appendChild(m);aa.appendChild(ar);l.element=l.control.container.appendChild(T);l.childsContainer=l.control.container.appendChild(aa);l.control.initContainer=l.control.container;l.control.container=l.childsContainer;if(B&&!D){var Y=function(){var ax=l.getExportLink();window.location=ax};var al=function(){var ax=l.getImportLink();l.callCsvImport(ax);return false};l.showCsvButtons(Y,al)}l.expand()};this.showCsvButtons=function(W,U){if(this.control.disableCSVButtons){return}l.hideCsvButtons();var V=document.createElement("div");V.id="csv-buttons";var T=document.createElement("a");T.appendChild(document.createTextNode(getLabel("js-csv-export")));T.href="#";T.className="csvLink csvExport";T.onclick=W;V.appendChild(T);if(!this.control.hideCsvImportButton){var S=document.createElement("a");S.appendChild(document.createTextNode(getLabel("js-csv-import")));S.href="#";S.className="csvLink csvImport";S.onclick=U;V.appendChild(S)}l.control.container.parentNode.parentNode.appendChild(V);l.csvButtons=V};this.hideCsvButtons=function(){if(l.csvButtons){jQuery(l.csvButtons).remove();l.csvButtons=false}jQuery("#csv-buttons").remove()};this.getExportLink=function(T){var V=L();var U=this.control.getCurrentFilter().getQueryString();var X=document.location.pathname+U+"&xmlMode=force&export=csv";for(var W in V){var S=V[W]["name"];if(S!="name"){X+="&used-fields[]="+S}}if(T){X+="&rel[]="+T}return X};this.getImportLink=function(S){var T=this.control.getCurrentFilter().getQueryString();var U=document.location.pathname;U+=T+"&xmlMode=force&import=csv";if(S){U+="&rel[]="+S}return U};this.callCsvImport=function(T){var S="<form method='post' id='import-csv-form' enctype='multipart/form-data' action='"+T+"' mime-type='text/html'";S+=" target='import-iframe'>";S+="<label for='csv-file'>"+getLabel("js-csv-import-question")+"</label> ";S+="<input type='file' name='csv-file' id='csv-file' size='28' /><br />";S+="<label for='ignore-id'>"+getLabel("js-csv-import-ignore-id")+"</label><input type='checkbox' name='ignore-id' id='ignore-id' />";S+="</form>";S+="<iframe name='import-iframe' id='import-iframe' src='' style='display: none;'></iframe>";window.csvQuickImportCallback=function(){closeDialog();document.location.href=document.location.href};openDialog({text:S,OKText:getLabel("js-csv-import-button"),OKCallback:function(){jQuery("#import-csv-form").submit();return false}})};var b=function(){if(M&&l===Control.HandleItem){l.expand()}};this.draw=function(){if(t){if(!c){Q(G.childsContainer)}}else{if(!c){k()}}};this.appendChild=function(S){return new TableItem(this.control,l,S)};this.appendAfter=function(S,T){return new TableItem(this.control,l,S,T,"after")};this.appendBefore=function(S,T){return new TableItem(this.control,l,S,T,"before")};this.appendFirst=function(S){if(!this.childsContainer.childNodes.length){return this.appendChild(S)}else{if(typeof(this.childsContainer.childNodes[1].rel)!="undefined"){return this.appendBefore(S,this.control.getItem(this.childsContainer.childNodes[1].rel))}else{return false}}};this.getPreviousSibling=function(){var S=this.element.previousSibling;if(S&&S.rel){return this.control.getItem(S.rel)}return null};this.getNextSibling=function(){var S=this.element.nextSibling;if(S&&S.rel){return this.control.getItem(S.rel)}return null};this.clear=function(){if(this.isRoot){var S=this.element.parentNode;while(S.firstChild){S.removeChild(S.firstChild)}}else{if(this.element.parentNode){this.element.parentNode.removeChild(this.element.nextSibling);this.element.parentNode.removeChild(this.element)}}};this.checkIsChild=function(T){var S=this.parent;while(S){if(T===S){return true}S=S.parent}return false};this.recalcPosition=function(){if(l.isRoot){return false}try{var T=this.parent;while(T){if(!T.isExpanded){this.position=false;return false}T=T.parent}var S=this.control.getRoot().childsContainer;var V=jQuery(h).position();this.position={left:V.left,top:V.top,right:V.left+S.offsetWidth,bottom:V.top+jQuery(h).height()};return this.position}catch(U){this.position=false;return false}};this.setLoaded=function(S){this.loaded=S;var T=S?e+"collapse.png":e+"expand.png";if(w){w.setAttribute("src",e+"collapse.png")}};var f=function(U){if(!U){return""}if(!U.type){return""}var X="",Z,T;var ab=function(ad,ae){return ad.value._value||(ad.value||(ae||""))};switch(U.type){case"int":case"float":case"price":case"counter":X=ab(U,0);break;case"tags":case"string":X=ab(U);if(typeof X=="array"){Z=X.join(", ");X=Z}if(/http:\/\//.test(X)){X='<a href="'+X+'" title="'+X+'" class="link">'+X+"</a>"}else{X='<span title="'+X+'">'+X+"</span>"}break;case"text":X=ab(U);if(X){X='<span title="'+X+'">'+X.substring(0,255)+"</span>"}break;case"boolean":X=ab(U,false)?'<img alt="" style="width:13px;height:13px;" src="/images/cms/admin/mac/tree/checked.png" />':"";break;case"img_file":X=U.value;if(X){var W=X.ext;T=X._value;var ac=T.substring(0,T.lastIndexOf("."));var aa="/autothumbs.php?img="+ac+"_sl_180_120."+W;var S="";if(typeof T=="string"){Z=T.split(/\//);S=Z[Z.length-1]}X='<img alt="" style="width:13px;height:13px;" src="/images/cms/image.png" onmouseover="TableItem.showPreviewImage(event, \''+aa+"')\" />";if(S){X+='&nbsp;&nbsp;<span title="'+T+'">'+S+"</span>"}}break;case"file":X=U.value;if(X){T=X._value;X=T?('<span title="'+T+'">'+T+"</span>"):""}break;case"relation":var V=ab(U,null);if(V){if(V.item[0]){for(var Y=0;Y<V.item.length;Y++){X+=V.item[Y].name;if(Y<V.item.length-1){X+=", "}}}else{X=V.item.name}X='<span title="'+X+'">'+X+"</span>"}break;case"date":X=U.value["formatted-date"];break;case"wysiwyg":X=ab(U,null);if(X["#text"]){X=X["#text"].join()}X=X.replace(/<\/?[^>]+>/g,"");break;default:return"";break}return X};this.getValue=function(Y){var V=L();var U=V[Y];if(Y=="name"){return this.control.onGetValueCallback(this.name,Y,this)}if(U){if(U.params[1]=="static"){return this.control.onGetValueCallback(U,Y,this)}}if(!I.properties){return""}if(!I.properties["group"]){return""}var X=typeof(I.properties["group"][0])!="undefined"?I.properties["group"]:[I.properties["group"]];for(var W=0;W<X.length;W++){if(!X[W]["property"]){continue}var S=typeof(X[W]["property"][0])!="undefined"?X[W]["property"]:[X[W]["property"]];for(var T=0;T<S.length;T++){if(S[T]["name"]==Y){S[T]=this.control.onGetValueCallback(S[T],Y,this);return f(S[T])}}}return""};this.getData=function(){return I};this.setPageing=function(V){if(!V||!m){return false}this.pageing=V;m.parentNode.style.display="none";m.innerHTML="";m.style.textAlign="left";if(V.total==0){m.parentNode.style.display="";var aa=document.createElement("span");aa.className="empty-result";if(this.isRoot){m.style.textAlign="center"}aa.appendChild(document.createTextNode(getLabel("js-smc-empty-result")));m.appendChild(aa)}if(V.total>V.limit||V.offset>0){var U=document.createElement("span");U.appendChild(document.createTextNode(getLabel("js-pages-label")));U.className="pagesLabel";m.appendChild(U);m.parentNode.style.display="";var T=Math.ceil(V.total/V.limit);var S=Math.ceil(V.offset/V.limit);var W=function(ab){return function(){l.filter.setPage(ab);l.applyFilter(l.filter,true);return false}};var Y=false;var Z=false;for(var X=0;X<T;X++){if(X!=0&&X!=(Math.ceil(V.total/V.limit)-1)){if(Math.abs(X-S)>15){if(!Y){Z=document.createElement("a");Z.href="#";if(S==X){Z.className="current"}Z.innerHTML="&#8230;";Z.className="current";Z.onclick=function(){return false};m.appendChild(Z)}Y=true;continue}}Y=false;Z=document.createElement("a");Z.href="#";if(S==X){Z.className="current"}Z.innerHTML=X+1;Z.onclick=W(X);m.appendChild(Z)}}};this.expand=function(){if(!this.hasChilds){return false}this.isExpanded=true;if(!this.loaded){this.loaded=true;this.control.load(this.filter);if(w){w.setAttribute("src",e+"loading.gif")}}else{if(w){w.setAttribute("src",e+"collapse.png")}}this.childsContainer.parentNode.parentNode.parentNode.style.display="";if(this.loaded){Control.recalcItemsPosition()}this.control.saveItemState(this.id)};this.collapse=function(){if(!this.hasChilds){return false}this.isExpanded=false;if(w){w.setAttribute("src",e+"expand.png")}this.childsContainer.parentNode.parentNode.parentNode.style.display="none";Control.recalcItemsPosition();this.control.saveItemState(this.id)};this.toggle=function(){if(this.hasChilds){this.isExpanded?this.collapse():this.expand()}};this.update=function(T){if(T){if(this.id!=T.id){return false}I=T;if(typeof(T["template-id"])!=="undefined"){this.templateId=T["template-id"]}if(typeof(T.link)!=="undefined"&&T.link!=this.viewLink){this.viewLink=T.link;h.setAttribute("href",this.viewLink)}if(typeof(T.childs)!=="undefined"&&parseInt(T.childs)!==P){P=parseInt(T.childs);this.hasChilds=P>0||E==0;var S=e+"collapse-disabled.png";if(this.hasChilds){S=this.isExpanded?e+"collapse.png":e+"expand.png"}if(!this.hasChilds){this.isExpanded=this.loaded=false}if(w){w.setAttribute("src",S)}}var U=typeof(T["is-active"])!=="undefined"?parseInt(T["is-active"]):0;if(U!==this.isActive){this.isActive=U;this.isActive=g(this,this.isActive);if(!this.isActive&&!l.control.objectTypesMode){if(!l.control.flatMode){jQuery(O).fadeTo(300,0.5);jQuery(w).fadeTo(300,0.5)}jQuery(K).fadeTo(300,0.5)}else{if(!l.control.flatMode&&!l.control.objectTypesMode){jQuery(O).fadeTo(300,1);jQuery(w).fadeTo(300,1)}jQuery(K).fadeTo(300,1)}if(d){jQuery("div",d).html(f({type:"boolean",value:this.isActive}))}}if(typeof(T.name)!=="undefined"&&T.name!=this.name){this.name=T.name.length?T.name:"";K.innerHTML=this.name.length?this.name:getLabel("js-smc-noname-page")}}};this.applyFilter=function(U,T){if(U instanceof Object){this.filter=U}else{this.filter.clear()}if(!T){this.filter.setParentElements(E)}if(this.loaded){this.control.removeItem(E,true);this.loaded=false;if(this.isExpanded){this.expand()}}if(this.isRoot){if(this.control.getCurrentFilter().empty()&&!this.ignoreEmptyFilter&&!(this.control.flatMode&&!this.control.objectTypesMode)){}else{var V=function(){var W=l.getExportLink();if(l.control.contentType=="pages"){W+="&force-hierarchy=1"}window.location=W};var S=function(){var W=l.getImportLink();if(l.control.contentType=="pages"){W+="&force-hierarchy=1"}W+="&rnd="+Math.round(Math.random()*1000%1000);l.callCsvImport(W);return false};if(this.control.contentType!="objectTypes"){l.showCsvButtons(V,S)}}}};this.setSelected=function(S){if(S){if(!a){a="ti";h.className="ti selected-highlight"}x=true}else{if(a){h.className=a;a=null}x=false}};this.getSelected=function(){return x};H()};TableItem.minColumnWidth=110;TableItem.maxColumnWidth=800;TableItem.orderByColumn=function(e,a,b){if(!a||!e||!b){return false}var d="asc";if(a.orderColumn===b){d=b.className=="asc"?"desc":"asc";b.className=d}else{if(a.orderColumn){a.orderColumn.className=""}a.orderColumn=b;a.orderColumn.className=d}var c=a.dataSet.getDefaultFilter();c.setOrder(e,d);a.dataSet.setDefaultFilter(c);a.applyFilter()};TableItem.showPreviewImage=function(d,e){if(!d||!e){return}var c=(!d.target)?d.toElement:d.target;var a=(!d.pageX)?d.clientX:d.pageX;var f=(!d.pageY)?d.clientY:d.pageY;var b=document.createElement("img");b.setAttribute("src",e);b.src=e;b.className="img-fieled-preview";b.style.position="absolute";b.style.width="180px";b.style.height="120px";b.style.top=f+10+"px";b.style.left=a+10+"px";b.style.border="1px solid #666";document.body.appendChild(b);c.onmouseout=function(){b.parentNode.removeChild(b)}};var TreeToolbar=function(e){var m=this;var b=e;var f=null;var g=parseInt(b.container.style.zIndex)||0;var d=b.iconsPath;var c=b.dataSet;this.highlight=null;this.element=null;this.buttons=new Array();var h=function(){var n=document.createElement("div");n.style.position="absolute";n.style.display="none";n.className="tree_toolbar";a(n,{name:"ico_del",hint:getLabel("js-del-str"),init:function(p){var r=p.element;if(f!==null&&f.permissions&8){var q=d+"ico_del.png";var s=getLabel("js-del-str");if(f.lockedBy){var u=f.lockedBy;var o=typeof(u.lname)=="string"?u.lname:"";var t=typeof(u.lname)=="string"?u.fname:"";q=d+"ico_locked.png";s=getLabel("js-page-is-locked")}r.setAttribute("title",s);r.style.background="url('"+q+"') no-repeat";r.setAttribute("href","#");r.style.visibility="visible"}else{r.style.visibility="hidden"}},release:function(o){if(f!==null){if(f.lockedBy){alert(getLabel("js-page-is-locked"))}else{c.execute("tree_delete_element",{childs:1,element:f.id,handle_item:f})}}return false}});a(n,{name:"ico_add",hint:getLabel("js-add-subpage"),init:function(o){if(f!==null&&f.createLink!==false&&(f.permissions&&f.permissions&4||!f.permissions)){o.element.setAttribute("href",f.createLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}});a(n,{name:"ico_edit",hint:getLabel("js-edit-page"),init:function(q){var s=q.element;if(f!==null&&f.editLink!==false&&f.permissions&2){var r=d+"ico_edit.png";var t=getLabel("js-edit-page");var p=f.editLink;if(f.lockedBy){var v=f.lockedBy;var o=typeof(v.lname)=="string"?v.lname:"";var u=typeof(v.lname)=="string"?v.fname:"";r=d+"ico_locked.png";t=getLabel("js-page-is-locked");p="#"}s.setAttribute("title",t);s.style.background="url('"+r+"') no-repeat";s.setAttribute("href",p);s.style.visibility="visible"}else{s.style.visibility="hidden"}},release:function(o){if(f!==null){if(f.lockedBy){alert(getLabel("js-page-is-locked"));return false}}return true}});a(n,{name:"blocking",hint:getLabel("js-disable-page"),icon:d+"ico_block.png",init:function(o){if(f!==null&&f.allowActivity){var p=f.isActive?d+"ico_unblock.png":d+"ico_block.png";var q=f.isActive?getLabel("js-disable-page"):getLabel("js-enable-page");o.element.style.background="url('"+p+"') no-repeat";o.element.setAttribute("href","#");o.element.setAttribute("title",q);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){var p=f.isActive?d+"ico_block.png":d+"ico_unblock.png";var q=f.isActive?getLabel("js-enable-page"):getLabel("js-disable-page");o.element.setAttribute("title",q);o.element.style.background="url('"+p+"') no-repeat";c.execute("tree_set_activity",{element:f.id,active:f.isActive?0:1,handle_item:f})}return false}});a(n,{name:"copy",hint:getLabel("js-vcopy-str"),init:function(o){if(f!==null&&f.allowCopy){o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){f.className="ti virtual";if(f.isDefault){f.labelControl.className+=" main-page"}f.isVirtualCopy=true;c.execute("tree_copy_element",{element:f.id,childs:1,links:1,virtuals:1,permissions:1,handle_item:f,copy_all:0})}return false}});a(n,{name:"clone",hint:getLabel("js-copy-str"),init:function(o){if(f!==null&&f.allowCopy){o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){c.execute("tree_copy_element",{element:f.id,childs:1,links:1,permissions:1,handle_item:f,copy_all:0,clone_mode:1})}return false}});a(n,{name:"view",hint:getLabel("js-view-page"),init:function(o){if(f!==null&&f.viewLink!==false){o.element.setAttribute("href",f.viewLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}});m.element=document.body.appendChild(n)};var l=function(){for(var n=0;n<m.buttons.length;n++){m.buttons[n].init(m.buttons[n])}};var a=function(p,w){var t=document.createElement("a");var n=w.name||"toolbtn";var o=w.href||"#";var s=w.icon||d+n+".png";var v=w.init||function(){};var u=w.hint||"";var q=p.appendChild(t);var r={name:n,href:o,icon:s,init:v,element:q};m.buttons[m.buttons.length]=r;q.setAttribute("href",o);q.setAttribute("title",u);q.className=w.className||"tree_toolbtn";if(typeof(w.release)==="function"){q.onclick=function(){if(!c.isAvailable()){return false}return w.release(r)}}else{q.onclick=function(){if(!c.isAvailable()){return false}if(f.focus){f.focus()}return true}}q.name=n;q.style.background="url('"+s+"') no-repeat"};var k=function(){var n=document.createElement("div");n.className="tree-highlight";n.style.display="none";n.style.position="absolute";n.style.zIndex=g-1;m.highlight=b.container.appendChild(n);h()};this.show=function(p,o){o=o||false;if(typeof(p)==="undefined"||(f===p&&!o)){return false}if(f){f.labelControl.className="ti";if(f.isDefault){f.labelControl.className+=" main-page"}}f=p;f.labelControl.className=f.getSelected()?"ti selected-highlight":"ti hightlight";if(f.isDefault){f.labelControl.className+=" main-page"}l();var n=f.control.initContainer;var q=jQuery(n).position();this.element.style.top=f.position.top+q.top+"px";this.element.style.left=q.left+530+"px";this.element.style.display=""};this.hide=function(){if(f){f.labelControl.className=f.getSelected()?"ti selected":(f.isVirtualCopy?"ti virtual":"ti");if(f.isDefault){f.labelControl.className+=" main-page"}this.element.style.display="none";f=null}};if(typeof(b)==="object"){k()}else{alert("Can't create toolbar without control object")}};var TableToolbar=function(e){var m=this;var b=e;var f=null;var g=parseInt(b.container.style.zIndex)||0;var d=b.iconsPath;var c=b.dataSet;this.highlight=null;this.element=null;this.buttons=new Array();var h=function(){var n=document.createElement("div");n.style.position="absolute";n.style.display="none";n.className="tree_toolbar";n.style.width="140px";a(n,{name:"ico_del",hint:getLabel("js-delete"),init:function(o){var q=o.element;var r=getLabel("js-delete");if(f!==null&&(f.permissions&&f.permissions&8||!f.permissions)){var p=d+"ico_del.png";q.setAttribute("title",r);q.style.background="url('"+p+"') no-repeat";q.setAttribute("href","#");q.style.visibility="visible"}else{q.style.visibility="hidden"}},release:function(o){if(f!==null){c.execute("tree_delete_element",{childs:1,element:f.id,handle_item:f})}return false}});a(n,{name:"ico_edit",hint:getLabel("js-edit-item"),init:function(p){var r=p.element;if(f!==null&&f.editLink!==false&&(f.permissions&&f.permissions&2||!f.permissions)){var q=d+"ico_edit.png";var s=getLabel("js-edit-item");var o=f.editLink;r.setAttribute("title",s);r.style.background="url('"+q+"') no-repeat";r.setAttribute("href",o);r.style.visibility="visible"}else{r.style.visibility="hidden"}},release:function(o){return true}});if(!TableToolbar.disableAddButton){a(n,{name:"ico_add",hint:getLabel("js-add-page"),init:function(o){if(f!==null&&f.createLink!==false){o.element.setAttribute("href",f.createLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}})}a(n,{name:"blocking",hint:getLabel("js-disable-page"),icon:d+"ico_block.png",init:function(o){var q=f.allowActivity&&(e.contentType!="objects"||(e.contentType=="objects"&&e.enableObjectsActivity));if(f!==null&&q){var p=f.isActive?d+"ico_unblock.png":d+"ico_block.png";var r=f.isActive?getLabel("js-disable-page"):getLabel("js-enable-page");o.element.style.background="url('"+p+"') no-repeat";o.element.setAttribute("href","#");o.element.setAttribute("title",r);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}},release:function(o){if(f!==null){var p=f.isActive?d+"ico_block.png":d+"ico_unblock.png";var q=f.isActive?getLabel("js-enable-page"):getLabel("js-disable-page");o.element.setAttribute("title",q);o.element.style.background="url('"+p+"') no-repeat";c.execute("tree_set_activity",{element:f.id,active:f.isActive?0:1,handle_item:f,selected_items:f.control.selectedList,"object[]":f.id,viewMode:"full"})}return false}});a(n,{name:"view",hint:getLabel("js-view-page"),init:function(o){if(f!==null&&f.getData().guide=="guide"){o.element.setAttribute("href",window.pre_lang+"/admin/data/guide_items/"+f.id+"/");o.element.style.visibility="visible"}else{if(f!==null&&f.viewLink!==false){o.element.setAttribute("href",f.viewLink);o.element.style.visibility="visible"}else{o.element.style.visibility="hidden"}}}});m.element=document.body.appendChild(n)};var l=function(){for(var n=0;n<m.buttons.length;n++){m.buttons[n].init(m.buttons[n])}};var a=function(p,w){var t=document.createElement("a");var n=w.name||"toolbtn";var o=w.href||"#";var s=w.icon||d+n+".png";var v=w.init||function(){};var u=w.hint||"";var q=p.appendChild(t);var r={name:n,href:o,icon:s,init:v,element:q};m.buttons[m.buttons.length]=r;q.setAttribute("href",o);q.setAttribute("title",u);q.className=w.className||"tree_toolbtn";if(typeof(w.release)==="function"){q.onclick=function(){if(!c.isAvailable()){return false}return w.release(r)}}else{q.onclick=function(){if(!c.isAvailable()){return false}if(f.focus){f.focus()}return true}}q.name=n;q.style.background="url('"+s+"') no-repeat"};var k=function(){var n=document.createElement("div");n.className="tree-highlight";n.style.display="none";n.style.position="absolute";n.style.zIndex=g-1;m.highlight=b.container.appendChild(n);h()};this.show=function(t,q){q=q||false;if(typeof(t)==="undefined"||(f===t&&!q)){return false}if(f){f.labelControl.className="ti"}f=t;f.labelControl.className=f.getSelected()?"ti selected-highlight":"ti hightlight";l();var o=f.control.initContainer.parentNode;var u=jQuery(o).position();var p=0;if(f.element.childNodes[p].className=="ti-toggle"){p=1}var s=jQuery(f.element.childNodes[p]);var r=s.position();var n=r.left+s.width()+u.left+2;this.element.style.top=f.position.top+u.top+"px";this.element.style.left=n+"px";this.element.style.display=""};this.hide=function(){if(f){f.labelControl.className=f.getSelected()?"ti selected":(f.isVirtualCopy?"ti virtual":"ti");this.element.style.display="none";f=null}};if(typeof(b)==="object"){k()}else{alert("Can't create toolbar without control object")}};TableToolbar.disableAddButton=false;var Control=function(n,a,f){var s=this;var l=n;var g=a;var f=typeof(f)=="object"?f:{};var m=typeof(f.draw)=="boolean"?f.draw:false;var x=typeof(f.expandAll)=="boolean"?f.expandAll:false;var b=typeof(f.toolbar)==="function"?f.toolbar:false;var r=null;var k=null;var t=new filter();var v=SettingsStore.getInstance();var e=typeof(f.onItemClick)==="function"?f.onItemClick:function(){return true};var c=typeof(f.onItemSelect)==="function"?f.onItemSelect:function(){return true};var p=typeof(f.onTargetSelect)==="function"?f.onTargetSelect:function(){return true};Control.instances[Control.instances.length]=this;this.container=typeof(f.container)=="object"?f.container:document.body;this.dataSet=l;this.toolbar=null;this.items={};this.id=f.id||Math.random();this.iconsPath=f.iconsPath||"/images/cms/admin/mac/tree/";this.flatMode=f.flatMode||false;this.defaultRootMode=f.defaultRootMode||false;this.objectTypesMode=f.objectTypesMode||false;this.contentType=f.contentType||"pages";this.enableObjectsActivity=f.enableObjectsActivity||false;this.lastClicked=null;this.selectedList={};this.targetsList={};this.dragAllowed=typeof(f.allowDrag)=="boolean"?f.allowDrag:true;this.onGetValueCallback=typeof(f.onGetValueCallback)==="function"?f.onGetValueCallback:function(B,z,A){return B};this.onDrawFieldFilter=typeof(f.onDrawFieldFilter)==="function"?f.onDrawFieldFilter:function(A,z){return false};this.onRemoveColumn=typeof(f.onRemoveColumn)==="function"?f.onRemoveColumn:function(z){return false};this.initContainer=this.container;this.disableCSVButtons=f.disableCSVButtons||false;this.hideCsvImportButton=f.hideCsvImportButton||false;this.disableTooManyChildsNotification=f.disableTooManyChildsNotification||false;this.LabelFirstColumn=(typeof(f.label_first_column)!=="undefined"&&typeof(f.label_first_column)==="string")?f.label_first_column:"";var o=function(){if(m){s.init()}};var d=function(){if(typeof(s.items[r])==="undefined"){s.items[r]=new g(s,null,{id:(r?r:0),iconbase:"/images/cms/admin/mac/tree/ico_domain.png"})}s.items[r].draw();if(b){s.toolbar=new b(s)}if(s.getItemState(r)){s.items[r].expand()}};var w=function(A,z){for(var B=0;B<A.length;B++){if(A[B]===z){return A[B]}}return null};var q=function(C,z,F){if(typeof(z)!="object"||typeof(C)=="undefined"){return false}if(!F){ignoreHierarchy=false}var B=z.id;for(var A=0;A<C.length;A++){var E=(typeof(C[A]["parentId"])!="undefined")?parseInt(C[A]["parentId"]):0;if(E==B||F){var D=parseInt(C[A]["id"]);if(s.items[D]){s.items[D].update(C[A])}else{s.items[D]=z.appendChild(C[A]);if(x||s.getItemState(D)){s.items[D].expand()}}q(C,s.items[D])}}};var h=function(H){var F=H.objects;var B=H.filter;var A=H.paging;var z=B.getParents();var C=false;if(!z.length){z=[(r?r:0)];C=true}for(var D=0;D<z.length;D++){var E=parseInt(z[D]);var G=(typeof(s.items[E])!="undefined")?s.items[E]:s.items[r];q(F,G,C);if(G){G.setLoaded(true);G.setPageing(A)}}Control.recalcItemsPosition();if(Control.HandleItem&&s.toolbar){s.toolbar.show(Control.HandleItem,true)}};var u=function(){s.removeItem(r);if(k){if(s.initContainer){s.container=s.initContainer}var z=s.setRootNode(k,true);z.draw()}Control.recalcItemsPosition()};var y=function(F){var R=F.objects;var T=F.error;var K=F.params;var M=K.paging;var E=K.handle_item;var Z=K.selected_items;var O={};if(Z){O=Z}else{if(E){O[E.id]=E}}var z=F.method;if(!T){switch(z.toLowerCase()){case"restore_element":case"tree_delete_element":for(var P in O){var D=O[P];s.removeItem(P);delete s.selectedList[P];if(D.parent&&D.parent.parent){q(R,D.parent.parent)}}Control.HandleItem=null;if(s.toolbar){s.toolbar.hide()}break;case"export":var V,aa="";if(F.objects[0].file){window.location=F.objects[0].file}break;case"tree_move_element":var S=K.receiver_item;var L=K.before?S.control.getItem(K.before):null;if(R.length&&E&&S){var I=R[0]||[];var H=R[1]||[];var A=R[2]||[];if(E.parent){E.parent.update(A)}S.update(H);E.control.removeItem(E.id);var D=null;if(K["as-sibling"]){if(L){D=S.appendBefore(I,L)}else{D=S.appendChild(I)}}else{if(S.loaded){D=S.appendFirst(I)}}if(D){S.control.items[D.id]=D}}break;case"copy_to_lang":var V,W,Q=false;langId=false;O=E.control.selectedList;for(V in O){W=O[V];Q=W.domainId;langId=W.langId}new_langId=K["lang-id"];new_domainId=K["domain-id"];if(new_langId==langId){location.href=location.href}break;case"move_to_lang":var V,W,Q=false;langId=false;O=E.control.selectedList;for(V in O){W=O[V];langId=W.langId}new_langId=K["lang-id"];location.href=location.href;break;default:for(var P in O){var U=s.items[P].parent;ignoreHierarchy=(!s.items[U]);q(R,U,ignoreHierarchy)}}if(s.toolbar&&E===Control.HandleItem){s.toolbar.show(Control.HandleItem,true)}Control.recalcItemsPosition();Control.PrepareDrag=false;Control.startDragItem=null;Control.PrepareDrag=false;Control.DragMode=false}else{var B=jQuery(T).find("type").text();if(B=="__alias__"){var N=new Object;var X=K;var Y=jQuery(T).find("item"),G=Y.length;Y.each(function(){var ab=jQuery(this).attr("path")+""+jQuery(this).attr("alias");var ad="<form method='post' id='' enctype='multipart/form-data' ";ad+=" action=''>Страница с таким псевдостатическим адресом уже существует (<a href='"+ab+"'>"+ab+"</a>): <br/>";ad+="<br/><label for='new_alias'>"+getLabel("js-content-alias-copy")+"</label> <br/> ";ad+=jQuery(this).attr("path")+"<input type='text' name='new_alias"+jQuery(this).attr("id")+"'  value='"+jQuery(this).attr("alt_name_normal")+"'  id='new_alias"+jQuery(this).attr("id")+"' size='15' />";ad+="</form>";var ac=this;openDialog({text:ad,OKText:getLabel("js-content-alias-new"),cancelText:getLabel("js-content-alias-change"),cancelCallback:function(){X["move["+jQuery(ac).attr("id")+"]"]=1;if(!--G){C()}},OKCallback:function(){X["alias["+jQuery(ac).attr("id")+"]"]=jQuery("#new_alias"+jQuery(ac).attr("id")).val();if(!--G){C()}}})});var C=function(){E.control.dataSet.execute(""+z.toLowerCase()+"",X)}}else{if(B=="__template_not_exists__"){var J=jQuery(T).find("text").text();J=J+"<br/><br/>";openDialog({text:J,stdButtons:0,cancelCallback:function(){},OKCallback:function(){}})}else{alert(T.firstChild.nodeValue)}}}};l.addEventHandler("onAfterLoad",h);l.addEventHandler("onAfterPieceLoad",h);l.addEventHandler("onInitComplete",d);l.addEventHandler("onBeforeRefresh",u);l.addEventHandler("onAfterExecute",y);this.initContainer.style.position="relative";this.init=function(){l.init()};this.load=function(z,A){l.load(z)};this.getItemByPosition=function(B,A){var z=null;for(var D in this.items){if(!this.items[D]){continue}var C=this.items[D].position;if(A>C.top){if(A<=C.bottom){if(B>C.left){if(B<=C.right){z=this.items[D];break}}}}}return z};this.getItem=function(z){if(typeof(this.items[parseInt(z)])=="object"){return this.items[parseInt(z)]}else{return false}};this.setRootNode=function(z,A){k=z;r=z.id;this.items[r]=new g(s,null,z);if(A){this.items[r].loaded=true}return this.items[r]};this.getRootNodeId=function(){return r};this.getRoot=function(){return this.items[r]};this.applyBehaviour=function(z){if(e){return e(z)}return true};this.saveItemState=function(A){var C=parseInt(A);if(this.items[C]){var D=this.items[C];var z=v.get(s.id,"expanded");var B="{"+D.id+"}";if(typeof(z)!="string"){z=""}if(z.indexOf(B)!==-1&&!D.isExpanded){z=z.replace(B,"");v.set(s.id,z,"expanded");return true}else{if(z.indexOf(B)===-1&&D.isExpanded){z+=B;v.set(s.id,z,"expanded");return true}else{return false}}}};this.applyFilter=function(A){this.selectItems([]);if(A!=undefined&&(A instanceof Object)){t=A}if(!t){return}var B=false;for(var z in this.targetsList){this.targetsList[z].applyFilter(t.clone());B=true}if(!B){s.items[r].applyFilter(t.clone(),true)}};this.getCurrentFilter=function(){return t};this.toggleItemSelection=function(z){if(z){if(z.getSelected()){z.setSelected();delete this.selectedList[z.id];c(z,false)}else{z.setSelected(true);this.selectedList[z.id]=z;c(z,true)}}};this.toggleRangeSelection=function(B){if(B){if(!this.lastClicked){return}var A=B.element;var z=this.lastClicked.element;var D=A.parentNode.firstChild;var C=null;var E=[];while(D){if(!C&&D==A){C=z}if(!C&&D==z){C=A}if(C){E.push(this.items[D.rel])}if(D==C){break}D=D.nextSibling}this.selectItems(E)}};this.setSelectionCallback=function(z,B){if(typeof(z)==="function"){if(B){c=z}else{var A=c;c=function(D,C){A(D,C);z(D,C)}}}};this.getSelectionCallback=function(){return c};this.selectItems=function(A){if(!(A instanceof Array)){A=[A]}for(var z in this.selectedList){this.toggleItemSelection(this.selectedList[z])}this.selectedList=new Object;for(var z=0;z<A.length;z++){this.toggleItemSelection(A[z])}};this.setTargetItems=function(A){this.targetsList={};for(var z in A){this.targetsList[z]=A[z]}p(this.targetsList)};this.isTarget=function(z){for(var A in this.targetsList){if(this.targetsList[A]==z){return true}}return false};this.setTargetSelectCallback=function(z){if(typeof(z)==="function"){p=z}};this.getItemState=function(A){var C=parseInt(A);if(this.items[C]){var D=this.items[C];if(!D.hasChilds){return false}var z=v.get(s.id,"expanded");var B="{"+D.id+"}";if(typeof(z)!="string"){z=""}return(z.indexOf(B)!==-1)}};this.removeItem=function(C,z){var D=parseInt(C);if(this.items[D]){var E=this.items[D];var B=E.parent;for(var A=0;A<E.childs.length;A++){this.removeItem(E.childs[A])}E.childs=[];if(!z){this.items[D]=false;E.clear()}}};this.expandAll=function(){x=true;for(id in this.items){this.items[id].expand()}};this.collapseAll=function(){x=false;for(id in this.items){this.items[id].collapse()}};this.recalcItemsPosition=function(){for(id in this.items){if(this.items[id]){this.items[id].recalcPosition()}}};o()};Control.DragMode=false;Control.PrepareDrag=false;Control.startDragX=0;Control.startDragY=0;Control.startDragItem=null;Control.DragSensitivity=7;Control.HandleItem=null;Control.DraggableItem=null;Control.instances=new Array();Control.enabled=true;Control.getInstanceById=function(a){for(var b=0;b<Control.instances.length;b++){if(Control.instances[b].id===a){return Control.instances[b]}}return null};Control.recalcItemsPosition=function(){for(var a=0;a<Control.instances.length;a++){Control.instances[a].recalcItemsPosition()}};Control.detectItemByMousePointer=function(b,h){var g=Control.HandleItem;if(g){var f=jQuery(g.control.initContainer).position();var e=g.position;if(h>e.top+f.top&&h<=e.bottom+f.top&&b>e.left+f.left&&b<=e.right+f.left){return g}}var a=null;for(var d=0;d<Control.instances.length;d++){var c=Control.instances[d];var f=jQuery(c.initContainer).position();a=c.getItemByPosition(b-f.left,h-f.top);if(a){break}}return a};Control.recalcSelectedItems=function(g){if(!Control.instances.length){return}if(Control.DragMode){return}if(!Control.enabled){return}var f=g.target;var c=f.tagName.toLowerCase();if(c=="textarea"||c=="input"||c=="select"||c=="option"){return}var b=g.pageX;var h=g.pageY;var a=Control.detectItemByMousePointer(b,h);Control.HandleItem=a;for(var e=0;e<Control.instances.length;e++){if(Control.instances[e].toolbar){Control.instances[e].toolbar.hide()}}if(a){var d=true;if(a.control.toolbar&&d){a.control.toolbar.show(a)}}};jQuery(document).bind("mousemove",Control.recalcSelectedItems);jQuery(document).bind("mousedown",function(b){Control.recalcSelectedItems(b);if(!Control.HandleItem){return}if(b.button!=0){return}if(!Control.enabled){return}var a=b.target;if(a.className.toLowerCase()!="ti-toggle"){Control.PrepareDrag=true;Control.startDragItem=Control.HandleItem;Control.startDragX=b.pageX;Control.startDragY=b.pageY}});jQuery(document).bind("mouseup",function(d){if(!Control.enabled){return}if(!Control.DragMode&&Control.HandleItem){if(d.altKey){}else{if(d.ctrlKey||d.metaKey){Control.HandleItem.control.toggleItemSelection(Control.HandleItem)}else{if(d.shiftKey){Control.HandleItem.control.toggleRangeSelection(Control.HandleItem)}else{var c=d.target;if(c.className.toLowerCase()!="ti-toggle"){var a=true;if(d.button==2){for(var b in Control.HandleItem.control.selectedList){if(Control.HandleItem.control.selectedList[b].id==Control.HandleItem.id){a=false}}}if(a){Control.HandleItem.control.selectItems(Control.HandleItem)}}}}}Control.HandleItem.control.lastClicked=Control.HandleItem}Control.PrepareDrag=false;Control.startDragItem=null;Control.DragMode=false});jQuery(window).bind("resize",function(a){Control.recalcItemsPosition()});function createAddButton(d,f,c,b){d.ControlInstance=f;var a=function(){var h=0;var p=null;var g=false;var l;for(l in f.selectedList){h++;p=l}for(l=0;l<b.length;l++){if((p==null&&b[l]===true)||(p!=null&&(b[l]===f.selectedList[p].baseMethod||b[l]==="*"))){g=true;break}}var o=c.replace(/\{id\}/,(p||"0"));o=o.replace(/\{\$param0\}/,(p||"0"));o=o.replace(/\{\$pre_lang\}/,window.pre_lang);var n=document.getElementById("domainSelect"+f.id);if(n){var m=n.options[n.selectedIndex].text;if(o.indexOf("?")!=-1){o=o+"&domain="+m}else{o=o+"?domain="+m}}d.addLink=o;for(var l=0;l<d.linkCache.length;l++){d.linkCache[l].href=d.addLink;d.linkCache[l]["param0"]=(p||"0")}if(d.tagName.toLowerCase()=="a"){d.href=d.addLink;d.param0=(p||"0")}var k=false;if(h>1||!g){if(d.style.display!="none"){d.style.display="none";k=true}}else{if(d.style.display=="none"){d.style.display="";k=true}}if(k){Control.recalcItemsPosition()}};f.setSelectionCallback(function(h,g){setTimeout(a,100)});var e=c.replace(/\{id\}/,"0");e=e.replace(/\{\$param0\}/,"0");e=e.replace(/\{\$pre_lang\}/,window.pre_lang);d.addLink=e;d.linkCache=d.getElementsByTagName("a");a()}function filterController(k,w,g,I,Y){var r=this;var aa=null;var D=null;var X=null;var F=null;var W=null;var ae=null;var P=null;var Q=null;var ab=null;var h=null;var y=null;var N=w;var V=null;var l=0;var v=5000;var u=new Object();var S=new Object();var G=k.id+"_fc";var T=null;var ac=new Object();var E=null;var B=true;var n=I;var Z=(Y&&Y.nativeAdvancedMode);var e=function(ai,ah,af){if(ai!="name"){if(af&&af[1]==="static"){return}var aj=G+"_id_"+ai.fieldName;if(!ai.dataType){ai.dataType="string"}var ag=m(ai.dataType,aj,ai.fieldName,ai.guideId,false);if(ag){u[ai.fieldName]=ai;S[ai.fieldName]=ag;if(af&&af[0]){ag.style.width=af[0]}ah.appendChild(ag)}else{}}};var c=function(af){if(af!="name"){delete u[af.fieldName];delete S[af.fieldName]}};this.control=null;this.getId=function(){return G};this.changeMode=function(){if(B){B=false;X.style.display="block";D.style.display="none";ab.childNodes[0].nodeValue=getLabel("js-filter-normal-mode")}else{B=true;X.style.display="none";D.style.display="";ab.childNodes[0].nodeValue=getLabel("js-filter-extended-mode")}Control.recalcItemsPosition()};var a=function(ag){var af=(window.event)?event.keyCode:ag.keyCode;if(af==13){r.applyFilter()}};var ad=function(ag){var af=(window.event)?event.keyCode:ag.keyCode;if(af==13){if(Z){r.applyFilter()}else{r.applyFilterAdvanced()}}};var s=function(af){if(Z){}else{r.applyFilterAdvanced()}};this.applyFilterAdvanced=function(){if(l>0){return}var ah=new filter();for(var af in S){if(S[af].tagName.toLowerCase()=="select"){var am=S[af].options[S[af].selectedIndex].value;if(am!=-2){ah.setPropertyEqual(af,am)}}else{switch(S[af].type){case"button":break;case"checkbox":ah.setPropertyEqual(af,S[af].checked?1:0);break;case"text":var ak=u[af].dataType;switch(ak){case"tags":var an=S[af].value.split(",");for(var ai=0;ai<an.length;ai++){an[ai]=an[ai].replace(/^\s+|\s+$/,"")}if(an.length){ah.setPropertyLike(af,an)}break;case"float":case"price":case"counter":case"int":var am=S[af].value.replace(/^\s+|\s+$/,"");if(!am.length){break}if(am[0]=="<"){ah.setPropertyLess(af,am.replace(/[^\d.]*/,""))}else{if(am[0]==">"){ah.setPropertyGreater(af,am.replace(/[^\d.]*/,""))}else{am=am.split("-");if(am.length>1){ah.setPropertyBetween(af,am[0].replace(/[^\d.]*/,""),am[1].replace(/[^\d.]*/,""))}else{ah.setPropertyEqual(af,am[0].replace(/[^\d.]*/,""))}}}break;case"date":var ag=[];var am=S[af].value;if(S[af].isEmpty!=undefined&&S[af].isEmpty==true){break}if(am.length>0){var aj=-1;var al=am.indexOf("-");if((aj=am.indexOf("<"))!=-1){ah.setPropertyLess(af,(al!=-1)?am.substring(aj+1,al-1):am.substring(aj+1))}else{if((aj=am.indexOf(">"))!=-1){ah.setPropertyGreater(af,(al!=-1)?am.substring(aj+1,al-1):am.substring(aj+1))}else{if(al!=-1){ag=am.split(/\s-\s/)}if(ag.length==2){ah.setPropertyBetween(af,ag[0],ag[1])}else{ah.setPropertyEqual(af,am)}}}}break;case"relation":if(S[af].value.length){ah.setPropertyEqual(af,S[af].value)}break;default:if(S[af].value.length){ah.setPropertyLike(af,S[af].value)}}break;default:if(S[af].value.length){ah.setPropertyEqual(af,S[af].value)}}}}ah.setConditionModeOr(false);V.applyFilter(ah)};this.applyFilter=function(){var ag=new filter();if(B){var an=aa.value.replace(/^\s*|\s*$/,"");if(an.length==0){if(!(V.flatMode||V.objectTypesMode||V.defaultRootMode)){ag.setParentElements(0)}}else{if(/^".*"$|^'.*'$/.test(an)){an=an.substr(1,an.length-2)}else{an=an.split(" ")}ag.setAllTextSearch(an)}ag.setConditionModeOr(true)}else{var aj=X.getElementsByTagName("input");for(var ai=0;ai<aj.length;ai++){switch(aj[ai].type){case"button":break;case"checkbox":ag.setPropertyEqual(aj[ai].name,aj[ai].checked?1:0);break;case"text":var al=u["row_"+aj[ai].id].field.getElementsByTagName("type")[0].getAttribute("data-type");switch(al){case"tags":var ao=aj[ai].value.split(",");for(var ah=0;ah<ao.length;ah++){ao[ah]=ao[ah].replace(/^\s+|\s+$/,"")}ag.setPropertyEqual(aj[ai].name,ao);break;case"float":case"price":case"int":var an=aj[ai].value.replace(/^\s+|\s+$/,"");if(an[0]=="<"){ag.setPropertyLess(aj[ai].name,an.replace(/[^\d.]*/,""))}else{if(an[0]==">"){ag.setPropertyGreater(aj[ai].name,an.replace(/[^\d.]*/,""))}else{an=an.split("-");if(an.length>1){ag.setPropertyBetween(aj[ai].name,an[0].replace(/[^\d.]*/,""),an[1].replace(/[^\d.]*/,""))}else{ag.setPropertyEqual(aj[ai].name,an[0].replace(/[^\d.]*/,""))}}}break;case"date":var af=[];var an=aj[ai].value;if(aj[ai].isEmpty!=undefined&&aj[ai].isEmpty==true){break}if(an.length>0){var ak=-1;var am=an.indexOf("-");if((ak=an.indexOf("<"))!=-1){ag.setPropertyLess(aj[ai].name,(am!=-1)?an.substring(ak+1,am-1):an.substring(ak+1))}else{if((ak=an.indexOf(">"))!=-1){ag.setPropertyGreater(aj[ai].name,(am!=-1)?an.substring(ak+1,am-1):an.substring(ak+1))}else{if(am!=-1){af=an.split(/\s-\s/)}if(af.length==2){ag.setPropertyBetween(aj[ai].name,af[0],af[1])}else{ag.setPropertyEqual(aj[ai].name,an)}}}}break;case"relation":ag.setPropertyLike(aj[ai].name,aj[ai].value);break;default:ag.setPropertyLike(aj[ai].name,aj[ai].value)}break;default:ag.setPropertyEqual(aj[ai].name,aj[ai].value)}}aj=X.getElementsByTagName("select");for(var ai=0;ai<aj.length;ai++){if(aj[ai].id=="select_"+G){continue}var ao=new Array();for(var ah=0;ah<aj[ai].options.length;ah++){if(aj[ai].options[ah].selected){ao.push(aj[ai].options[ah].value)}}ag.setPropertyEqual(aj[ai].name,ao)}if(Z){ag.setConditionModeOr(!W.checked)}else{ag.setConditionModeOr(true)}}V.applyFilter(ag)};var d=function(af){return function(){var ai=document.getElementById(af);if(ai){ai.parentNode.removeChild(ai);u[af].used=false;while(Q.childNodes.length){Q.removeChild(Q.firstChild)}var ak=new Array();var aj=0;for(var ag in u){if(u[ag].used){ak.push(u[ag].field.getAttribute("id"));aj++}else{var ah=document.createElement("option");ah.value=ag;ah.appendChild(document.createTextNode(u[ag].field.getAttribute("title")));Q.appendChild(ah);var ak=new Array()}}SettingsStore.getInstance().set(G,ak.join(","),E?""+E:"default");if(aj>1){F.style.display=""}else{F.style.display="none"}Q.style.display="none";Q.style.display=""}Control.recalcItemsPosition()}};var z=function(){if(!Q.options.length){return}var ai=Q.options[Q.selectedIndex].value;var ah=J(u[ai].field);if(ah){u[ai].used=true;X.getElementsByTagName("table")[0].tBodies[1].appendChild(ah);Q.removeChild(Q.options[Q.selectedIndex]);var ag=new Array();for(var af in u){if(u[af].used){ag.push(u[af].field.getAttribute("id"))}}SettingsStore.getInstance().set(G,ag.join(","),E?""+E:"default");if(ag.length>1){F.style.display=""}else{F.style.display="none"}Control.recalcItemsPosition();Q.style.display="none";Q.style.display=""}};var o=function(af,ah){var ag=af;var aj={x:ag.offsetLeft||0,y:ag.offsetTop||0};while(ag=ag.offsetParent){aj.x+=ag.offsetLeft;aj.y+=ag.offsetTop}aj.x+=af.offsetWidth;aj.y+=af.offsetHeight;var ak="tip_"+G+Math.random();var ai=document.createElement("div");ai.id=ak;ai.className="fcTip";ai.style.zIndex=50;ai.style.position="absolute";ai.style.left=aj.x+"px";ai.style.top=aj.y+"px";ai.appendChild(document.createTextNode(ah));document.body.appendChild(ai);setTimeout(function(){ai.parentNode.removeChild(ai)},v)};var O=function(af,ag){var ah=null;var ai="";switch(ag){case"int":ah=new RegExp("^[<>]?[ ]?\\d*( ?- ?\\d*)?$");ai=getLabel("js-filter-enter-natural-number");break;case"float":ah=new RegExp("^[<>]?[ ]?\\d*[\\.]*\\d*( ?- ?\\d*[\\.]*\\d*)?$");ai=getLabel("js-filter-enter-float-number");break;case"date":ah=/(^[<>]{1}.*)|(^(((\d\d?[.]\d\d?([.]\d\d(\d\d)?)?)?((\s+|^\s*)\d\d?:\d\d)?)|позавчера|вчера|сегодня|завтра|послезавтра)?(\s*-\s*(((\d\d?[.]\d\d?([.]\d\d(\d\d)?)?)?(\s+\d\d?:\d\d)?)|позавчера|вчера|сегодня|завтра|послезавтра))?)$/i;break}var aj=function(){if(af){var ak=af.className.indexOf("_error");if(!ah.test(af.value)){if(ak<0){af.className+="_error";l++}}else{if(ak>=0){af.className=af.className.substr(0,ak);l--}}}};return aj};var t=function(al,ak){if(ac[ak]==undefined){var ao=function(aq){if(!aq.responseXML.getElementsByTagName("empty").length){var at=aq.responseXML.getElementsByTagName("object");var ap=[];if(!Z){ap.push({id:-2,value:""})}for(var ar=0;ar<at.length;ar++){ap.push({id:at[ar].getAttribute("id"),value:at[ar].getAttribute("name")})}ac[ak]=ap}else{ac[ak]="empty"}t(al,ak)};var af="/admin/data/guide_items_all/"+ak+".xml?allow-empty";R(af,ao);return}if(ac[ak]!=="empty"){for(var ai in ac[ak]){var aj=document.createElement("option");aj.value=ac[ak][ai].id;aj.appendChild(document.createTextNode(ac[ak][ai].value));al.appendChild(aj)}}else{var ag=al.name;var ah=al.id;var am=m("string",ah,ag,ak,false);var an=al.parentNode;an.removeChild(al);an.appendChild(am);if(S[ag]){S[ag]=am}}};var q=function(ag,ah,ai){if(typeof(ag[ah])=="function"){var af=ag[ah];ag[ah]=function(aj){af(aj);ai(aj)}}else{ag[ah]=ai}};var f=function(ag){var af=document.createElement("input");if(ag instanceof Object){for(i in ag){af.setAttribute(i,ag[i])}}return af};var m=function(an,at,ai,am,ao){var ap=null;switch(an){case"string":case"wysiwyg":case"text":case"password":case"tags":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";break;case"date":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";ap.onkeyup=O(ap,"date");var al=getLabel("js-filter-date-format");ap.value=al;ap.isEmpty=true;ap.onfocus=function(){if(this.isEmpty){this.value="";this.isEmpty=false}};ap.onblur=function(){if(this.value.length==0){this.value=al;this.isEmpty=true}};break;case"boolean":var af="0";case"file":case"img_file":case"swf_file":var aj=af||"-1";if(!Z){ap=document.createElement("select");ap.className="fcSelectInput";ap.name=ai;ap.id=at;ap.multiple=false;var ah=document.createElement("option");var ar=document.createElement("option");var ak=document.createElement("option");ah.value="1";ar.value=aj;ak.value="-2";var aq=(an=="boolean")?getLabel("js-value-yes"):getLabel("js-value-file-yes");var ag=getLabel("js-value-no");ah.appendChild(document.createTextNode(aq));ar.appendChild(document.createTextNode(ag));ak.appendChild(document.createTextNode(" "));ap.appendChild(ak);ap.appendChild(ah);ap.appendChild(ar);break}ap=f({type:"checkbox","class":"fcBooleanInput",name:ai,id:at});ap.className="fcBooleanInput";break;case"int":case"counter":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";ap.onkeyup=O(ap,"int");break;case"float":case"price":ap=f({type:"text","class":"fcStringInput",name:ai,id:at});ap.className="fcStringInput";ap.onkeyup=O(ap,"float");break;case"relation":ap=document.createElement("select");ap.className="fcSelectInput";ap.name=ai;ap.id=at;ap.multiple=(ao!=undefined&&ao==false)?false:true;t(ap,am);break}if(ap){q(ap,"onkeyup",ad);if(ap.tagName.toLowerCase()=="select"){ap.onchange=s}}return ap};var J=function(al){var ak=al.getElementsByTagName("type")[0];var an=null;var af=al.getAttribute("name");var ah=G+"_id_"+af;var ai="row_"+ah;an=m(ak.getAttribute("data-type"),ah,af,al.getAttribute("guide-id"));if(an==null){return null}var aq=document.createElement("tr");var ao=document.createElement("td");var aj=document.createElement("td");var ag=document.createElement("td");var am=document.createElement("label");am.setAttribute("for",ah);am.appendChild(document.createTextNode(al.getAttribute("title")));ao.className="fcTitleCell";ao.appendChild(am);aj.className="fcValueCell";aj.appendChild(an);var ap=document.createElement("img");ap.className="fcDeleteImage";ap.src=T+"field_delete.png";ap.alt=getLabel("js-filter-remove-field");ap.title=getLabel("js-filter-remove-field");ap.onclick=d(ai);ag.className="fcDeleteCell";ag.appendChild(ap);aq.id=ai;aq.appendChild(ao);aq.appendChild(aj);aq.appendChild(ag);return aq};var b=function(){if(!Z){return}while(P.tBodies[1].childNodes.length){P.tBodies[1].removeChild(P.tBodies[1].firstChild)}while(Q.childNodes.length){Q.removeChild(Q.firstChild)}var ai=0;for(var af in u){if(u[af].used){var ah=J(u[af].field);if(ah){P.tBodies[1].appendChild(ah);ai++}}else{var ag=document.createElement("option");ag.value=af;ag.appendChild(document.createTextNode(u[af].field.getAttribute("title")));Q.appendChild(ag)}}Q.disabled=false;if(F){if(ai>1){F.style.display=""}else{F.style.display="none"}}Control.recalcItemsPosition()};var p=function(am){if(Z){var av=document.createElement("div");ab=document.createElement("a");ab.href="javascript:filterController.getInstanceById('"+G+"').changeMode();";av.className="fcModeContainer";av.appendChild(ab);ab.appendChild(document.createTextNode(getLabel("js-filter-extended-mode")))}D=document.createElement("div");D.className="fcContainer";aa=f({type:"text","class":"fcQuicksearchInput",name:"quicksearch",id:G+"_id_quicksearch"});var az=f({type:"button",value:getLabel("js-filter-do")});aa.className="fcQuicksearchInput";az.className="fcApplyButton";az.onclick=r.applyFilter;aa.onkeyup=a;D.appendChild(aa);D.appendChild(az);if(Z){X=document.createElement("div");P=document.createElement("table");P.className="fcTable";P.appendChild(document.createElement("tbody"));P.appendChild(document.createElement("tbody"));P.appendChild(document.createElement("tbody"));var ah=document.createElement("tr");var aw=document.createElement("td");var aB=document.createElement("td");var au=document.createElement("td");var ar=document.createElement("img");Q=document.createElement("select");Q.className="fcAddSelect";Q.id="select_"+G;Q.style.width="100%";ar.className="fcAddImage";ar.src=T+"field_add.png";ar.alt=getLabel("js-filter-add-field");ar.title=getLabel("js-filter-add-field");ar.onclick=z;aB.className="fcFreeFieldsCell";au.className="fcAddCell";aw.appendChild(document.createTextNode(getLabel("js-filter-fields-list")));aB.colSpan=1;aB.appendChild(Q);au.appendChild(ar);ah.appendChild(aw);ah.appendChild(aB);ah.appendChild(au);P.tBodies[0].appendChild(ah);var al=document.createElement("tr");var aC=document.createElement("td");aC.colSpan=3;aC.innerHTML="&nbsp;";al.appendChild(aC);P.tBodies[0].appendChild(al);ah.className="fcAddRow";var ag=document.createElement("tr");var an=document.createElement("td");an.colSpan=3;an.className="fcLogicCell";F=document.createElement("div");W=f({type:"radio","class":"fcLogicInput",value:"and",name:G+"_logic",id:G+"_logic_and",checked:true,selected:true});ae=f({type:"radio","class":"fcLogicInput",value:"or",name:G+"_logic",id:G+"_logic_or"});var aq=document.createElement("span");var ay=document.createElement("label");var ap=document.createElement("label");var ao=document.createElement("span");var aj=document.createElement("span");aq.className="fcLogicTitle";aq.appendChild(document.createTextNode(getLabel("js-filter-search-matches")));F.appendChild(aq);W.style.border="0";ae.style.border="0";ay.className="fcLogicLabel";ay.htmlFor=G+"_logic_and";ao.className="fcLogicLine";ay.appendChild(document.createTextNode(getLabel("js-filter-with-all-fields")));ao.appendChild(ay);ao.appendChild(W);F.appendChild(ao);aj.className="fcLogicLine";ap.className="fcLogicLabel";ap.htmlFor=G+"_logic_or";ap.appendChild(document.createTextNode(getLabel("js-filter-one-at-least")));aj.appendChild(ap);aj.appendChild(ae);F.appendChild(aj);an.appendChild(F);ag.appendChild(an);P.tBodies[2].appendChild(ag);var ak=document.createElement("tr");var af=document.createElement("td");applyButton=f({type:"button",value:getLabel("js-filter-do")});applyButton.onclick=r.applyFilter;applyButton.className="fcApplyButton";af.colSpan=3;af.className="fcApplyCell";af.appendChild(applyButton);ak.appendChild(af);P.tBodies[2].appendChild(ak);X.className="fcContainer";X.style.display="none";X.appendChild(P)}var aA=document.createElement("div");var at=document.createElement("span");y=document.createElement("span");at.appendChild(document.createTextNode(getLabel("js-filter-current-rubrics")));aA.appendChild(at);aA.appendChild(y);aA.className="fcTargetContainer";H();var ai=document.createElement("div");ai.style.clear="both";ai.innerHTML="&nbsp;";if(n){n.appendChild(D);if(Z){n.appendChild(av);n.appendChild(X)}n.appendChild(aA)}else{n=document.createElement("div");n.className="filter-container";n.appendChild(D);if(Z){n.appendChild(av);n.appendChild(X)}n.appendChild(aA);V.container.parentNode.insertBefore(n,V.container)}var ax=document.createElement("div");ax.className="clear";V.container.parentNode.insertBefore(ax,V.container);if(Z){W.checked=true;b()}};var L=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(af){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(af){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(af){}}}return null};var R=function(ah,af){var ag=L();ag.onreadystatechange=function(){if(ag.readyState!=4){return}if(ag.status==200){af(ag)}else{K("Request failed")}};ag.open("GET",ah,true);ag.send(null)};this.init=function(){if(Z){var af=function(ai){var ah=ai.responseXML.getElementsByTagName("field");x(ah);p(ai.responseXML)};var ag=V.dataSet.getCommonTypeId();if(ag>0){N=ag}if(N){sUrl="/utype/"+N+"/"}else{sUrl="/utype/dominant/"+N+"/"}R(sUrl,af)}else{p(null)}};var x=function(ai){var ao=ai;var au=["symlink"];var aq=null;var ak=false;var ap=SettingsStore.getInstance().get(G,(E)?""+E:"default");var ar=(ap===false)?new Array():ap.split(",");var at=false;var ah=V.dataSet.getFieldsStoplist();for(var an=0;an<ao.length;an++){var af=ao[an].getAttribute("name");ak=false;aq=ao[an].getElementsByTagName("type")[0].getAttribute("data-type");for(var am=0;am<ah.length;am++){if(af==ah[am]){ak=true;break}}for(var am=0;am<au.length&&!ak;am++){if(aq==au[am]){ak=true;break}}if(!ak){var ag="row_"+G+"_id_"+ao[an].getAttribute("name");var aj=ao[an].getAttribute("id");at=false;for(var al=0;al<ar.length;al++){if(aj==ar[al]){at=true;break}}u[ag]={used:at,field:ao[an]}}}};var K=function(af){};var C=false;var A=function(){var af=this.id.substr((G+"_link_").length);delete V.targetsList[af];U({});return false};var M=function(ag,ah){var af=document.createElement("a");af.className="fcTarget";af.id=G+"_link_"+ag;af.href="#";af.title=getLabel("js-filter-delete-category");af.onclick=A;af.appendChild(document.createTextNode(ah));if(y.childNodes.length){y.appendChild(document.createTextNode(", "))}y.appendChild(af)};var H=function(){y.parentNode.style.display="none"};var U=function(ag){var ai=false;var aj=null;var af=0;while(y.firstChild){y.removeChild(y.firstChild)}for(var ah in V.targetsList){af++;aj=V.targetsList[ah].id;M(V.targetsList[ah].id,V.targetsList[ah].name)}if(!af){H()}else{y.parentNode.style.display=""}if(Z){if(af==1){sUrl="/utype/dominant/"+aj+"/";ai=true;E=aj}else{sUrl="/utype/"+N+"/";ai=false;E=null}if(C!=ai){u=new Object();Q.disabled=true;R(sUrl,function(al){if(al.responseXML){var ak=al.responseXML.getElementsByTagName("field");if(ak.length){x(ak)}b()}});C=ai}}};if(!(k==undefined||w==undefined)){filterController.instances[filterController.instances.length]=this;V=k;this.control=V;N=!w?0:w;T=V.iconsPath;if(!Z){V.onDrawFieldFilter=e;V.onRemoveColumn=c}V.setTargetSelectCallback(U);if(g==undefined||g==false){this.init()}else{V.dataSet.addEventHandler("onInitComplete",this.init)}}}filterController.instances=new Array();filterController.getInstanceById=function(a){for(var b=0;b<filterController.instances.length;b++){if(filterController.instances[b].getId()===a){return filterController.instances[b]}}return null};function TemplatesDataSet(){var c=null,a=null,f=null;var b=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(k){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(k){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(k){}}}return null};var e=function(){var k="/admin/content/domainTemplates.xml";var m=b();var l=function(){if(m.readyState!=4){return}if(m.status==200){d(m)}else{return false}};m.onreadystatechange=l;m.open("GET",k,true);m.send(null)};var d=function(k){var l=k.responseXML;c=h(l.getElementsByTagName("template"));a=h(l.getElementsByTagName("domain"));f=h(l.getElementsByTagName("lang"))};var g=function(n){var l=[];l.nodeValue=(n.textContent||n.text);for(var m=0;m<n.attributes.length;m++){var k=n.attributes.item(m);l[k.nodeName]=k.nodeValue}return l};var h=function(o){var k=new Array();for(var l=0;l<o.length;l++){var m=o[l];var n=g(m);k.push(n)}return k};this.getLangsList=function(){return f};this.getDomainsList=function(){return a};this.getTemplatesList=function(n,o){if(!n&&!o){return c}var k=new Array();for(var l=0;l<c.length;l++){var m=c[l];if(m["domain-id"]==n&&m["lang-id"]==o){k.push(m)}}return k};e()}TemplatesDataSet.instance=null;TemplatesDataSet.getInstance=function(){if(!TemplatesDataSet.instance){TemplatesDataSet.instance=new TemplatesDataSet}return TemplatesDataSet.instance};function dataSet(s,A,b){var f=s;var h=(b!=undefined)?b:"";var g="";var r=null;var v=new Array();var B=false;var C=false;var D=new Array();var I=new Array();var J=0;var l=new Array();var x="";var m=new Array();var d=0;var G=new Array();var t=new Array();var F=new Array();var c=new Array();var k=new Array();var H=new Array();var K=new Array();var a=new Array();var w=new Array();this.init=function(){if(C){return true}C=true;var M=function(O){if(O.responseXML){I=O.responseXML.getElementsByTagName("group")}B=true;if(!p("onInitComplete")){return false}};var L=function(Y){var aa=Y.responseXML.getElementsByTagName("method");for(var W=0;W<aa.length;W++){var R=aa[W];if(R.getAttribute("forload")=="true"){g=R.childNodes[0].nodeValue;continue}var Q=new Object();for(var V=0;V<R.attributes.length;V++){var O=R.attributes[V];if(O.nodeName=="aliases"){continue}Q[O.nodeName]=O.nodeValue}Q.name=R.childNodes[0].nodeValue;var X=R.getAttribute("aliases");if(X){Q.aliases=X.split(",");for(var U=0;U<Q.aliases.length;U++){Q.aliases[U]=Q.aliases[U].replace(/^\s+|\s+$/,"")}}else{Q.aliases=[]}D.push(Q)}var S=Y.responseXML.getElementsByTagName("exclude");if(S.length){for(var W=0;W<S.length;W++){if(S[W].childNodes.length){l.push(S[W].childNodes[0].nodeValue)}}}var ab=Y.responseXML.getElementsByTagName("default");if(ab.length&&ab[0].childNodes.length){x=ab[0].childNodes[0].nodeValue}var T=Y.responseXML.getElementsByTagName("type");if(T.length){for(var W=0;W<T.length;W++){if(!T[W].getAttribute("common")){continue}var Z=T[W].getAttribute("common").toLowerCase();if(Z=="1"||Z=="true"){J=T[W].getAttribute("id");var P="/utype/"+J+"/";q(P,M);break}else{if(Z=="custom"){J=T[W].getAttribute("id");var P=J;q(P,M)}}}}else{B=true;if(!p("onInitComplete")){return false}}};var N="/admin/"+f+"/dataset_config.xml"+(h.length?("?param="+h):"");q(N,L);return C};this.load=function(N){if(!B){return false}if(!p("onBeforeLoad")){return false}var L=function(P){var O=new Object();var Q=e(P.responseXML,false,O);var R={objects:Q,filter:N,paging:O};if((typeof(Q)=="string")||(Q===null)){R.error=Q}B=true;if(!p("onAfterLoad",R)){return false}};var M="/admin/"+f+"/"+g+".xml"+u(N,true);q(M,L)};this.refresh=function(R){if(!B){return false}if(!p("onBeforeRefresh")){return false}if(v.length){var Q="/admin/"+f+"/"+g+".xml";var M=0;var L=function(U,X){var T=new Object();var V=e(U.responseXML,false,T);var W={objects:V,filter:X,paging:T};if((typeof(V)=="string")||(V===null)){W.error=V}p("onAfterPieceLoad",W);M++;if(M>=v.length){B=true;if(!p("onAfterRefresh",{objects:m})){return false}}else{q(Q+u(v[M]),L,v[M])}};B=false;q(Q+u(v[M]),L,v[M])}else{var O=function(U,X){var T=new Object();var V=e(U.responseXML,false,T);var W={objects:V,filter:new filter(),paging:T};if((typeof(V)=="string")||(V===null)){W.error=V}B=true;p("onAfterPieceLoad",W);p("onAfterRefresh",{objects:m})};var S=new Array();var N="";if(R==undefined||R==false){N="id"}else{N="rel"}for(var P=0;P<m.length;P++){S.push(m[P][N])}B=false;var Q="/admin/"+f+"/"+g+".xml?"+N+"="+S.join(",");m=new Array();q(Q,O)}};this.isMethodSupported=function(O,Q){var M=O.toUpperCase();var L=(Q!=undefined&&Q==true)?true:false;for(var P in D){if(typeof(D[P])==="function"){continue}if(D[P].name.toUpperCase()==M){return L?D[P].name:true}for(var N=0;N<D[P].aliases.length;N++){if(D[P].aliases[N].toUpperCase()==M){return L?D[P].name:true}}}return false};this.getMethodsList=function(){return D};this.getCommonFields=function(){return I};this.getDefaultFields=function(){return x};this.getFieldsStoplist=function(){return l};this.getCommonTypeId=function(){return J};this.execute=function(T,N){if(!B){return false}var U=this.isMethodSupported(T,true);if(!U){return false}var R={method:T,params:N,objects:new Array()};if(!p("onBeforeExecute",R)){return false}var S=function(W){Control.enabled=true;var V=new Object();var X=e(W.responseXML,true,V);E(X);R.objects=X;R.paging=V;if((typeof(X)=="string")||(X===null)){R.error=X}if(X.error){R.error=X.error}R.HandleItem=jQuery.extend(true,{},Control.HandleItem);B=true;if(!p("onAfterExecute",R)){return false}};var Q=y(U);var L=window.pre_lang+"/admin/"+Q+"/"+U+".xml";var O=new Array();for(var M in N){if(N[M] instanceof Array){for(var P=0;P<N[M].length;P++){O.push(M+"[]="+N[M][P])}}else{O.push(M+"="+N[M])}}B=false;L=L+"?"+O.join("&");q(L,S)};this.getLoadedTree=function(){return m};this.isAvailable=function(){return B};this.clearFiltersCache=function(){v=new Array()};this.setDefaultFilter=function(L){r=L};this.getDefaultFilter=function(){return r};this.addEventHandler=function(N,L){var M=o(N);if(M===null){return false}M[M.length]={active:true,handler:L};return M.length-1};this.removeEventHandler=function(N,L){var M=o(N);if(M===null){return false}M[L].active=false};var y=function(M){var L=M.toUpperCase();for(var N=0;N<D.length;N++){if(D[N].name.toUpperCase()==L&&D[N].module){return D[N].module}}return f};var p=function(O,P){if(!C){return false}var M=true;var L=o(O);if(L===null){return false}for(var N in L){if(L[N].active){M=M&&(L[N].handler(P)!==false)}}return M};var o=function(M){var L=null;switch(M.toUpperCase()){case"ONINITCOMPLETE":return G;case"ONBEFORELOAD":return t;case"ONAFTERLOAD":return F;case"ONBEFOREEXECUTE":return c;case"ONAFTEREXECUTE":return k;case"ONBEFOREREFRESH":return H;case"ONAFTERREFRESH":return K;case"ONAFTERPIECELOAD":return a;case"ONREQUESTFAILED":return w;default:return null}};var n=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(L){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(L){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(L){}}}return null};var q=function(N,L,O){var M=n();M.onreadystatechange=function(){if(M.readyState!=4){return}d++;if(M.status==200){L(M,O)}else{p("onRequestFailed")}};M.open("GET",N,true);M.send(null)};var u=function(O,L){var P="";if(O instanceof Object){if(!r.Full){O.setViewMode(false)}P=O.getQueryString(r);if(L!=undefined&&L===true){v.push(O)}}else{if(O instanceof Object){var N=new Array();if(O.id!=undefined){var M;if(O.id instanceof Array){M=O.id}else{M=new Array();M.push(O.id)}N.push("id="+M.join(","))}if(O.rel!=undefined){var M;if(O.rel instanceof Array){M=O.rel}else{M=new Array();M.push(O.rel)}N.push("rel="+M.join(","))}if(N.length){P="?"+N.join("&");if(L!=undefined&&L===true){v.push(O)}}}}return P+"&r="+Math.random()};var e=function(V,O,M){var T=new Array();var N=V.getElementsByTagName("data");if(!N.length){return T}else{N=N[0]}var U=N.childNodes;for(var R=0;R<U.length;R++){var S=U[R];if(S.nodeName=="error"){return{error:S}}if(S.nodeName!="page"&&S.nodeName!="object"&&S.nodeName!="type"&&S.nodeName!="response"){continue}var P=new Object();for(var Q=0;Q<S.attributes.length;Q++){var L=S.attributes[Q];P[L.nodeName]=L.nodeValue}z(P,S.childNodes);T.push(P);if(O==undefined||O===false){m.push(P)}}if(M!=undefined&&(M instanceof Object)){M.total=parseInt(N.getAttribute("total"))||T.length;M.offset=parseInt(N.getAttribute("offset"))||0;M.limit=parseInt(N.getAttribute("limit"))||T.length}return T};var z=function(R,Q){if(Q.length==1&&Q[0].nodeType==3){R._value=Q[0].nodeValue;return}for(var P=0;P<Q.length;P++){var N=Q[P];var S=new Object();if(N.nodeType!=1){S=N.nodeValue}else{if(!N.attributes.length&&N.childNodes.length==1&&N.childNodes[0].nodeType==3){S=N.childNodes[0].nodeValue}else{for(var M=0;M<N.attributes.length;M++){var O=N.attributes[M];S[O.nodeName]=O.nodeValue}z(S,N.childNodes)}}if(R[N.nodeName]==undefined){R[N.nodeName]=S}else{if(R[N.nodeName] instanceof Array){R[N.nodeName].push(S)}else{var L=new Array();L.push(R[N.nodeName]);L.push(S);R[N.nodeName]=L}}}};var E=function(M){if(!(M instanceof Array)){return}for(var N=0;N<M.length;N++){for(var L=0;L<m.length;L++){if(M[N].id==m[L].id){for(var O in M[N]){m[L][O]=M[N][O]}break}}}};if((typeof(A)=="undefined")||(A==false)){this.init()}}SettingsStore.instance=null;SettingsStore.getInstance=function(){if(!SettingsStore.instance){SettingsStore.instance=new SettingsStore()}return SettingsStore.instance};function SettingsStore(){var k=window.settingsStoreData||{};var h=this;var a=new Array();this.loaded=window.settingsStoreData?true:false;this.get=function(l,m){m=d(m);if(k[l]){return(k[l][m])?k[l][m]:false}else{return false}};this.set=function(o,q,r){if(!o){return false}r=d(r);var p="/admin/users/saveUserSettings/?key="+o+"&value="+q;if(r){for(var n=0;n<r.length;n++){p+="&tags[]="+r[n]}}else{r={}}var m=function(s){};g(p,m);for(var n=0;n<r.length;n++){var l=r[n];if(!k[o]){k[o]={}}if(q){k[o][l]=q}else{k[o][l]=undefined}}};this.list=function(q){q=d(q);var m=new Array();for(key in k){var o=k[key];var r=false;for(var p in q){var l=q[p];for(var n in o){if(n==l){r=o[n]}}}if(r){m[key]=r}}return m};this.callback=function(l){if(typeof l=="function"){callback=l}return this};this.load=function(){if(this.loaded){return true}setTimeout(function(){var m="/udata/users/loadUserSettings/?r="+Math.random();var l=function(n){h.loaded=true;f(n.responseXML);e("onLoadComplete")};g(m,l)},50)};this.addEventHandler=function(n,l){var m=c(n);if(m===null){return false}m[m.length]={active:true,handler:l};if(this.loaded&&n.toUpperCase()=="ONLOADCOMPLETE"){l()}return m.length-1};var e=function(n,o){var l=c(n);if(l===null){return false}for(var m in l){if(l[m].active){l[m].handler(o)}}};var c=function(m){var l=null;switch(m.toUpperCase()){case"ONLOADCOMPLETE":return a;default:return null}};var d=function(l){var m=typeof l;if(m=="object"){if(l.length>0){return l}else{l.push("common");return l}}else{if(m=="string"){return new Array(l)}else{if(m=="undefined"){return new Array("common")}else{return false}}}};var b=function(){if(window.XMLHttpRequest){try{return new XMLHttpRequest()}catch(l){}}else{if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(l){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(l){}}}return null};var g=function(n,l){var m=b();m.onreadystatechange=function(){if(m.readyState!=4){return}if(m.status==200){l(m)}else{e("onRequestFailed")}};m.open("GET",n,false);m.send(null)};var f=function(p){var n=p.getElementsByTagName("item");for(var o=0;o<n.length;o++){var s=n[o];var t=s.getAttribute("key");k[t]={};var q=s.childNodes;var r="",u="";for(var m=0;m<q.length;m++){var l=q[m];if(l.nodeName=="value"){r=l.firstChild.nodeValue;u=l.getAttribute("tag");k[t][u]=r;continue}}}};if(this.loaded){e("onLoadComplete")}}jQuery(document).ready(function(){SettingsStore.getInstance().load()});var editableCell=function(l,z,r){var w=this;var k=r;var n=r.fieldName||r.name;var d=r.id;var c=l;var f=(c.control.contentType!="pages");var x=null;var s="";var u="";var v=r.dataType||"";this.element=z;this.prepareSaveData=function(){if(x){w.save(x.value)}};var o=function(){if(jQuery.inArray(v,editableCell.ignoreDataTypes)!=-1){return false}if(jQuery.inArray(n,editableCell.ignorePropNames)!=-1){return false}if(!editableCell.helper){editableCell.helper=document.createElement("div");editableCell.helper.className="c-helper";jQuery(editableCell.helper).css({position:"absolute",width:"16px",height:"16px",background:"url(/images/cms/admin/mac/tree/edit.png)",display:"none",cursor:"pointer",zIndex:"10"});document.body.appendChild(editableCell.helper);jQuery(editableCell.helper).bind("mouseover",function(){editableCell.hideHelper=false});jQuery(editableCell.helper).bind("mouseout",function(){editableCell.handleCell=false;editableCell.helper.style.display="none"});jQuery(editableCell.helper).bind("click",function(){editableCell.helper.style.display="none";var B=editableCell.handleCell;var A=editableCell.activeCell;if(B){if(A){A.prepareSaveData()}B.makeEditable()}})}jQuery(w.element).bind("mouseover",function(){if(!Control.enabled){return false}editableCell.hideHelper=false;var A=editableCell.activeCell;if(A&&A==w){return}editableCell.handleCell=w;var C=jQuery(z).position();var B=jQuery(c.control.initContainer).position();B.left-=c.control.initContainer.scrollLeft;jQuery(editableCell.helper).css({top:C.top+B.top+3,left:C.left+B.left+this.offsetWidth-16,display:"block"})});jQuery(w.element).bind("mouseout",function(B){editableCell.hideHelper=true;var A=w;setTimeout(function(){if(editableCell.hideHelper){editableCell.helper.style.display="none"}},10)})};this.makeEditable=function(){editableCell.activeCell=w;editableCell.handleCell=false;p()};var p=function(){var A="/admin/content/get_editable_region/"+c.id+"/"+n+".xml";if(f){A+="?is_object=1"}jQuery.ajax({type:"GET",url:A,dataType:"xml",success:function(C,B){q(C)},error:function(C,B,D){m(D)}})};var b=function(A){editableCell.activeCell=false;editableCell.handleCell=false;jQuery.jGrowl(A,{header:getLabel("js-error-header")})};var q=function(C){var B=C.getElementsByTagName("property");if(typeof(B[0])!=="undefined"){sType=B[0].getAttribute("type")||""}var A=C.getElementsByTagName("error");if(A.length){b(A[0].firstChild.nodeValue);return false}if(n=="name"){sType="name"}var D=C.getElementsByTagName("value");var E=false;switch(sType){case"wysiwyg":case"text":case"string":case"int":case"price":case"float":case"tags":case"date":case"counter":if(D.length){E=D[0].firstChild?D[0].firstChild.nodeValue:""}if(!E){E=""}t(E);break;case"boolean":if(D.length){E=D[0].firstChild?D[0].firstChild.nodeValue:""}e(E);break;case"relation":var D=C.getElementsByTagName("item");y(D,B[0].getAttribute("multiple")=="multiple");break;case"name":var D=C.getElementsByTagName("name");if(D.length){E=D[0].firstChild?D[0].firstChild.nodeValue:""}t(E);break;default:b(getLabel("js-edcell-unsupported-type"));return false;break}Control.recalcItemsPosition()};var h=function(I,E){var A=jQuery("div",w.element);var H=I.getElementsByTagName("error");if(H.length){b(H[0].firstChild.nodeValue);w.restore();return false}var F=I.getElementsByTagName("property");if(typeof(F[0])!=="undefined"){sType=F[0].getAttribute("type")||""}if(n=="name"){sType="name"}var G=I.getElementsByTagName("value");var B="";switch(sType){case"wysiwyg":case"text":case"string":case"int":case"price":case"float":case"tags":case"date":case"counter":var G=I.getElementsByTagName("value");if(G.length){B=G[0].firstChild?G[0].firstChild.nodeValue:""}A.html(B);s=B;break;case"boolean":if(G.length){B=G[0].firstChild?G[0].firstChild.nodeValue:""}A.html(B?'<img alt="" style="width:13px;height:13px;" src="/images/cms/admin/mac/tree/checked.png" />':"");s=B;break;case"relation":var G=I.getElementsByTagName("item");if(G.length){for(var D=0;D<G.length;D++){B+=G[D].getAttribute("name");if(D<G.length-1){B+=", "}}}A.html(B);s=B;break;case"name":var G=I.getElementsByTagName("name");if(G.length){B=G[0].firstChild?G[0].firstChild.nodeValue:""}A.html(u);var C=jQuery("a",w.element);C.html(B);s=B;break;default:b(getLabel("js-edcell-unsupported-type"));return false;break}if(window.onAfterSetProperty){onAfterSetProperty(c.id,n,B)}jQuery.jGrowl(getLabel("js-property-saved-success"));u=jQuery("div",w.element).html();Control.recalcItemsPosition()};var t=function(A){s=A;var B=w.element;u=jQuery("div",w.element).html();x=document.createElement("input");x.setAttribute("type","text");x.value=A;x.className="editableCtrl";x.onblur=function(){w.prepareSaveData();return true};x.onkeydown=function(D){var C=window.event?window.event.keyCode:D.which;if(C==27){w.restore()}if(C==13){w.prepareSaveData()}return true};var B=jQuery("div",w.element);B.html("");B.append(x);x.focus()};var y=function(E,A){var D=jQuery("div",w.element);u=D.html();x=document.createElement("select");x.id="relationSelect"+c.id+n;x.className="editableCtrl";if(A){x.multiple=true;x.size=3}else{x.onchange=function(){w.save(this.value,true);return true}}for(var C=0;C<E.length;C++){var G=E[C];var F=document.createElement("option");F.value=G.getAttribute("id");F.selected=true;F.innerHTML=G.getAttribute("name");x.appendChild(F)}var D=jQuery("div",w.element);D.html("");D.append(x);var B=document.createElement("input");B.id="relationInput"+c.id+n;B.className="relInput";var D=jQuery("div",w.element);D.append("<br />");D.append(B);B.focus();new relationControl(k.guideId,c.id+n);w.prepareSaveData=function(){if(x.multiple){var H=[];for(var I=0;I<x.options.length;I++){if(x.options[I].selected){H.push(x.options[I].value)}}w.save(H)}else{w.save(x.value)}};jQuery(B).add(jQuery(x)).keydown(function(I){var H=I.keyCode;if(H==27){w.restore()}if(H==13){w.prepareSaveData()}return true})};var e=function(B){var A=jQuery("div",w.element);u=A.html();x=document.createElement("input");x.type="checkbox";x.checked=B;x.className="editableCtrl check";x.onchange=function(){var C=this.checked?1:0;w.save(C,true);if(w.element.name=="is_activated"||w.element.name=="is_active"||w.element.name=="active"){c.update({"is-active":this.checked?1:0,id:c.id})}return true};jQuery(x).keydown(function(D){var C=D.keyCode;if(C==27){w.restore()}if(C==13){w.prepareSaveData()}return true});var A=jQuery("div",w.element);A.html("");A.append(x);x.focus()};var m=function(A){b(getLabel("js-edcell-get-error")+A)};var g=function(B){var A="/admin/content/save_editable_region/"+c.id+"/"+n+".xml";if(f){A+="?is_object=1"}jQuery.ajax({type:"POST",url:A,dataType:"xml",success:function(D,C){h(D,C)},data:({"data[]":B}),error:function(D,C,E){a(E)},complete:function(D,C){if(editableCell.activeCell==w){editableCell.activeCell=false}if(editableCell.handleCell==w){editableCell.handleCell=false}}})};var a=function(A){b(getLabel("js-edcell-save-error")+A)};this.save=function(B,A){editableCell.activeCell=false;if(!A&&s==B){this.restore();return false}g(B)};this.restore=function(){editableCell.activeCell=false;var A=jQuery("div",w.element);A.html(u);Control.recalcItemsPosition()};this.getEditControl=function(){return x};o()};editableCell.activeCell=false;editableCell.handleCell=false;editableCell.helper=false;editableCell.hideHelper=false;editableCell.ignoreDataTypes=["wysiwyg"];editableCell.ignorePropNames=[];var TreeItem=function(b,v,g,G,r){var w=parseInt(g.id);var C=this;var e=g;var n=v;var a=G||null;var s=r||"after";var m=typeof(g["force-draw"])!=="undefined"?parseInt(g["force-draw"]):1;var t=typeof(g.childs)!=="undefined"?parseInt(g.childs):0;var q=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["_value"])==="string")?g.basetype["_value"]:"";var c=b.iconsPath;var A=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["module"])==="string")?g.basetype["module"]:"content";var B=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["method"])==="string")?g.basetype["method"]:"";var l=typeof(g.iconbase)!=="undefined"?g.iconbase:c+"ico_"+A+"_"+B+".png";var D=null;var d=null;var k=null;var z=null;var E=SettingsStore.getInstance();var f=true;var p=null;var y=false;var F=49;this.element=null;this.control=b;this.childsContainer=null;this.id=w;this.name=typeof(g.name)!=="undefined"?g.name:"noname";this.isRoot=(w===0);this.loaded=false;this.viewLink=typeof(g.link)!=="undefined"?g.link:false;this.editLink=typeof(g["edit-link"])!=="undefined"?g["edit-link"]:false;this.createLink=typeof(g["create-link"])!=="undefined"?g["create-link"]:false;this.permissions=typeof(g.permissions)!=="undefined"?parseInt(g.permissions):0;this.isActive=typeof(g["is-active"])!=="undefined"?parseInt(g["is-active"]):0;this.isVirtualCopy=typeof(g["virtual-copy"])!=="undefined"?true:false;this.lockedBy=typeof(g["locked-by"])==="object"?g["locked-by"]:null;this.expiration=typeof(g.expiration)==="object"?g.expiration:null;this.isDefault=typeof(g["is-default"])!=="undefined"?true:false;this.templateId=typeof(g["template-id"])!=="undefined"?g["template-id"]:null;this.langId=typeof(g["lang-id"])!=="undefined"?g["lang-id"]:null;this.domainId=typeof(g["domain-id"])!=="undefined"?g["domain-id"]:null;this.allowCopy=typeof(g["allow-copy"])!=="undefined"?parseInt(g["allow-copy"]):true;this.allowActivity=typeof(g["allow-activity"])!=="undefined"?parseInt(g["allow-activity"]):true;this.allowDrag=typeof(g["allow-drag"])!=="undefined"?g["allow-drag"]:true;this.parent=n;this.childs=[];this.hasChilds=(t>0||w==0);this.labelControl=null;this.position=false;this.isExpanded=false;this.filter=new filter;this.filter.setParentElements(w);this.pageing={total:0,limit:0,offset:0};this.baseModule=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["module"])==="string")?g.basetype["module"]:"content";this.baseMethod=(typeof(g.basetype)!=="undefined"&&typeof(g.basetype["method"])==="string")?g.basetype["method"]:"";var u=function(){if(v){v.childs[v.childs.length]=w;x(n.childsContainer)}else{o()}};var x=function(I){var L=document.createElement("li");L.setAttribute("rel",w);L.className="ti";L.rel=w;L.className="ti";L.onmousedown=function(){return false};d=document.createElement("div");d.className="ti";if(C.isVirtualCopy){d.className+=" virtual"}if(C.isDefault){d.className+=" main-page"}D=document.createElement("img");D.className="ti-toggle";var R=C.hasChilds?c+"expand.png":c+"collapse-disabled.png";D.setAttribute("src",R);D.onclick=function(){C.toggle();return false};d.appendChild(D);z=document.createElement("img");z.style.border="0px";z.setAttribute("alt",q);z.setAttribute("title",q);z.setAttribute("src",l);z.className="ti-icon";z.onmousedown=function(){return false};if(C.control.allowDrag&&C.allowDrag){z.style.cursor="move"}d.appendChild(z);if(C.expiration){var S=C.expiration.status;if(S){var Q=S.id;var K=S._value;if(Q){var N=document.createElement("img");var M=c+"ico_"+Q+".png";N.setAttribute("src",M);N.setAttribute("alt",K);N.setAttribute("title",K);N.className="page-status";d.appendChild(N)}}}k=document.createElement("a");var P=C.name;if(typeof P!="string"){P=getLabel("js-smc-noname-page")}if(P.length>45){P=P.substring(0,45)+"&#8230;"}k.innerHTML=P;if(C.viewLink){k.title=C.viewLink}if(C.editLink){k.setAttribute("href",C.editLink);k.onclick=function(){return C.control.applyBehaviour(C)}}else{k.setAttribute("href","#");k.onclick=function(){return false}}d.appendChild(k);if(C.isVirtualCopy){var J=document.createElement("span");J.className="label-virtual";J.innerHTML=getLabel("js-smc-virtual-copy");d.appendChild(J)}C.labelControl=L.appendChild(d);if(!C.isActive){jQuery(z).fadeTo(1,0.5);jQuery(k).fadeTo(1,0.5);jQuery(D).fadeTo(1,0.5)}childsContainer=document.createElement("ul");childsContainer.className="ti-childs-container";childsContainer.style.display="none";C.childsContainer=L.appendChild(childsContainer);if(a){var H=null;if(s.toLowerCase()=="after"){H=a.element.nextSibling}else{H=a.element}if(H){C.element=I.insertBefore(L,H)}else{C.element=I.appendChild(L)}}else{C.element=I.appendChild(L)}if(C.control.dragAllowed&&C.allowDrag){var O="child";jQuery(d).draggable({distance:Control.DragSensitivity,handle:".ti-icon, a",helper:function(){var U=C.element;var T=document.createElement("div");T.innerHTML="<div>"+C.name+"</div>";T.className="ti-draggable";jQuery(T).css({position:"absolute",background:"url("+l+") no-repeat 0 4px"});return T},start:function(){Control.DraggableItem=C;Control.DragMode=true;if(C.control.toolbar){C.control.toolbar.hide()}},stop:function(){if(Control.HandleItem){Control.HandleItem.deInitDroppable();if(Control.DraggableItem){Control.DraggableItem.tryMoveTo(Control.HandleItem,O)}}Control.DraggableItem=null;Control.DragMode=false},drag:function(T,Z){var aa=T.pageX;var Y=T.pageY;var V=Control.detectItemByMousePointer(aa,Y);var W=Control.HandleItem;if(W){W.deInitDroppable()}Control.HandleItem=V;if(V){var ab=jQuery(V.control.initContainer).position();var X=V.position.bottom-V.position.top;var U=Y-ab.top-V.position.top;if(U<X/3){O="before"}if(U>X/3&&U<2*X/3){O="child"}if(U>2*X/3){O="after"}if(V.isRoot){O="child"}V.initDroppable(O)}}})}};var o=function(){if(!Control.dropIndicator){var H=document.createElement("div");H.className="ti-drop";Control.dropIndicator=document.body.appendChild(H)}x(C.control.container)};var h=function(){if(f&&C===Control.HandleItem){C.expand()}};this.draw=function(){if(v){if(!m){x(n.childsContainer)}}else{if(!m){o()}}};this.appendChild=function(H){return new TreeItem(this.control,C,H)};this.appendAfter=function(H,I){return new TreeItem(this.control,C,H,I,"after")};this.appendBefore=function(H,I){return new TreeItem(this.control,C,H,I,"before")};this.appendFirst=function(H){if(!this.childsContainer.childNodes.length){return this.appendChild(H)}else{if(typeof(this.childsContainer.childNodes[0].rel)!="undefined"){return this.appendBefore(H,this.control.getItem(this.childsContainer.childNodes[0].rel))}}};this.getPreviousSibling=function(){var H=this.element.previousSibling;if(H&&H.rel){return this.control.getItem(H.rel)}return null};this.getNextSibling=function(){var H=this.element.nextSibling;if(H&&H.rel){return this.control.getItem(H.rel)}return null};this.clear=function(){if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}};this.checkIsChild=function(I){var H=this.parent;while(H){if(I===H){return true}H=H.parent}return false};this.recalcPosition=function(){try{var I=jQuery(d).position();this.position={left:I.left,top:I.top,right:this.control.initContainer.offsetWidth,bottom:I.top+d.offsetHeight};return this.position}catch(H){return false}};this.getValue=function(L){if(!e.properties){return false}if(!e.properties["group"]){return false}var K=typeof(e.properties["group"][0])!="undefined"?e.properties["group"]:[e.properties["group"]];for(var J=0;J<K.length;J++){if(!K[J]["property"]){continue}var H=typeof(K[J]["property"][0])!="undefined"?K[J]["property"]:[K[J]["property"]];for(var I=0;I<H.length;I++){if(H[I]["name"]==L){return H[I]["value"]}}}return false};this.getData=function(){return e};this.setLoaded=function(H){this.loaded=H;var I=H?c+"collapse.png":c+"expand.png";D.setAttribute("src",c+"collapse.png")};this.setPageing=function(H){if(!H){return false}this.pageing=H};this.expand=function(){if(!this.hasChilds){return false}this.isExpanded=true;if(!this.loaded){if(t>F&&!this.control.disableTooManyChildsNotification){var H=this;openDialog({title:getLabel("js-expand-big-title"),text:getLabel("js-expand-big-shured"),OKText:getLabel("js-expand-do"),cancelText:getLabel("js-cancel"),OKCallback:function(){H.control.load(H.filter);D.setAttribute("src",c+"loading.gif");H.childsContainer.style.display="";Control.recalcItemsPosition();H.control.saveItemState(H.id)}});return}this.control.load(this.filter);D.setAttribute("src",c+"loading.gif")}else{D.setAttribute("src",c+"collapse.png")}this.childsContainer.style.display="";Control.recalcItemsPosition();this.control.saveItemState(this.id)};this.collapse=function(){if(!this.hasChilds){return false}this.isExpanded=false;D.setAttribute("src",c+"expand.png");this.childsContainer.style.display="none";Control.recalcItemsPosition();this.control.saveItemState(this.id)};this.toggle=function(){if(this.hasChilds){this.isExpanded?this.collapse():this.expand()}};this.update=function(I){if(I){if(this.id!=I.id){return false}if(typeof(I["template-id"])!=="undefined"){this.templateId=I["template-id"]}if(typeof(I.link)!=="undefined"&&I.link!=this.viewLink){this.viewLink=I.link;d.setAttribute("href",this.viewLink)}if(typeof(I.childs)!=="undefined"&&parseInt(I.childs)!==t){t=parseInt(I.childs);this.hasChilds=t>0||w==0;var H=c+"collapse-disabled.png";if(this.hasChilds){H=this.isExpanded?c+"collapse.png":c+"expand.png"}D.setAttribute("src",H)}var J=typeof(I["is-active"])!=="undefined"?parseInt(I["is-active"]):0;if(J!==this.isActive){this.isActive=J;if(!this.isActive){jQuery(z).fadeTo(300,0.5);jQuery(D).fadeTo(300,0.5);jQuery(k).fadeTo(300,0.5)}else{jQuery(z).fadeTo(300,1);jQuery(D).fadeTo(300,1);jQuery(k).fadeTo(300,1)}}if(typeof(I.name)!=="undefined"&&I.name!=this.name){this.name=I.name;k.innerHTML=this.name}}};this.tryMoveTo=function(I,N){if(I){var M=this.control.getRootNodeId();var H=I.id;var J=N!=="child"?1:0;if(N=="before"){M=I.id;H=I.parent.id}if(N=="after"){var K=I.getNextSibling();H=I.parent.id;M=K?K.id:this.control.getRootNodeId()}if(I===this){return false}if(I.checkIsChild(this)){return false}if(M==this.id){return false}var L=I;if(J){L=I.parent?I.parent:I.control.getRoot()}this.control.dataSet.execute("tree_move_element",{element:this.id,before:M,rel:H,"as-sibling":J,domain:I.control.getRoot().name,childs:1,links:1,virtuals:1,permissions:1,templates:1,receiver_item:L,handle_item:this})}};this.initDroppable=function(J){var J=J||"child";var H=Control.DraggableItem;var K=jQuery(this.control.initContainer).position();if(H){if(H===this){return false}if(this.checkIsChild(H)){return false}var I=Control.dropIndicator;if(J=="after"){I.style.top=this.position.bottom+K.top+"px";I.style.left=this.position.left+K.left;I.style.width=this.position.right-this.position.left}if(J=="before"){I.style.top=this.position.top+K.top+I.offsetHeight+"px";I.style.left=this.position.left+K.left;I.style.width=this.position.right-this.position.left+"px"}if(J=="child"){I.style.top=this.position.bottom+K.top+"px";I.style.left=this.position.left+K.left;I.style.width=this.position.right+K.left-20-this.position.left+"px"}I.style.display="";setTimeout(h,3239)}};this.deInitDroppable=function(){if(!Control.dropIndicator){return}Control.dropIndicator.style.display="none"};this.applyFilter=function(I,H){if(I instanceof Object){this.filter=I}else{this.filter.clear()}if(!H){this.filter.setParentElements(w)}if(this.loaded){this.control.removeItem(w,true);this.loaded=false;if(this.isExpanded){this.expand()}}};this.setSelected=function(H){if(H){if(!p){p="ti";d.className="ti selected-highlight";if(C.isDefault){d.className+=" main-page"}}y=true}else{if(p){d.className=p;if(C.isDefault){d.className+=" main-page"}p=null}y=false}};this.getSelected=function(){return y};u()};ContextMenu={};ContextMenu.itemHandlers={};ContextMenu.itemHandlers.viewElement=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=f.getData()["link"];if(!a){return false}var e=(c!=1);return{caption:getLabel("js-"+g[0]),icon:g[1],visible:true,disabled:e,execute:function(){window.location=a;return false}}};ContextMenu.itemHandlers.copyUrl=function(h){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var c=this;if(!c.clipboard){c.clipboard=new ZeroClipboard.Client();c.clipboard.addEventListener("load",function(){});c.clipboard.addEventListener("complete",function(k,l){c.clipboard.destroy();jQuery.cmenu.hideAll()});jQuery(document).click(function(){c.clipboard.destroy()})}var b=Control.HandleItem.control.selectedList;var e,g,d=0;for(e in b){g=b[e];d++}if(!g){return false}var a=g.getData()["link"];if(!a){return false}var f=(d!=1);return{caption:getLabel("js-"+h[0]),icon:h[1],visible:true,disabled:f,onRender:function(k){c.clipboard.glue(k);c.clipboard.reposition(k);c.clipboard.setText("http://"+location.hostname+a);c.clipboard.addEventListener("mouseOver",function(){jQuery(c.clipboard.domElement).trigger("mouseover")});c.clipboard.addEventListener("mouseOut",function(){jQuery(c.clipboard.domElement).trigger("mouseout")})},execute:function(k){}}};ContextMenu.itemHandlers.editItem=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in a){f=a[d];c++}if(!f){return false}var b=f.editLink;if(!b){return false}var e=(c!=1||!b);return{caption:getLabel("js-"+g[0]),icon:g[1],visible:true,disabled:e,execute:function(){window.location=b;return false}}};ContextMenu.itemHandlers.addItem=function(f){if(!Control.HandleItem){return false}var a=Control.HandleItem.control.selectedList;var c,e,b=0;for(c in a){e=a[c];b++}if(!e){return false}var g=e.createLink;if(!g){return false}var d=(b!=1||!g);return{caption:getLabel("js-"+f[0]),icon:f[1],visible:true,disabled:d,execute:function(){window.location=g;return false}}};ContextMenu.itemHandlers.filterItem=function(c){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var e=Control.HandleItem.control;var g=Control.HandleItem.control.selectedList,f,b=0;var k=false,a=false;for(f in g){var h=g[f];if(e.isTarget(h)){k=true}else{a=true}b++}var d=false;if(b==1){if(!h.hasChilds){d=true}}return{caption:getLabel("js-"+c[0]),icon:k?"checked":"undefined",visible:true,disabled:d,execute:function(){var l=Control.HandleItem.control;l.setTargetItems(k?{}:l.selectedList);return false}}};ContextMenu.itemHandlers.activeItem=function(f){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var a=Control.HandleItem.control.selectedList,c;var d=false,b=false;for(c in a){if(a[c].isActive){d=true}else{b=true}}var e=(d&&!b);return{caption:getLabel("js-"+f[0]),icon:e?"ico_unblock":"ico_block",visible:true,execute:function(){var k=Control.HandleItem.control,g,h=new Array();for(g in a){h.push(g)}k.dataSet.execute("tree_set_activity",{element:h,selected_items:a,active:(e?0:1)});return false}}};ContextMenu.itemHandlers.activeObjectItem=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(!Control.HandleItem.control.flatMode){return false}var a=Control.HandleItem.control.selectedList,c;var d=false,b=false;for(c in a){var f=a[c];if(f.getValue("is_activated")||f.getValue("is_active")||f.getValue("activated")){d=true}else{b=true}}var e=(d&&!b);return{caption:getLabel("js-"+action[0]),icon:e?"ico_unblock":"ico_block",visible:true,execute:function(){var k=Control.HandleItem.control,g,h=new Array();for(g in a){h.push(g)}k.dataSet.execute("tree_set_activity",{object:h,selected_items:a,viewMode:"full",active:(e?0:1)});return false}}};ContextMenu.itemHandlers.activeObjectItem=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(!Control.HandleItem.control.flatMode){return false}var a=Control.HandleItem.control.selectedList,c;var d=false,b=false;for(c in a){var f=a[c];if(f.getValue("is_activated")||f.getValue("is_active")||f.getValue("activated")){d=true}else{b=true}}var e=(d&&!b);return{caption:getLabel("js-"+g[0]),icon:e?"ico_unblock":"ico_block",visible:true,execute:function(){var l=Control.HandleItem.control,h,k=new Array();for(h in a){k.push(h)}l.dataSet.execute("tree_set_activity",{element:Control.HandleItem.id,object:k,handle_item:Control.HandleItem,selected_items:a,viewMode:"full",active:(e?0:1)});return false}}};ContextMenu.itemHandlers.deleteItem=function(b){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=Control.HandleItem.control.selectedList;if(a.length<1){return false}return{caption:getLabel("js-"+b[0]),icon:b[1],visible:true,execute:function(){var g=Control.HandleItem.control,d,e=new Array();var c=g.selectedList;for(d in c){var f=c[d];if(f.lockedBy){alert(getLabel("js-page-is-locked")+"\n"+getLabel("js-steal-lock-question"));ContextMenu.getInstance().terminate();return false}e.push(d)}g.dataSet.execute("tree_delete_element",{element:e,selected_items:c});return false}}};ContextMenu.itemHandlers.templatesItem=function(e){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var l=Control.HandleItem.control.selectedList;var g,k=false,a=false,c=false,h=false;for(g in l){var r=l[g];if(!k||!a){k=r.langId;a=r.domainId}if(c&&h){if(c!=r.templateId){c=false}}if(!c&&!h){c=r.templateId;h=true}}var f=TemplatesDataSet.getInstance();var n={},p=f.getTemplatesList(a,k);var d=function(s){return function(){if(!Control.HandleItem){return false}var v=Control.HandleItem.control,t,u=new Array();for(t in l){u.push(t)}v.dataSet.execute("change_template",{element:u,selected_items:l,"template-id":s,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};for(g in p){var q=p[g];var b=q.id,m=q.title,o=false;if(!b){continue}if(c&&c==b){o=true}n[b]={icon:o?"checked":"undefined",caption:m,execute:d(b)}}return{caption:getLabel("js-"+e[0]),icon:e[1],visible:true,execute:function(){return false},submenu:n}};ContextMenu.itemHandlers.storeGoodsItem=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=window.pre_lang+"/admin/eshop/store_view/"+f.id+"/";if(!a){return false}var e=(c!=1);return{title:getLabel("js-view-store-goods"),callback:function(){window.location=a;return false},disabled:e}};ContextMenu.itemHandlers.guideViewItem=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=window.pre_lang+"/admin/data/guide_items/"+f.id+"/";if(!a){return false}var e=(c>1);return{caption:getLabel("js-view-guide-items"),icon:"view",execute:function(){window.location=a;return false},disabled:e}};ContextMenu.itemHandlers.viewMessage=function(){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var b=Control.HandleItem.control.selectedList;var d,f,c=0;for(d in b){f=b[d];c++}if(!f){return false}var a=window.pre_lang+"/admin/webforms/message/"+f.id+"/";var e=(c>1);return{caption:getLabel("js-view-message"),icon:"view",execute:function(){window.location=a;return false},disabled:e}};ContextMenu.itemHandlers.csvExport=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.objectTypesMode||Control.HandleItem.control.flatMode){return false}var b=Control.HandleItem.control.selectedList;var e,f,d=0;for(e in b){f=b[e];d++}if(!f.hasChilds){return false}if(d!=1){return false}var a=f.id;var c=f;return{caption:getLabel("js-csv-export"),icon:g[1],visible:true,execute:function(){var h=c.getExportLink(a);window.location=h;return false}}};ContextMenu.itemHandlers.csvImport=function(g){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.objectTypesMode||Control.HandleItem.control.flatMode){return false}var b=Control.HandleItem.control.selectedList;var e,f,d=0;for(e in b){f=b[e];d++}if(!f.hasChilds){}if(d!=1){return false}var a=f.id;var c=f;return{caption:getLabel("js-csv-import"),icon:g[1],visible:true,execute:function(){var h=c.getImportLink(a);c.callCsvImport(h);return false}}};ContextMenu.itemHandlers.restoreItem=function(b){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}var a=Control.HandleItem.control.selectedList;if(a.length<1){return false}return{caption:getLabel("js-trash-restore"),icon:b[1],visible:true,execute:function(){var f=Control.HandleItem.control,d,e=new Array();var c=f.selectedList;for(d in c){e.push(d)}f.dataSet.execute("restore_element",{element:e,selected_items:c});return false}}};ContextMenu.itemHandlers.copyItem=function(h){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var k=Control.HandleItem.control;var p=k.selectedList;var m,s,a=false;langId=false;for(m in p){s=p[m];a=s.domainId;langId=s.langId}var l=TemplatesDataSet.getInstance();var n=l.getLangsList();var q=l.getDomainsList();var g=function(d,t){return function(){var u,v=new Array();for(u in p){v.push(u)}k.dataSet.addEventHandler("onBeforeExecute",createConfirm(k.dataSet));k.dataSet.execute("copy_to_lang",{element:v,handle_item:$.extend(true,{},Control.HandleItem),selected_items:p,"lang-id":t,"domain-id":d,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};var c={};for(m=0;m<q.length;m++){var o=q[m];var r=(a==o.id);var f={};for(j=0;j<n.length;j++){var e=n[j];var b=r&&(langId==e.id);f[e.id]={icon:b?"checked":"undefined",caption:e.nodeValue,execute:g(o.id,e.id)}}c[o.id]={icon:r?"checked":"undefined",caption:o.host,execute:function(){return false},submenu:f}}return{caption:getLabel("js-"+h[0]),visible:true,execute:function(){return false},submenu:c}};ContextMenu.itemHandlers.moveItem=function(h){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var k=Control.HandleItem.control;var p=k.selectedList;var m,s,a=false;langId=false;for(m in p){s=p[m];a=s.domainId;langId=s.langId}var l=TemplatesDataSet.getInstance();var n=l.getLangsList();var q=l.getDomainsList();var g=function(d,t){return function(){var u,v=new Array();for(u in p){v.push(u)}k.dataSet.execute("move_to_lang",{element:v,handle_item:$.extend(true,{},Control.HandleItem),selected_items:p,"lang-id":t,"domain-id":d,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};var c={};for(m=0;m<q.length;m++){var o=q[m];var r=(a==o.id);var f={};for(j=0;j<n.length;j++){var e=n[j];var b=r&&(langId==e.id);f[e.id]={icon:b?"checked":"undefined",caption:e.nodeValue,execute:g(o.id,e.id)}}c[o.id]={icon:r?"checked":"undefined",caption:o.host,execute:function(){return false},submenu:f}}return{caption:getLabel("js-"+h[0]),visible:true,execute:function(){return false},submenu:c}};ContextMenu.itemHandlers.copyItemOld=function(k){if(!Control.HandleItem){return false}if(!Control.HandleItem.id){return false}if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode){return false}var e=Control.HandleItem.control;var g=e.selectedList;var m,l,p,h=false,a=false;for(m in g){p=g[m];h=p.domainId;a=p.langId}var n=TemplatesDataSet.getInstance();var r=n.getLangsList();var b=n.getDomainsList();var s=function(d,v){return function(){var w,x=new Array();for(w in g){x.push(w)}e.dataSet.addEventHandler("onBeforeExecute",createConfirm(e.dataSet));e.dataSet.execute("copy_to_lang_old",{element:x,handle_item:$.extend(true,{},Control.HandleItem),selected_items:g,"lang-id":v,"domain-id":d,templates:1,childs:1,permissions:1,virtuals:1,links:1});return false}};var t={};for(m=0;m<b.length;m++){var q=b[m];var c=(h==q.id);var f={};for(l=0;l<r.length;l++){var u=r[l];var o=c&&(a==u.id);f[u.id]={icon:o?"checked":"undefined",caption:u.nodeValue,execute:s(q.id,u.id)}}t[q.id]={icon:c?"checked":"undefined",caption:q.host,execute:function(){return false},submenu:f}}return{caption:getLabel("js-"+k[0]),visible:true,execute:function(){return false},submenu:t}};ContextMenu.itemHandlers.typeRemove=function(){};ContextMenu.itemHandlers.typeEdit=function(){};ContextMenu.allowControlEnable=true;var SessionControl=function(c,a){c=parseInt(c);if(!c){c=10}this.lifetime_min=c;this.setLastAction();this.setCurrentPeriod();this.last_pinged_success=true;this.window_warning_closed=false;this.window_session_closed=false;this.show_settings_link=parseInt(a)>0?1:0;var b=this;jQuery(function(){b.init()})};SessionControl.prototype.showWarningMessage=function(b){if(b){clearInterval(this.timer);this.timer=null}if(this.timer){return}var a=this;a.session_close_time=new Date();a.session_close_time.setMinutes(a.session_close_time.getMinutes()+1);this.timer=setInterval(function(){var h=new Date();var e=(a.session_close_time.getTime()-h.getTime());if(e>1){var f=(parseInt(e/1000));var g=(parseInt(f/60));var d=f-g*60;if(d<10){d="0"+d}var k=g+":"+d;var c=parseInt(((new Date).getTime()-a.last_action_time.getTime())/60/1000);a.message("Вы отсутствуете "+c+" мин. Сессия скоро закончится <br>"+k)}else{clearInterval(a.timer);a.timer=null;jQuery.get("/session.php",function(l){if(l=="closed"){a.sessionCloseMessage(true)}if(l=="warning"){a.showWarningMessage(true)}if(l=="ok"){a.closeMessage();a.setCurrentPeriod()}})}},1000)};SessionControl.prototype.sessionCloseMessage=function(d){var b=this;d=d||false;if(d){clearInterval(this.timer);this.timer=null}if(this.timer){return}this.last_pinged_success=false;var a=parseInt(((new Date).getTime()-b.last_action_time.getTime())/60/1000);var f=jQuery("<div>");f.html("<br/>Вы отсутствовали более "+this.lifetime_min+" мин, поэтому Ваша сессия была закончена.<br/><br/> ");var e="<form><table cellspacing='5' width='100%' style='font-size:12px;'>							<tr><td>Логин: </td><td> <input type='text' id='session_contorl_login' /></td></tr>							<tr><td>Пароль:</td><td> <input type='password' id='session_contorl_passsword' /></td></tr>							</table><br/>							<input type='submit' value='Хочу продлить сессию'>  ";if(this.show_settings_link){e+="<br/> <br/><a href='/admin/config/main/' target='_blank'>Настроить таймаут неактивности</a>"}e+="</form>";var c=jQuery(e);c.submit(function(){var g=jQuery("#session_contorl_login").val();var h=jQuery("#session_contorl_passsword").val();if(jQuery.trim(g)!=""&&jQuery.trim(h)!=""){b.ping(g,h,function(k){if(k=="ok"){b.closeMessage();clearInterval(b.timer);b.timer=null;alert("Сессия успешно восстановлена!")}else{alert("Ошибка! Неправильный логин или пароль")}b.setCurrentPeriod()})}else{alert("Укажите логин и пароль для восстановления сессии!")}return false});f.append(c);b.message(f);this.timer=1;this.setCurrentPeriod()};SessionControl.prototype.message=function(c){var a=this;if(typeof c=="string"){c="<br/><p> "+c+" </p>"}if(!this.jgrowl){this.jgrowl=jQuery('<div id="SessionjGrowl"></div>').addClass("top-right").appendTo("body");this.jgrowl.jGrowl(c,{header:"UMI.CMS",dont_close:true,close:function(){a.jgrowl=0}});return}var b=this.jgrowl.find(".jGrowl-notification .jGrowl-message");if(typeof c=="string"){b.html(c)}else{b.html("");b.append(c)}};SessionControl.prototype.closeMessage=function(){var a=this.jgrowl;if(this.jgrowl&&a.length){a.data("jGrowl.instance").shutdown();a.remove()}this.jgrowl=0};SessionControl.prototype.init=function(){var a=this;jQuery(document).bind("click keydown mousedown",function(){a.setLastAction()});setTimeout(function(){jQuery("iframe").each(function(){var b=this.contentWindow||this.contentDocument;if(b.document){b=b.document;jQuery(b).bind("click keydown mousedown",function(){a.setLastAction()})}})},30000);this.timerAutoPing=setInterval(function(){a.checkAutoPing()},60*1000)};SessionControl.prototype.destroy=function(){if(this.timerAutoPing){clearInterval(this.timerAutoPing)}if(this.timer){clearInterval(this.timer);this.timer=0}return true};SessionControl.prototype.ping=function(b,c,d){var e={};if(b){e={"u-login":b,"u-password":c}}var a=this;jQuery.post("/users/ping/",e,function(f){if(f=="ok"){a.last_pinged_success=true}else{a.last_pinged_success=false}if(a.timerAutoPing){clearInterval(a.timerAutoPing)}a.timerAutoPing=setInterval(function(){a.checkAutoPing()},60*1000);if(d){d(f)}})};SessionControl.prototype.setCurrentPeriod=function(a){this.current_period_start_time=new Date();this.current_period_end_time=this.current_period_start_time;this.current_period_end_time.setMinutes(this.current_period_end_time.getMinutes()+this.lifetime_min)};SessionControl.prototype.setLastAction=function(){this.last_action_time=new Date;if(this.last_pinged_success){this.closeMessage();clearInterval(this.timer);this.timer=null}};SessionControl.prototype.startAutoActions=function(){var a=this;this.timerAutoAction=setInterval(function(){a.setLastAction()},60000)};SessionControl.prototype.stopAutoActions=function(){if(this.timerAutoAction){clearInterval(this.timerAutoAction)}};SessionControl.prototype.getLastAction=function(){return this.last_action_time};SessionControl.prototype.isUserhere=function(){var b=(((new Date).getTime()-this.last_action_time.getTime()))/60000;var a=false;if(b<this.lifetime_min-0.2){a=true}return a};SessionControl.prototype.checkAutoPing=function(){if(!this.last_pinged_success){this.sessionCloseMessage();return false}if(this.timer){return false}var b=false;var c=((this.current_period_end_time.getTime()-(new Date).getTime()))/60000;if(c<1.2){b=1}if(!b){return}var a=this;var d=this.isUserhere();if(d===false){jQuery.get("/session.php",function(e){this.settings_link=false;if(e=="ok"){return}if(e=="closed"){a.sessionCloseMessage()}if(e=="warning"){a.showWarningMessage()}if(e=="warning_settings"){this.settings_link=true;a.showWarningMessage()}})}else{a.closeMessage();a.ping();a.setCurrentPeriod()}return};